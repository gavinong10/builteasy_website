/*! Thrive Leads - The ultimate Lead Capture solution for wordpress - 2017-01-11
* https://thrivethemes.com 
* Copyright (c) 2017 * Thrive Themes */
var ThriveLeads=ThriveLeads||{};ThriveLeads.views=ThriveLeads.views||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},jQuery(function(){var a=jQuery;a(document).keypress(function(a){13!=a.which&&13!=a.keyCode||jQuery(".tve-stop-test-variation-modal-action").is(":visible")&&jQuery(".tve-stop-test-variation-modal-action").focus().click()}),a("body").on("click",".tl-toggle-display",function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed");jQuery(b.data("target"))[c?"slideDown":"slideUp"](200),b.toggleClass("collapsed"),b.toggleClass("hover")}),ThriveLeads.views.Base=Backbone.View.extend({render:function(){return this.$el.html(this.template(this.model.toJSON())),this},initialize:function(){this.listenTo(this.model,"change",this.render)},modal:function(a,b){return TVE_Dash.modal(a,b)}}),ThriveLeads.views.Group=ThriveLeads.views.Base.extend({tagName:"li",className:"collapse-table-list-item tvd-collapsible",template:TVE_Dash.tpl("groups/item"),events:{"click .tve-group-delete":"deleteGroupPopup","click .tve-start-group-test":"startTest","click .tve-add-form-type":"addFormType","click .tve-group-details":function(a){this.model.set("details_expanded",!this.model.get("details_expanded"))},"click .tve-group-heading":function(a){var b=jQuery(a.target);return b.hasClass("tve-prevent-click")||b.parents(".tve-prevent-click").length?(a.stopPropagation(),!0):void this.model.set("details_expanded",!this.model.get("details_expanded"))},"click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input input":"saveTitle","keyup .tve-edit-title-input input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .tve-group-settings":"showDisplaySettings"},initialize:function(){this.listenTo(this.model,"change:details_expanded",this.groupDetails),this.listenTo(this.model,"change:impressions",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.get("active_tests"),"add",this.render),this.listenTo(this.model.get("completed_tests"),"add",this.render),this.listenTo(this.model.get("form_types"),"change:ID remove add",this.render),this.listenTo(this.model.get("completed_tests"),"remove",this.render),this.listenTo(this.model,"change:post_title",this.render),this.listenTo(this.model,"change:has_display_settings",this.render);var b=this;a(document).on("tl.form_type.added",function(a,c){c.post_parent&&b.model.get("ID")==c.post_parent&&setTimeout(function(){b.$el.find('.tvd-form-tooltip[data-form="'+c.ID+'"]').fadeIn("slow")},1e3)}).on("tl.form_type.update_display",function(a,c){c.post_parent&&b.model.get("ID")==c.post_parent&&b.update_display_options()})},render:function(){var a=!1,b=!1,c=this.model.toJSON();return c.running_tests_count=this.model.get("active_tests").length,c.archived_tests_count=this.model.get("completed_tests").length,this.$el.html(this.template(c)),this.renderFormTypes(),this.model.ableForTest()||this.$el.find(".tve-start-group-test").hide(),this.model.get("active_tests").length&&(a=!0,this.model.get("active_tests").each(this.renderActiveTest,this)),this.model.get("completed_tests").length&&(b=!0,this.model.get("completed_tests").each(this.renderCompletedTest,this)),this.$el.find(".tve-leads-running-tests")[a?"show":"hide"](),this.$el.find(".tve-leads-archived-tests")[b?"show":"hide"](),this.groupDetails(),this},addFormType:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddFormType,{width:1030,"max-width":"100%",model:this.model.get("form_types"),post_parent:this.model.get("ID")})},update_display_options:function(){var a=this.model.get("form_types"),b=this.model.get("ID"),c=0,d=0,e=0;a.each(function(a){""!=a.get("ID")&&(e++,c+=parseInt(a.get("display_on_mobile")),d+=parseInt(a.get("display_status")))}),this.$el.find("#tve-dm-"+b).html(0==c?"No":e>c?"Custom":"Yes"),this.$el.find("#tve-ds-"+b).html(0==d?"No":e>d?"Custom":"Yes")},startTest:function(){var a=this;this.$el.find("tr").removeClass("tve-form-no-content"),TVE_Dash.showLoader(),this.model.ajaxGetEmptyVariations().done(function(b){var c=b.ids?b.ids:[];a.model.get("form_types").each(function(a){-1!==jQuery.inArray(a.get("ID"),c)?a.set("has_design",!1):a.set("has_design",!0)});var d=TVE_Dash.modal(ThriveLeads.views.lightbox.VariationTest,{title:ThriveLeads["const"].translations.StartFormtypeTest+" "+ThriveLeads["const"].translations.StartGroupTestVideo,model:a.model,width:900,"max-width":"80%"});d.renderFormTypes()}).fail(function(a,b,c){}).always(function(){TVE_Dash.hideLoader()})},renderFormTypes:function(){var a=this,b=0;this.model.get("form_types").each(function(c){if(c.get("ID")){var d=new ThriveLeads.views.FormType({model:c});a.$el.find(".tve-form-types > .tve-form-types-list").append(d.render().el),b++}}),this.$el.find(".tve-no-form-type")[b?"hide":"show"]()},deleteGroupPopup:function(b){var c=a(b.currentTarget);return TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteGroup,{title:c.attr("data-title"),width:650,model:ThriveLeads.objects.groups.get(c.attr("data-id"))}),!1},groupDetails:function(){this.model.get("details_expanded")?(this.$el.addClass("tve-expanded tvd-active"),this.$el.find(".tve-form-types").slideDown("fast")):(this.$el.removeClass("tve-expanded tvd-active"),this.$el.find(".tve-form-types").slideUp("fast"))},renderActiveTest:function(a){var b=this;a.set("type",[]),_.each(a.get("item_ids"),function(c){var d=b.model.get("form_types").findWhere({ID:parseInt(c)});d&&(d.set("group_test_id",a.get("id")),a.get("type").push(d.get("post_title")))});var c=new ThriveLeads.views.ActiveTestItem({model:a});this.$el.find("#tve-active-group-test-list").append(c.render().el)},renderCompletedTest:function(a){var b=this;a.set("type",[]),_.each(a.get("item_ids"),function(c){var d=b.model.get("form_types").findWhere({ID:parseInt(c)});d&&a.get("type").push(d.get("post_title"))});var c=new ThriveLeads.views.CompletedTestItem({model:a});this.$el.find("#tve-completed-group-test-list").append(c.render().el)},showEditTitleInput:function(a){var b=this.$el.find(".group-title").hide(),c=this.$el.find(".tve-edit-title-input");c.show().children("input").val(b.text().trim()).focus().select(),jQuery(a.currentTarget).hide(),a.stopPropagation()},saveTitle:function(a){var b=a.currentTarget.value;b!=this.model.get("post_title")&&(this.model.set("post_title",b),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(a){27!=a.which&&13!=a.which||this.closeEditTitle()},closeEditTitle:function(){var a=this.model.get("post_title");this.$el.find(".tve-edit-title-input input").val(a),this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".group-title,.tve-edit-title").show()},showDisplaySettings:function(){TVE_Dash.showLoader();var a={title:this.model.get("post_title")+" "+ThriveLeads["const"].translations.DisplayGroupSettings+" "+ThriveLeads["const"].translations.GroupSettingsVideo,"max-width":"90%",width:"80%"},b=this.model.get("ID");return jQuery.ajax({url:ThriveLeads["const"].url.admin+"admin-ajax.php?action=thrive_leads_backend_ajax&route=displayGroupSettings&group="+b,dataType:"json",success:function(c){ThriveLeads.objects.hangers=new ThriveLeads.collections.Hangers(c.hangers),ThriveLeads.objects.savedTemplates=new ThriveLeads.models.TemplateList(c.savedTemplates),a.collection=ThriveLeads.objects.hangers,a.model={hangers:ThriveLeads.objects.hangers,templates:ThriveLeads.objects.savedTemplates};var d=new ThriveLeads.views.DisplayGroupSettings(a);d.urlSaveOptions=ThriveLeads.ajaxurl("action=thrive_leads_backend_ajax&route=saveGroupSettings"),d.urlSaveTemplate=ThriveLeads.ajaxurl("action=thrive_leads_backend_ajax&route=saveGroupTemplate"),d.group=b,d.render().open()}}).fail(function(){}).always(function(){TVE_Dash.hideLoader()}),!1}}),ThriveLeads.views.FormType=ThriveLeads.views.Base.extend({className:"tve-form-type-item tvd-collection-item",template:TVE_Dash.tpl("form-type/item"),events:{"click .tve-form-type-add":"add","click .tve-form-type-delete":"deleteModal","click .tve-form-type-mobile":"toggle_display","click .tve-form-type-status":"toggle_display","click .form-type-reset":"reset","click .tve-leads-php-code":"grabPHPCode"},initialize:function(){this.listenTo(this.model,"change:group_test_id",this.render),this.listenTo(this.model,"change:conversions",this.render),this.listenTo(this.model,"change:conversion_rate",this.render),this.listenTo(this.model,"change:impressions",this.render);var b=this.model;a(window).on("tl.tpl.save",function(a,c){c.ID==b.get("ID")&&b.get("variations").get(c.key).set("content","true")})},render:function(){return this.$el.html(this.template({form:this.model})),this},add:function(){ThriveLeads.router.navigate("#form-type/"+this.model.get("ID"),{trigger:!0})},save:function(){var a=this;this.model.save({},{success:function(b,c){a.model.set("ID",c)},complete:function(a){}})},toggle_display:function(b){var c=jQuery(b.currentTarget).is(":checked")?1:0,d=this.model.get("post_parent"),e=jQuery(b.target).attr("data-display");this.model.set(e,c),this.save(),a(document).trigger("tl.form_type.update_display",{post_parent:d})},reset:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmFormTypeResetStats,{title:ThriveLeads["const"].translations.ResetFormStats,model:this.model,width:600})},grabPHPCode:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.PHPInsertCode,{title:ThriveLeads["const"].translations.PHPInsertCode,model:this.model})},deleteModal:function(a){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteFormType,{width:650,model:this.model})}}),ThriveLeads.views.FormVariation=ThriveLeads.views.Base.extend({tagName:"tr",className:"tvd-collection-item",template:TVE_Dash.tpl("form-type/variation"),events:{"click .variation-archive":"archive","click .variation-publish":"reAdd","click .variation-delete":"remove","click .variation-reset":"reset","click .variation-clone":"clone","click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input input":"saveTitle","keyup .tve-edit-title-input input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .tve-leads-display-frequency":"showFrequencyPopup","click .tve-leads-display-animation":"showAnimationPopup","click .tve-leads-lock-display":"showLockDisplayPopup"},has_frequency_settings:!1,has_position_settings:!1,has_animation_settings:!1,has_trigger_settings:!1,content_locking:!1,initialize:function(){this.listenTo(this.model,"change:post_title",this.render),this.listenTo(this.model,"change:impressions",this.render),this.listenTo(this.model,"change:conversions",this.render),this.listenTo(this.model,"change:display_frequency_nice_name",this.render),this.listenTo(this.model,"change:display_position_nice_name",this.render),this.listenTo(this.model,"change:display_animation_nice_name",this.render),this.listenTo(this.model,"change:content_locking",this.render)},render:function(){return this.model.set("has_frequency_settings",this.has_frequency_settings),this.model.set("has_position_settings",this.has_position_settings),this.model.set("has_animation_settings",this.has_animation_settings),this.model.set("content_locking",this.content_locking),this.model.set("has_trigger_settings",this.has_trigger_settings),this.model.set("has_trigger_options",!(this.model instanceof ThriveLeads.models.TwoStepLightboxVariation)),this.$el.html(this.template(this.model.toJSON())),this},archive:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ArchiveForm,{title:ThriveLeads["const"].translations.ArchiveForm,model:this.model})},reset:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmResetStats,{title:ThriveLeads["const"].translations.ResetFormStats,model:this.model,width:600})},clone:function(a){TVE_Dash.showLoader();var b=this.model.toJSON();if(this.model instanceof ThriveLeads.models.ShortcodeVariation)var c=new ThriveLeads.models.ShortcodeVariation(_.extend({},b));else if(this.model instanceof ThriveLeads.models.TwoStepLightboxVariation)var c=new ThriveLeads.models.TwoStepLightboxVariation(_.extend({},b));else var c=new ThriveLeads.models.FormVariation(_.extend({},b));c.set("clone_from",c.get("key")),c.set("is_control",0),c.set("key","");var d=c.save({});ThriveLeads.addFailCallback(d),d.done(function(a){c.set(a)}).always(function(){d.failed||(c.unset("clone_from"),c instanceof ThriveLeads.models.ShortcodeVariation?(ThriveLeads.objects.Shortcode.get("variations").add(c),ThriveLeads.objects.Shortcode.trigger("change")):c instanceof ThriveLeads.models.TwoStepLightboxVariation?(ThriveLeads.objects.TwoStepLightbox.get("variations").add(c),ThriveLeads.objects.TwoStepLightbox.trigger("change")):(ThriveLeads.objects.FormType.get("variations").push(c),ThriveLeads.objects.FormType.trigger("change")),TVE_Dash.hideLoader())})},reAdd:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddForm,{title:ThriveLeads["const"].translations.ReAddForm+" "+this.model.get("post_title"),model:new Backbone.Model({state:"re-add",group_id:Backbone.history.getFragment().match(/form-type/g)?ThriveLeads.objects.FormType.get("post_parent"):0,form_type_id:this.model.post_parent,form_variation:this.model})})},remove:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteVariation,{title:ThriveLeads["const"].translations.DeleteForm,model:this.model,width:650})},showEditTitleInput:function(a){var b=this.$el.find(".form-title").hide(),c=this.$el.find(".tve-edit-title-input");c.show().children("input").val(b.text().trim()).focus().select(),jQuery(a.currentTarget).hide()},saveTitle:function(a){var b=a.currentTarget.value;b!=this.model.get("post_title")&&(this.model.set("post_title",b),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(a){27!=a.which&&13!=a.which||this.closeEditTitle()},closeEditTitle:function(){this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".form-title,.tve-edit-title").show()},showFrequencyPopup:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DisplayFrequencySettings,{title:ThriveLeads["const"].translations.DisplaySettings,model:this.model,width:700})},showAnimationPopup:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AnimationSettings,{model:this.model,"max-width":"40%"})},showLockDisplayPopup:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.LockDisplaySettings,{title:ThriveLeads["const"].translations.LockDisplaySettings,model:this.model,width:700})}}),ThriveLeads.views.Dashboard=Backbone.View.extend({el:a("#tve-content"),template:_.template(a("#tve-leads-dashboard").length?a("#tve-leads-dashboard").html():""),globalSettings:null,initialize:function(a){this.globalSettings=a.globalSettings,this.has_non_uniques=a.has_non_uniques},events:{"click .report-item":"goToReporting","click .tve-leads-clear-cache":"clearCacheStats","click .tve-leads-delete-logs":"deleteConversionLogs","click .tl-inbound-link-builder":"inboundLinkBuilder"},goToReporting:function(){location.href=ThriveLeadsConst.url.reporting},inboundLinkBuilder:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.InboundLink,{title:ThriveLeads["const"].translations.InboundLinkBuilder,width:750,"max-width":"70%",collection:ThriveLeads.objects.groups,model:new ThriveLeads.models.InboundLink})},render:function(){ThriveLeads.objects.titleChanger.replaceFirst("Thrive Leads Dashboard"),this.$el.html(this.template({globalSettings:this.globalSettings,has_non_uniques:this.has_non_uniques}));var b=new ThriveLeads.views.LeadGroups({el:this.$el.find("#tve-lead-groups"),collection:ThriveLeads.objects.groups}),c=new ThriveLeads.views.LeadShortcodes({el:this.$el.find("#tve-lead-shortcodes"),collection:ThriveLeads.objects.shortcodeCollection}),d=new ThriveLeads.views.TwoStepLightboxList({el:this.$el.find("#tve-two-step-lightbox"),collection:ThriveLeads.objects.TwoStepLightboxCollection}),e=new ThriveLeads.views.OneClickSignupList({el:this.$el.find("#tve-one-click-signup"),collection:ThriveLeads.objects.OneClickSignupCollection}),f=ThriveLeads.objects.groups.getTotalVariations(),g=ThriveLeads.objects.shortcodeCollection.getTotalVariations(),h=ThriveLeads.objects.TwoStepLightboxCollection.getTotalVariations();b.renderAll(),c.render(),d.render(),e.render(),f+g+h&&a("#no-form-overlay").hide(),ThriveLeads.displayMessages(),window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes(),this.$el.find(".tve-setting-change").on("change",_.bind(this.globalSetting,this)),this.$el.find(".tve-leads-db-optimize").on("click",_.bind(this.optimizeDB,this)),TVE_Dash.materialize(this.$el)},optimizeDB:function(a){var b={action:"thrive_leads_backend_ajax",route:"optimizeDbAPI"};TVE_Dash.showLoader(),jQuery.post(ajaxurl,b,function(){TVE_Dash.success(ThriveLeadsConst.translations.DbOptimized),TVE_Dash.hideLoader()}),this.has_non_uniques=!1},toggleGlobalSettings:function(a){return jQuery(a.currentTarget).parents(".nav-wrapper").find("#tve-settings-postbox").slideToggle(),!1},globalSetting:function(a){var b=jQuery(a.currentTarget),c={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:b.attr("name"),value:b.attr("value")};b.is('input[type="checkbox"]')&&!b.is(":checked")&&(c.value=0),this.globalSettings[c.field]=c.value,jQuery.post(ajaxurl,c)},clearCacheStats:function(){TVE_Dash.showLoader(),jQuery.post(ajaxurl,{action:"thrive_leads_backend_ajax",route:"clearCacheStatistics"},function(){location.reload()})},deleteConversionLogs:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DeleteConversionLogs)}}),ThriveLeads.views.LeadShortcodes=Backbone.View.extend({events:{"click .tve-add-shortcode":"openAddShortcode"},initialize:function(){this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.remove)},remove:function(){0==this.collection.length&&(this.$el.find(".tve-shortcode-list-header").hide(),this.$el.find(".no-shortcodes").show())},addOne:function(a){var b=new ThriveLeads.views.Shortcode({model:a,collection:this.collection});this.$el.find("#tve-shortcode-list").append(b.render().$el),this.$el.find(".tve-shortcode-list-header").show(),this.$el.find(".no-shortcodes").hide()},render:function(){this.$el.find("#tve-shortcode-list .tvd-collection-item").remove(),this.collection.each(this.addOne,this)},openAddShortcode:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddShortcode,{title:ThriveLeads["const"].translations.AddShortcode+" &nbsp;"+ThriveLeads["const"].translations.AddNewShortcodeVideo})}}),ThriveLeads.views.Shortcode=Backbone.View.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("shortcode/item"),events:{"click .tve-shortcode-delete":"deleteShortcodePopup","click .shortcode-reset":"reset","click .tve-shortcode-content-locking":"toggle_content_locking","click .tve-leads-php-code":"grabPHPCode","click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input input":"saveTitle","keyup .tve-edit-title-input input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .tve-leads-clear-cache":"clearCacheStats","click .tve-leads-delete-logs":"deleteConversionLogs","change .tve-setting-change":"globalSetting"},initialize:function(){this.model.on("remove",this.remove,this),this.listenTo(this.model,"change:impressions",this.render),this.listenTo(this.model,"change:post_title",this.render)},remove:function(){this.$el.remove()},render:function(){return this.$el.html(this.template({shortcode:this.model})),this.bindZclip(),this.$el.find(".tve-copy-code-container")["1"==this.model.get("content_locking")?"hide":"show"](),TVE_Dash.materialize(this.$el),this},bindZclip:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))},deleteShortcodePopup:function(b){var c=a(b.currentTarget);TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteShortcode,{title:c.attr("title"),width:650,model:ThriveLeads.objects.shortcodeCollection.get(c.attr("data-id"))})},toggle_content_locking:function(a){var b=jQuery(a.currentTarget).is(":checked")?1:0,c=this;this.model.set("content_locking",b),this.$el.find(".tve-copy-code-container")[b?"hide":"show"](),this.model.save({},{success:function(a,b){c.model.set("ID",b),c.model.set("shortcode_code",""),c.$el.find(".tve-shortcode-"+b).val(c.model.getCode())},complete:function(a){}})},reset:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmFormTypeResetStats,{title:ThriveLeads["const"].translations.ResetFormStats,model:this.model,width:600})},grabPHPCode:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.PHPInsertCode,{title:ThriveLeads["const"].translations.PHPInsertCode,model:this.model})},showEditTitleInput:function(a){var b=this.$el.find(".group-title").hide(),c=this.$el.find(".tve-edit-title-input");c.show().children("input").val(b.text().trim()).focus().select(),jQuery(a.currentTarget).hide(),a.stopPropagation()},saveTitle:function(a){var b=a.currentTarget.value;b!=this.model.get("post_title")&&(this.model.set("post_title",b),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(a){27!=a.which&&13!=a.which||this.closeEditTitle()},closeEditTitle:function(){var a=this.model.get("post_title");this.$el.find(".tve-edit-title-input input").val(a),this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".group-title,.tve-edit-title").show()},globalSetting:function(a){var b=jQuery(a.currentTarget),c={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:b.attr("name"),value:b.attr("value")};b.is('input[type="checkbox"]')&&!b.is(":checked")&&(c.value=0),jQuery.post(ajaxurl,c)},clearCacheStats:function(){TVE_Dash.showLoader(),jQuery.post(ajaxurl,{action:"thrive_leads_backend_ajax",route:"clearCacheStatistics"},function(){location.reload()})},deleteConversionLogs:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DeleteConversionLogs)}}),ThriveLeads.views.TwoStepLightboxList=Backbone.View.extend({events:{"click .tve-add-two-step-lightbox":"openAddTwoStepLightbox"},initialize:function(){this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.remove)},remove:function(){0==this.collection.length&&(this.$el.find("#tve-two-step-lightbox-list").hide(),this.$el.find(".no-two-step-lightbox").show())},addOne:function(a){var b=new ThriveLeads.views.TwoStepLightboxItem({model:a,collection:this.collection});this.$el.find("#tve-two-step-lightbox-list").append(b.render().$el),this.$el.find("#tve-two-step-lightbox-list").show(),this.$el.find(".no-two-step-lightbox").hide()},render:function(){this.$el.find("#tve-two-step-lightbox-list .tvd-collection-item").empty(),this.collection.each(this.addOne,this)},openAddTwoStepLightbox:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddTwoStepLightbox,{title:ThriveLeads["const"].translations.AddTwoStepLightbox+" "+ThriveLeads["const"].translations.AddNewTwoStepLightboxVideo})}}),ThriveLeads.views.TwoStepLightboxItem=Backbone.View.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("two-step-lightbox/item"),events:{"click .tve-two-step-lightbox-delete":"deleteTwoStepLightboxPopup","click .two-step-reset":"reset","click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input input":"saveTitle","keyup .tve-edit-title-input input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .tve-leads-clear-cache":"clearCacheStats","click .tve-leads-delete-logs":"deleteConversionLogs","change .tve-setting-change":"globalSetting"},initialize:function(){this.model.on("remove",this.remove,this),this.listenTo(this.model,"change:impressions",this.render),this.listenTo(this.model,"change:post_title",this.render)},remove:function(){this.$el.remove()},render:function(){return this.$el.html(this.template({two_step_lightbox:this.model})),this.bindZclip(),TVE_Dash.materialize(this.$el),this},bindZclip:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))},deleteTwoStepLightboxPopup:function(b){var c=a(b.currentTarget);TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteTwoStepLightbox,{title:c.attr("title"),width:650,model:ThriveLeads.objects.TwoStepLightboxCollection.get(c.attr("data-id"))})},reset:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmFormTypeResetStats,{title:ThriveLeads["const"].translations.ResetFormStats,model:this.model,width:600})},showEditTitleInput:function(a){var b=this.$el.find(".group-title").hide(),c=this.$el.find(".tve-edit-title-input");c.show().children("input").val(b.text().trim()).focus().select(),jQuery(a.currentTarget).hide(),a.stopPropagation()},saveTitle:function(a){var b=a.currentTarget.value;b!=this.model.get("post_title")&&(this.model.set("post_title",b),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(a){27!=a.which&&13!=a.which||this.closeEditTitle()},closeEditTitle:function(){var a=this.model.get("post_title");this.$el.find(".tve-edit-title-input input").val(a),this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".group-title,.tve-edit-title").show()},globalSetting:function(a){var b=jQuery(a.currentTarget),c={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:b.attr("name"),value:b.attr("value")};b.is('input[type="checkbox"]')&&!b.is(":checked")&&(c.value=0),jQuery.post(ajaxurl,c)},clearCacheStats:function(){TVE_Dash.showLoader(),jQuery.post(ajaxurl,{action:"thrive_leads_backend_ajax",route:"clearCacheStatistics"},function(){location.reload()})},deleteConversionLogs:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DeleteConversionLogs)}}),ThriveLeads.views.OneClickSignupList=Backbone.View.extend({events:{"click .tve-add-one-click-signup":"openAddOneClickSignup"},initialize:function(){this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.remove)},remove:function(){0==this.collection.length&&(this.$el.find("#tve-one-click-signup-list").hide(),this.$el.find(".no-one-click-signup").show())},addOne:function(a){var b=new ThriveLeads.views.OneClickSignupItem({model:a,collection:this.collection});this.$el.find("#tve-one-click-signup-list").append(b.render().$el),this.$el.find("#tve-one-click-signup-list").show(),this.$el.find(".no-one-click-signup").hide()},render:function(){this.$el.find("#tve-one-click-signup-list .tvd-collection-item").empty(),this.collection.each(this.addOne,this)},openAddOneClickSignup:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddOneClickSignup)}}),ThriveLeads.views.OneClickSignupItem=Backbone.View.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("one-click-signup/item"),events:{"click .tve-one-click-signup-delete":"deleteOneClickSignupPopup","click .one-click-signup-reset":"reset","click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input input":"saveTitle","keyup .tve-edit-title-input input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .show-redirect-settings":"showRedirectSettings","click .show-api-connections":"showApiConnections","click .tl-copy-btn-overlay":"checkSetupsBeforeCopy"},initialize:function(){this.model.on("remove",this.remove,this),this.listenTo(this.model,"change:post_title",this.render),this.listenTo(this.model,"change:signups",this.render),this.listenTo(this.model,"change:changed_redirect_url",this.render),this.listenTo(this.model,"change:changed_connection",this.render)},remove:function(){this.$el.remove()},render:function(){return this.$el.html(this.template({one_click_signup:this.model})),this.bindZclip(),this},bindZclip:function(){var a=this.$el.find("a.tve-copy-to-clipboard");a.hasClass("tvd-disabled")||ThriveLeads.bindZClip(a)},deleteOneClickSignupPopup:function(b){var c=a(b.currentTarget);TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmDeleteOneClickSignup,{width:650,title:ThriveLeads["const"].translations.DeleteSignupSegue,model:ThriveLeads.objects.OneClickSignupCollection.get(c.attr("data-id"))})},reset:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.ConfirmFormTypeResetStats,{title:ThriveLeads["const"].translations.ResetFormStats,model:this.model,width:600})},showEditTitleInput:function(a){var b=this.$el.find(".group-title").hide(),c=this.$el.find(".tve-edit-title-input");c.show().children("input").val(b.text().trim()).focus().select(),jQuery(a.currentTarget).hide(),a.stopPropagation()},saveTitle:function(a){var b=a.currentTarget.value;b!=this.model.get("post_title")&&(this.model.set("post_title",b),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(a){27!=a.which&&13!=a.which||this.closeEditTitle()},closeEditTitle:function(){var a=this.model.get("post_title");this.$el.find(".tve-edit-title-input input").val(a),this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".group-title,.tve-edit-title").show()},showRedirectSettings:function(a){TVE_Dash.modal(ThriveLeads.views.lightbox.OneClickSignupRedirectSettings,{"max-width":"60%",model:this.model})},showApiConnections:function(b){var c=a(b.currentTarget);TVE_Dash.modal(ThriveLeads.views.lightbox.OneClickSignupApiConnections,{title:c.attr("title"),"max-width":"40%",model:this.model})},checkSetupsBeforeCopy:function(){return!1}}),ThriveLeads.views.LeadGroups=Backbone.View.extend({events:{"click .tve-add-group":"openAddGroup"},viewItems:[],initialize:function(){this.collection.off(),this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne)},removeOne:function(){0===this.collection.length&&(this.$el.find(".hide-no-groups").hide(),this.$el.find(".show-no-groups").show())},addOne:function(b,c,d){b.get("active_tests")instanceof Backbone.Collection||b.set("active_tests",new ThriveLeads.collections.Tests(b.get("active_tests"))),b.get("completed_tests")instanceof Backbone.Collection||b.set("completed_tests",new ThriveLeads.collections.Tests(b.get("completed_tests"))),this.$el.find(".hide-no-groups").show(),this.$el.find(".show-no-groups").hide();var e=new ThriveLeads.views.Group({model:b});if(this.$el.find("#tve-group-list").append(e.render().$el),this.viewItems.push(e),d&&d.add){this.$el.find(".tve-expanded .tvd-collapsible-header").trigger("click");var f=this.$el.find("#tve-lead-group-"+b.get("ID"));setTimeout(function(){a("html,body").animate({scrollTop:f.offset().top-100},1e3),f.trigger("click")},10)}},addAll:function(a){this.viewItems=[],this.$el.find("#tve-group-list").empty(),a.each(this.addOne,this)},render:function(){this.collection.length?(this.$el.find(".hide-no-groups").show(),this.$el.find(".show-no-groups").hide()):(this.$el.find(".hide-no-groups").hide(),this.$el.find(".show-no-groups").show());var a=this;return this.$el.find("#tve-group-list").sortable({placeholder:"ui-sortable-placeholder",handle:".tve-sort-handle",axis:"y",update:function(b,c){a.updateOrder()},start:function(a,b){b.item.removeClass("tve-expanded").find(".tve-form-types").hide()}}),this},updateOrder:function(){var a={};_.each(this.viewItems,function(b){b.model.get("order")!=b.$el.index()&&(b.model.set("order",b.$el.index()),a[b.model.get("ID")]=b.$el.index())}),this.collection.sort(),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"groupAPI",custom:"update_order",new_order:a}})},renderAll:function(){this.addAll(this.collection),this.render()},openAddGroup:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.AddGroup,{"max-width":"35%"})}}),ThriveLeads.views.FormTypeEdit=Backbone.View.extend({el:a("#tve-content"),template:TVE_Dash.tpl("form-type/edit"),events:{"click .tve-add-form":"addFormPopup","click .tve-start-variation-test":"startVariationTestPopup","click .tve-leads-main-php-code":"grabPHPCode","click .tve-leads-clear-cache":"clearCacheStats","click .tve-leads-delete-logs":"deleteConversionLogs","change .tve-setting-change":"globalSetting"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model.get("completed_tests"),"remove",this.render)},clear:function(){this.$el.html(""),this.delegateEvents()},grabPHPCode:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.PHPInsertCode,{
title:ThriveLeads["const"].translations.PHPInsertCode,model:this.model})},render:function(){if(ThriveLeads.objects.titleChanger.replaceFirst(this.model.get("post_title")),this.FLAG_skipListener)return void delete this.FLAG_skipListener;this.$el.html(this.template({model:this.model})),this.toggleLogic(),this.addPublished(this.model.get("variations")),this.addArchived(this.model.get("variations_archived")),this.addCompletedTests(this.model.get("completed_tests")),this.displayDetailsOfGroupModel(),ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),ThriveLeads.displayMessages();var a=new ThriveLeads.views.Breadcrumbs({collection:ThriveLeads.objects.BreadcrumbsCollection,el:"#tve-leads-breadcrumbs"});a.render(),TVE_Dash.materialize(this.$el),TVE_Dash.hideLoader()},toggleLogic:function(){0===this.model.get("variations").length&&0===this.model.get("variations_archived").length&&0===this.model.get("completed_tests").length?(this.$el.find(".tl-show-no-forms").show(),this.$el.find(".tl-hide-no-forms").hide()):(this.$el.find(".tl-show-no-forms").hide(),this.$el.find(".tl-hide-no-forms").show()),this.model.get("variations").length?(this.$el.find(".hide-no-groups").show(),this.$el.find(".show-no-groups").hide()):(this.$el.find(".hide-no-groups").hide(),this.$el.find(".show-no-groups").show()),this.$el.find("#tl-completed-tests")[this.model.get("completed_tests").length?"show":"hide"](),this.$el.find("#tl-archived-forms")[this.model.get("variations_archived").length?"show":"hide"](),window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes()},displayDetailsOfGroupModel:function(){try{var a=ThriveLeads.objects.groups.findWhere({ID:this.model.get("post_parent")});a&&a.set("details_expanded",!0)}catch(b){console.log(b.message)}},addPublishedItem:function(a){var b=new ThriveLeads.views.FormVariation({model:a,collection:this.model.get("variations")});b.has_frequency_settings=this.model.get("has_frequency_settings"),b.has_position_settings=this.model.get("has_position_settings"),b.has_animation_settings=this.model.get("has_animation_settings"),b.has_trigger_settings=this.model.get("has_trigger_settings"),b.content_locking=this.model.get("content_locking"),this.$el.find("#tve-variation-list").append(b.render().el)},addPublished:function(a){if(this.$el.find("#tve-variation-list").empty(),!(a.length<=0)){a.each(this.addPublishedItem,this),a.length>1&&1===this.$el.find(".tve-start-variation-test").length&&this.$el.find(".tve-start-variation-test").show();try{if(this.model.get("post_type")===ThriveLeads["const"].tve_leads_post_form_type){var b=ThriveLeads.objects.groups.findWhere({ID:this.model.get("post_parent")}).get("form_types").findWhere({ID:this.model.get("ID")}).get("variations");b.reset(this.model.get("variations").toJSON())}}catch(c){console.log(c.message)}}},addArchivedItem:function(a){var b=new ThriveLeads.views.FormVariation({model:a});b.has_frequency_settings=this.model.get("has_frequency_settings"),b.has_position_settings=this.model.get("has_position_settings"),b.has_animation_settings=this.model.get("has_animation_settings"),b.has_trigger_settings=this.model.get("has_trigger_settings"),b.content_locking=this.model.get("content_locking"),this.$el.find("#tve-archive-list").append(b.render().el)},addArchived:function(a){a.length<=0||(this.$el.find("#tve-archive-list").empty(),a.each(this.addArchivedItem,this))},addCompletedTestItem:function(a){var b=new ThriveLeads.views.CompletedTestItem({model:a});this.$el.find("#tve-completed-test-list").append(b.render().el)},addCompletedTests:function(a){a.length<=0||(this.$el.find("#tve-completed-test-list .tvd-collapsible-body").empty(),a.each(this.addCompletedTestItem,this))},addFormPopup:function(a){TVE_Dash.modal(ThriveLeads.views.lightbox.AddForm,{title:ThriveLeads["const"].translations.AddNewForm+" "+ThriveLeads["const"].translations.AddNewFormVideo,model:new Backbone.Model({state:"add",form_type_id:this.model.get("ID"),group_id:this.model.get("post_parent"),form_variation:{},post_type:this.model.get("post_type"),content_locking:this.model.get("content_locking")})})},markRowErrors:function(a){var b=this;_.each(a,function(a){b.$el.find("#variation-key-"+a).parents("tr").first().addClass("tve-form-no-content")})},startVariationTestPopup:function(a){var b=this;this.$el.find("tr").removeClass("tve-form-no-content"),TVE_Dash.showLoader(),this.model.ajaxGetEmptyVariations().done(function(a){var c=a.ids?a.ids:[];return c.length?(TVE_Dash.err(ThriveLeads["const"].translations.MissingFormContent,ThriveLeads["const"].toast_timeout),void b.markRowErrors(c)):void TVE_Dash.modal(ThriveLeads.views.lightbox.VariationTest,{title:ThriveLeads["const"].translations.StartVariationTest+" "+ThriveLeads["const"].translations.StartVariationTestVideo,model:b.model,width:700})}).fail(function(a,b,c){}).always(function(){TVE_Dash.hideLoader()})},globalSetting:function(a){var b=jQuery(a.currentTarget),c={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:b.attr("name"),value:b.attr("value")};b.is('input[type="checkbox"]')&&!b.is(":checked")&&(c.value=0),jQuery.post(ajaxurl,c)},clearCacheStats:function(){TVE_Dash.showLoader(),jQuery.post(ajaxurl,{action:"thrive_leads_backend_ajax",route:"clearCacheStatistics"},function(){location.reload()})},deleteConversionLogs:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DeleteConversionLogs)}}),ThriveLeads.views.Test=Backbone.View.extend({el:a("#tve-content"),template:TVE_Dash.tpl("tests/view"),events:{"click .tve-leads-clear-cache":"clearCacheStats","click .tve-leads-delete-logs":"deleteConversionLogs","change .tve-setting-change":"globalSetting"},render:function(){var a=this;if(ThriveLeads.objects.titleChanger.replaceFirst(this.model.get("title")),this.$el.html(this.template({test:this.model})),this.renderItems(),this.renderChart(),this.model.get("status")===ThriveLeads["const"].test_status.running&&this.renderOptions(),this.model.get("test_type")===ThriveLeads["const"].group_test_type)this.displayDetailsOfGroupModel(this.model.get("main_group_id"));else{var b=this.model.get("items").length?this.model.get("items").first().get("main_group_id"):0;this.displayDetailsOfGroupModel(b)}window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes(),void 0!==this.collection&&this.collection instanceof ThriveLeads.collections.Tests&&(this.listenTo(this.collection,"add",this.addCompletedTestItem),this.collection.fetch({url:ThriveLeads.ajaxurl("action=thrive_leads_backend_ajax&route=completedTests&id="+this.model.get("main_group_id")),success:function(){a.$el.find("#tl-completed-tests-count").html("("+a.collection.length+")"),0===a.collection.length&&a.$el.find("#tve-completed-test-list").html('<li class="tvd-collection-item">'+ThriveLeadsConst.translations.NoTestCompleted+"</li>"),a.$el.find("#tl-completed-tests").slideDown(200)}})),TVE_Dash.materialize(this.$el)},addCompletedTestItem:function(a){var b=new ThriveLeads.views.CompletedTestItem({model:a});this.$el.find("#tve-completed-test-list").append(b.render().el)},renderOptions:function(){var a=new ThriveLeads.views.TestOptions({model:this.model,collection:this.model.get("items"),el:this.$el.find("#tve-test-options")});a.render()},renderChart:function(){var a=new ThriveLeads.models.TestChartModel({ID:this.model.get("id"),start_date:this.model.get("date_started"),interval:"day"}),b=new ThriveLeads.views.TestChartView({model:a,el:this.$el.find(".tve-chart-interval")});b.drawCandleStick(this.model.get("items"),"tve-candle-stick-chart"),this.model.get("stopped_items").length>0&&b.drawCandleStick(this.model.get("stopped_items"),"tve-candle-stick-chart-stopped"),a.fetch()},renderItems:function(){if(this.model.get("items")&&!(this.model.get("items").length<=0)){this.model.get("items")instanceof Backbone.Collection||this.model.set("items",new ThriveLeads.collections.TestItems(this.model.get("items"))),this.displayNoDataOverlay(this.model.get("items"));var a=new ThriveLeads.views.TestItemList({model:this.model,collection:this.model.get("items"),el:this.$el.find("#tve-form-test-items")});a.render();var b=new ThriveLeads.views.TestItemsTotals({model:this.model,collection:this.model.get("items"),el:this.$el.find("#tve-test-items-total")});if(b.render(),this.model.get("stopped_items")&&!(this.model.get("stopped_items").length<=0)){this.model.get("stopped_items")instanceof Backbone.Collection||this.model.set("stopped_items",new ThriveLeads.collections.TestItems(this.model.get("stopped_items")));var c=new ThriveLeads.views.TestStoppedItemList({model:this.model,collection:this.model.get("stopped_items"),el:this.$el.find("#tve-form-test-stopped-items")});c.render()}}},displayDetailsOfGroupModel:function(a){try{var b=ThriveLeads.objects.groups.findWhere({ID:parseInt(a)});b&&b.set("details_expanded",!0)}catch(c){console.log(c.message)}},displayNoDataOverlay:function(a){var b=!0;a.each(function(a){return parseInt(a.get("unique_impressions"))>0?void(b=!1):void 0}),b?this.$el.find(".tve-chart-overlay").show():this.$el.find(".tve-chart-overlay").hide()},globalSetting:function(a){var b=jQuery(a.currentTarget),c={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:b.attr("name"),value:b.attr("value")};b.is('input[type="checkbox"]')&&!b.is(":checked")&&(c.value=0),jQuery.post(ajaxurl,c)},clearCacheStats:function(){TVE_Dash.showLoader(),jQuery.post(ajaxurl,{action:"thrive_leads_backend_ajax",route:"clearCacheStatistics"},function(){location.reload()})},deleteConversionLogs:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.DeleteConversionLogs)}}),ThriveLeads.views.CompletedTestItem=Backbone.View.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("tests/completed-test-item"),events:{"click .tve-form-type-test-delete":"deleteTest"},render:function(){return this.$el.html(this.template({test:this.model})),this},deleteTest:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.confirmDeleteTest,{title:ThriveLeads["const"].translations.DeleteTest,model:this.model})}}),ThriveLeads.views.ActiveTestItem=Backbone.View.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("tests/active-test-item"),render:function(){return this.$el.html(this.template({test:this.model})),this}}),ThriveLeads.views.TestChartView=Backbone.View.extend({events:{"change #tve-chart-interval-select":"intervalChanged"},currentInterval:"day",initialize:function(){this.createChart();var a=this;this.listenTo(this.model,"change:interval",function(){a.model.fetch()}),this.listenTo(this.model,"change",this.updateChart)},intervalChanged:function(){var a=this.$el.find("#tve-chart-interval-select").val();a!=this.currentInterval&&(this.currentInterval=a,"undefined"!=typeof this.chart&&this.chart.showLoading(),this.model.set("interval",a))},updateChart:function(){this.chart.set("data",this.model.get("chart_data")),this.chart.set("title",this.model.get("chart_title")),this.chart.set("x_axis",this.model.get("chart_x_axis")),this.chart.set("y_axis",this.model.get("chart_y_axis")),this.chart.redraw()},createChart:function(){this.chart=new ThriveLeads.LineChart({title:"",data:[],renderTo:"tve-test-chart"}),this.chart.showLoading()},drawCandleStick:function(a,b){if(a&&a.length){var c=a.getCandleStickData();this.bar_chart=new ThriveLeads.BarChart({title:"",data:c.chartData,colors:c.chartColors,renderTo:b})}}}),ThriveLeads.views.TestItemList=Backbone.View.extend({addOne:function(a,b){var c=ThriveLeads["const"].CHART_COLORS[a.get("index")%ThriveLeads["const"].CHART_COLORS.length];a.set("show_graph",!0),a.set("index",b),a.set("parent_test_running",this.model.isRunning()),a.set("color",c);var d=new ThriveLeads.views.TestItem({model:a});this.$el.append(d.render().el)},addAll:function(a){a.each(this.addOne,this)},render:function(){return this.addAll(this.collection),this}}),ThriveLeads.views.TestItem=Backbone.View.extend({events:{"click .tve-stop-test-variation-modal":"stopTestVariationModal"},tagName:"tr",className:"tvd-collection-item",template:TVE_Dash.tpl("tests/item"),initialize:function(a){this.highest_id=a.highest_id},stopTestVariationModal:function(a){TVE_Dash.modal(ThriveLeads.views.lightbox.StopVariation,{model:this.model,"max-width":"60%",width:450})},render:function(){return this.$el.html(this.template({item:this.model})),this.highest_id===this.model.get("id")&&this.$el.addClass("highlight"),this}}),ThriveLeads.views.TestStoppedItemList=Backbone.View.extend({addOne:function(a,b){var c=ThriveLeads["const"].CHART_COLORS[a.get("index")%ThriveLeads["const"].CHART_COLORS.length];a.set("show_graph",!0),a.set("index",b),a.set("parent_test_running",this.model.isRunning()),a.set("color",c);var d=new ThriveLeads.views.TestStoppedItem({model:a});this.$el.append(d.render().el)},addAll:function(a){a.each(this.addOne,this)},render:function(){return this.addAll(this.collection),this}}),ThriveLeads.views.TestStoppedItem=Backbone.View.extend({tagName:"tr",className:"tvd-collection-item tvd-gray tvd-tooltipped",template:TVE_Dash.tpl("tests/stopped-item"),initialize:function(a){this.$el.attr("data-tooltip",ThriveLeads["const"].translations.stoppedVariationRowTooltip+" "+this.model.get("stopped_date")).attr("data-position","top"),this.highest_id=a.highest_id},render:function(){return this.$el.html(this.template({item:this.model})),this.highest_id===this.model.get("id")&&this.$el.addClass("highlight"),this}}),ThriveLeads.views.TestItemsTotals=Backbone.View.extend({events:{"click .tve-edit-test":"editTest"},template:TVE_Dash.tpl("tests/totals"),initialize:function(){this.listenTo(this.model,"auto_win_changed",_.bind(this.render,this))},render:function(){this.$el.html(this.template({totals:this.collection.getTotals(),test:this.model}))},editTest:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.EditVariationTest,{title:ThriveLeads["const"].translations.AutomaticWinnerSettings,model:this.model})}}),ThriveLeads.views.TestOptions=Backbone.View.extend({template:TVE_Dash.tpl("tests/options"),events:{"click .tve-stop-test":"stopTest"},stopTest:function(){TVE_Dash.modal(ThriveLeads.views.lightbox.StopVariationTest,{title:ThriveLeads["const"].translations.ChooseWinner,width:1230,"max-width":"90%",model:this.model,collection:this.collection})},render:function(){this.$el.append(this.template(this.model.toJSON()))}}),ThriveLeads.views.FiltersView=ThriveLeads.views.Base.extend({className:"tve_leads_filtersContainer",events:{"click .tve_leads_tabFilter":function(a){this.filterClicked(jQuery(a.target))}},initialize:function(){},render:function(){var a=this;_.each(this.collection.models,function(b){a.renderFilter(b)})},renderFilter:function(a){var b=TVE_Dash.tpl("groups/settings/filter",a.toJSON());this.$el.append(b)},filterClicked:function(a){this.$el.find(".tve_leads_tabFilter").removeClass("selected"),a.addClass("selected"),_.each(this.$el.parent().find(".tve_leads_optionContainer,.tve_leads_tab_content_toggle"),function(b){var c=jQuery(b);c.children("label").data("type")===a.attr("id")?c.show():c.hide()}),this.renderSelectedFilter(a.text())},renderSelectedFilter:function(a){var b=this.$el.next(".tve_leads_selectedFilter");b.length&&b.remove();var c=TVE_Dash.tpl("groups/settings/selected_filter",{filter:a});this.$el.after(c)}}),ThriveLeads.views.OptionView=ThriveLeads.views.Base.extend({className:"tve_leads_optionContainer tvd-col tvd-s6 tvd-m6 tvd-l2",events:{"click .tve_leads_toggle_option":"toggle","click .tve_leads_removeDirectLink":"removeLink"},initialize:function(){this.listenTo(this.model,"change:isChecked",this.isCheckedChanged)},render:function(){var a;"direct_url"===this.model.get("type")?(this.$el.removeClass("tvd-l2"),a=TVE_Dash.tpl("groups/settings/direct_url",this.model.toJSON())):a=TVE_Dash.tpl("groups/settings/option",this.model.toJSON()),"item_page"===this.model.get("type")&&this.$el.removeClass("tvd-l2").addClass("tvd-l3"),this.$el.append(a)},toggle:function(){this.model.toggle()},isCheckedChanged:function(){this.$el.find('input[type="checkbox"]').prop("checked",this.model.get("isChecked"))},removeLink:function(){this.model.collection.remove(this.model)}}),ThriveLeads.views.tab_custom_views={_autocomplete:function(a,b,c){a.autocomplete({appendTo:a.parent(),minLength:2,delay:200,source:function(a,c){jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"thrive_leads_backend_ajax",route:b,q:a.term,tax:"post_tag"}}).done(function(a){c(a)})},select:c})},taxonomy_terms:Backbone.View.extend({template:TVE_Dash.tpl("groups/settings/tags_filter"),render:function(a){var b=this;return this.$el.html(this.template(this.model.attributes)),this.$el.addClass("tve_leads_tab_content_toggle").hide(),ThriveLeads.views.tab_custom_views._autocomplete(this.$el.find(".tve-leads-autocomplete"),"tagSearch",function(a,c){return b.model.get("options").add({isChecked:!0,type:"post_tag",id:c.item.id,label:c.item.label}),this.value="",!1}),a.find(".tve_leads_selectedFilter").after(this.$el),this}}),posts:Backbone.View.extend({template:TVE_Dash.tpl("groups/settings/posts_filter"),render:function(a){var b=this;this.$el.html(this.template(this.model.attributes)),ThriveLeads.views.tab_custom_views._autocomplete(this.$el.find(".tve-leads-autocomplete"),"postSearch",function(a,c){return b.model.get("options").add({isChecked:!0,type:"",id:c.item.id,label:c.item.label}),this.value="",!1}),a.find(".tab-content-title").after(this.$el)}})},ThriveLeads.views.TabContentView=ThriveLeads.views.Base.extend({actionContainerClass:"tve_leads_actionContainer",actionDefaultClass:"tvd-btn-flat tvd-btn-flat-dark tvd-waves-effect",className:"tvd-row",events:{"click .selectAll":"checkAll","click .selectNone":"checkNone","click .tve_leads_addDirectLink":"addDirectLinkClicked","keypress .tve_leads_directUrl":"addDirectLinkClicked"},initialize:function(){this.listenTo(this.model.get("options"),"add",function(a){this.renderOptions(a.get("type")),this.model.trigger("change",this.model)}),this.listenTo(this.model.get("options"),"remove",function(){this.renderOptions(),this.model.trigger("change",this.model)})},renderOthersTab:function(){this.$el.attr("id",this.model.getTabIdFromIdentifier()).append('<h5 class="tab-content-title">'+ThriveLeads["const"].translations.VisitorStatus+"</h5>").append('<div class="tl-visitor-status clearfix"></div>').append('<div class="clear"></div><h5 class="tab-second-title">'+ThriveLeads["const"].translations.DirecURL+"</h5>").append('<div class="tl-direct-urls tvd-row tve_leads_tab_content_direct_urls clearfix"></div>'),this.renderOptionsOthers(),this.renderAddDirectUrlForm()},renderOptionsOthers:function(){this.$el.find(".tl-visitor-status").empty(),this.$el.find(".tl-direct-urls").empty();var a=this;_.each(this.model.get("options").models,function(b){var c="direct_url"==b.get("type")?a.$el.find(".tl-direct-urls"):a.$el.find(".tl-visitor-status");b.set("base_id",a.model.getTabIdFromIdentifier());var d=new ThriveLeads.views.OptionView({model:b});c.append(d.el),d.render(),b.on("change:isChecked",function(){a.model.trigger("change")})})},render:function(){return"others"===this.model.get("identifier")?this.renderOthersTab():(this.$el.append('<span class="tab-content-title"></span>').attr("id",this.model.getTabIdFromIdentifier()),this.renderActions(),this.renderOptions(),this.renderFilters(),void this.renderCustomHtml())},renderCustomHtml:function(){if(ThriveLeads.views.tab_custom_views[this.model.get("identifier")]){var a=new(ThriveLeads.views.tab_custom_views[this.model.get("identifier")])({model:this.model});a.render(this.$el)}},renderOptions:function(a){if("others"===this.model.get("identifier"))return this.renderOptionsOthers();this.$el.find(".tve_leads_optionContainer").remove();var b=this;_.each(this.model.get("options").models,function(c){b.renderOption(c,a),c.on("change:isChecked",function(){b.model.trigger("change",b.model)})})},renderOption:function(a,b){a.set("base_id",this.model.getTabIdFromIdentifier());var c=new ThriveLeads.views.OptionView({model:a});this.$el.append(c.el),c.render(),b&&a.get("type")!=b&&c.$el.hide()},renderActions:function(){if(this.model.get("actions").length){var a=jQuery('<div class="'+this.actionContainerClass+' tve_leads_clearfix" />'),b=this;this.$el.append(a),this.model.get("actions").length&&_.each(this.model.get("actions"),function(a){b.$el.find("."+b.actionContainerClass).append('<a class="'+b.actionDefaultClass+" "+a.cssClass+'" href="javascript:void(0)">'+a.label+"</a>")})}},renderFilters:function(){if(this.model.get("filters").length){var a=new ThriveLeads.views.FiltersView({model:this.model,collection:this.model.get("filters")});a.render(),this.$el.find(".tab-content-title").after(a.el),a.filterClicked(a.$el.children().first())}},renderAddDirectUrlForm:function(){var a=TVE_Dash.tpl("groups/settings/add_direct_url_form",{});this.$el.append(a)},checkAll:function(){_.each(this.model.get("options").models,function(a){a.check()})},checkNone:function(){_.each(this.model.get("options").models,function(a){a.uncheck()})},addDirectLinkClicked:function(a){if("keypress"!==a.type||13===a.which){var b=jQuery(a.target),c=b.parents(".tvd-add-link-row"),d=c.find("input");this.model.get("options").add({id:d.val().trim(),label:d.val().trim(),type:"direct_url"},{validate:!0}),d.val("")}}}),ThriveLeads.views.TabLabelView=ThriveLeads.views.Base.extend({template:TVE_Dash.tpl("groups/settings/tab_label"),activeClass:"tve_leads_active_tab",className:"tvd-tab",tagName:"li",events:{},render:function(){this.$el.html(this.template({tab:this.model}))}}),ThriveLeads.views.HangerView=ThriveLeads.views.Base.extend({template:TVE_Dash.tpl("groups/settings/hanger"),initialize:function(){},render:function(){var a=this.template(this.model.toJSON()),b=this;this.$el.html(a),this.$tabLabelsContainer=this.$el.find(".tve_leads_tabs"),this.$tabContentsContainer=this.$el.find(".tve_leads_tabs_wrapper"),_.each(this.model.get("tabs").models,function(a){a.set("exclusion",b.model.get("identifier").indexOf("hide")>=0);var c=b.renderTabLabels(a),d=b.renderTabContent(a);a.on("change:isActive",_.bind(b.activateTab,b,c,d)),a.on("change",_.bind(function(){"hide_group_options"===this.model.get("identifier")?jQuery("#exclusions-count").html("("+this.model.countCheckedOptions()+")"):jQuery("#inclusions-count").html("("+this.model.countCheckedOptions()+")")},b,a))}),this.model.get("tabs").at(0).set("isActive",!0)},renderTabLabels:function(a){var b=new ThriveLeads.views.TabLabelView({model:a});return this.$tabLabelsContainer.append(b.el),b.render(),b},renderTabContent:function(a){var b=new ThriveLeads.views.TabContentView({model:a});return this.$tabContentsContainer.append(b.el),b.render(),b},activateTab:function(a,b,c,d){this.$tabLabelsContainer.find("li").removeClass(a.activeClass).find("a").removeClass("tvd-active"),this.$tabContentsContainer.find(".tve_leads_tabs_content").hide(),a.$el.addClass(a.activeClass).find("> a").addClass("tvd-active"),b.$el.show(),c.attributes.isActive=!1}}),ThriveLeads.views.DisplayGroupSettings=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("groups/settings/group_settings"),events:{"click .tve_leads_save_widget_options":"saveOptions","click .tve_leads_add_new_template":"saveTemplate","click .tve_leads_load_saved_options":"loadTemplate","click .tl-toggle-tab-display":"toggleTabDisplay"},toggleTabDisplay:function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed"),d=jQuery(b.data("target"));c?d.hide(0).removeClass("tvd-not-visible").slideDown(200):d.slideUp(200,function(){d.addClass("tvd-not-visible")}),b.toggleClass("collapsed"),b.toggleClass("hover")},afterRender:function(){var a=ThriveLeads.objects.groups.get(parseInt(this.group));ThriveLeads.objects.titleChanger.replaceFirst(a.get("post_title")+" "+ThriveLeads["const"].translations.DisplayGroupSettings),this.$templatesList=this.$el.find(".tve_leads_saved_options");var b=this;_.each(this.collection.models,function(a){b.renderHangerView(a)}),this.$el.addClass("tvd-modal-fixed-footer tvd-modal-display-settings"),this.renderTemplatesList()},onClose:function(){},_render:function(){if(this.$el.html(this.template()),this.data.title){var b=this.$el.find("h3.tvd-modal-title");b.length||(b=a('<h3 class="tvd-modal-title"></h3>'),this.$el.find(".tvd-modal-content").prepend(b)),b.html(this.data.title)}this.afterRender(),TVE_Dash.materialize(this.$el)},renderHangerView:function(a){var b=new ThriveLeads.views.HangerView({model:a,el:jQuery("#"+a.get("identifier"))});b.render()},renderTemplatesList:function(){var b=this,c=ThriveLeads.objects.savedTemplates.size()>1;this.$templatesList.data("select2")&&this.$templatesList.data("select2").destroy(),this.$templatesList.find("optgroup, option").each(function(b){b>0&&a(this).remove()}),_.each(ThriveLeads.objects.savedTemplates.get("template_groups"),function(d){if(0===d.size())return!0;var e=a('<optgroup label="'+d.group_name+'"></optgroup>');d.each(function(a){(c?e:b.$templatesList).append('<option value="'+a.get("id")+'">'+a.get("name")+"</option>")}),c&&b.$templatesList.append(e)}),this.$templatesList.select2()},loadTemplate:function(){if(""===this.$templatesList.val())return this.collection=ThriveLeads.objects.hangers,void this._render();var a=ThriveLeads.objects.savedTemplates.get_template({id:this.$templatesList.val()}),b=this;TVE_Dash.showLoader(),jQuery.ajax({url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"loadGroupTemplate",group:this.group,template_id:this.$templatesList.val()}}).done(function(c){b.collection.reset(c),b._render(),TVE_Dash.success(a.get("name")+" "+ThriveLeads["const"].translations.DisplaySettingsTemplateLoaded),TVE_Dash.hideLoader()})},saveOptions:function(b){var c={options:[JSON.stringify(this.collection.at(0).getDataForSave()),JSON.stringify(this.collection.at(1).getDataForSave())],group:this.group},d=a(b.target),e=d.html(),f=this;TVE_Dash.showLoader(),this.btnLoading(d),a.ajax({url:this.urlSaveOptions,type:"post",dataType:"json",data:c,success:function(a){return a.success?(_.each(ThriveLeads.objects.groups.models,function(a){return a.get("ID")==f.group?void a.set("has_display_settings",1):void 0}),void f.close()):void TVE_dash.err(a.message?a.message:ThriveLeads["const"].translations.GeneralError)},error:function(a,b,c){TVE_Dash.err(ThriveLeads["const"].translations.GeneralError+" ( Error info: <strong>"+c+"</strong> )")},complete:function(){d.html(e).attr("disabled",!1)}})},saveTemplate:function(b){var c=a("input[name='tve_leads_new_template_name']"),d=this;if(!c.val().trim().length){"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer);var e=a('<p class="tve-error" style="display: none"></p>');return e.html(ThriveLeads["const"].translations.PleaseSelectANameForYourTemplate),c.addClass("tvd-invalid").before(e),e.show(),c.focus(),void(testErrortimer=setTimeout(function(){d.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),d.$el.find("input").removeClass("tvd-invalid")},5e3))}var f={name:c.val().trim(),options:[JSON.stringify(this.collection.at(0).getDataForSave()),JSON.stringify(this.collection.at(1).getDataForSave())]},g=!1;ThriveLeads.objects.savedTemplates.name_exists(f.name,"TL")&&(g=!confirm('"'+f.name+'" template already exists. Do you want to overwrite it ?')),g||(TVE_Dash.showLoader(),a.ajax({type:"post",dataType:"json",data:f,url:this.urlSaveTemplate,success:function(b){return b.success?(c.val(""),ThriveLeads.objects.savedTemplates=new ThriveLeads.models.TemplateList(b.templates),d.$templatesList.find("option").each(function(){a(this).text()===f.name&&a(this).attr("selected","selected")}),d.renderTemplatesList(),void TVE_Dash.success(ThriveLeads["const"].translations.DisplaySettingsTemplateSaved)):void TVE_Dash.err(b.message?b.message:ThriveLeads["const"].translations.GeneralError)},error:function(a,b,c){TVE_Dash.err(ThriveLeads["const"].translations.GeneralError+" ( Error info: <strong>"+c+"</strong> )")},complete:function(){TVE_Dash.hideLoader()}}))}}),ThriveLeads.views.Breadcrumbs=Backbone.View.extend({initialize:function(){this.listenTo(this.collection,"add",this.render)},render:function(){var a=this.collection.at(this.collection.length-1);return a.set({last:1}),this.$el.empty(),this.collection.each(this.renderOne,this),this},renderOne:function(a){var b=new ThriveLeads.views.Breadcrumb({model:a}),c=b.render().$el;this.$el.append(c)}}),ThriveLeads.views.Breadcrumb=Backbone.View.extend({tagName:"li",className:"tvd-breadcrumb",template:TVE_Dash.tpl("breadcrumbs/item"),events:{},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),ThriveLeads.views.TriggerSettings=TVE_Dash.views.Modal.extend({events:{"change #trigger-type":"triggerChange","click .tve-save-trigger":"triggerSave"},model:null,$trigger_type:null,afterRender:function(){this.model=ThriveLeads.objects.current_variation,this.$trigger_type=this.$el.find("#trigger-type")},triggerChange:function(a){this.$el.find(".trigger-settings").hide(0).filter("#trigger-settings-"+this.$trigger_type.val()).show(0)},onClose:function(){"shortcode"===this.model.get("tve_form_type")?ThriveLeads.router.navigate("#shortcode/"+this.data.form_type_id,{trigger:!0}):"two_step_lightbox"===this.model.get("tve_form_type")?ThriveLeads.router.navigate("#2step-lightbox/"+this.data.form_type_id,{trigger:!0}):ThriveLeads.router.navigate("#form-type/"+this.data.form_type_id,{trigger:!0})},triggerSave:function(b){this.model.set({trigger:this.$trigger_type.val(),trigger_config:this.collect_config()}),this.btnLoading(b.currentTarget),TVE_Dash.showLoader(),this.model.save({},{success:function(){a(".tvd-modal-close").click()}})},collect_config:function(){var a={};return this.$el.find("#trigger-settings-"+this.$trigger_type.val()).find(".trigger-config").each(function(){var b=jQuery(this);b.attr("disabled")||(a[b.attr("name")]=b.is("input[type=checkbox]")?b.is(":checked")?b.val():"":b.val())}),a}}),ThriveLeads.views.PositionSettings=TVE_Dash.views.Modal.extend({events:{"click .tve-save-position":"positionSave"},model:null,positionSave:function(a){var b=this;this.model.set({position:this.$el.find("#variation-position-settings").val()}),this.btnLoading(a.currentTarget),TVE_Dash.showLoader(),b.close(),this.model.save({},{success:function(){}})},afterRender:function(){this.model=ThriveLeads.objects.position_settings_model},onClose:function(){"shortcode"===this.model.get("tve_form_type")?ThriveLeads.router.navigate("#shortcode/"+this.data.form_type_id,{trigger:!0}):"two_step_lightbox"===this.model.get("tve_form_type")?ThriveLeads.router.navigate("#2step-lightbox/"+this.data.form_type_id,{trigger:!0}):ThriveLeads.router.navigate("#form-type/"+this.data.form_type_id,{trigger:!0})}}),ThriveLeads.views.MessagesList=Backbone.View.extend({className:"messagesList",render:function(){var a=this;return this.collection.each(function(b){a.$el.append(a.renderMessage(b))}),this},renderMessage:function(a){return TVE_Dash.tpl("messages/item",{message:a})}}),ThriveLeads.views.lightbox={EditVariationTest:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/edit-variation-test"),events:{"click .tve-edit-variation-test":"saveTest","blur #auto_win_min_conversions":"checkMinimumConversions","blur #auto_win_min_duration":"checkMinimumDuration","blur #auto_win_chance_original":"checkChanceToBeatOriginal","change #tve-enable-test-settings":"toggleAutoWinSettings"},checkMinimumConversions:function(a){var b=jQuery(a.currentTarget);parseInt(b.val())<100?this.$el.find(".tve_engagements_notice").removeClass("tvd-hide"):this.$el.find(".tve_engagements_notice").addClass("tvd-hide")},checkMinimumDuration:function(a){var b=jQuery(a.currentTarget);parseInt(b.val())<7?this.$el.find(".tve_duration_notice").removeClass("tvd-hide"):this.$el.find(".tve_duration_notice").addClass("tvd-hide")},checkChanceToBeatOriginal:function(a){var b=jQuery(a.currentTarget);parseFloat(b.val())<90?this.$el.find(".tve_beat_original_notice").removeClass("tvd-hide"):this.$el.find(".tve_beat_original_notice").addClass("tvd-hide")},saveTest:function(a){var b=this,c=jQuery(a.target);this.model.set("auto_win_enabled",this.$el.find("input[name='auto_win_enabled']").is(":checked")),
this.model.set("auto_win_min_conversions",this.$el.find('input[name="auto_win_min_conversions"]').val()),this.model.set("auto_win_min_duration",this.$el.find('input[name="auto_win_min_duration"]').val()),this.model.set("auto_win_chance_original",this.$el.find('input[name="auto_win_chance_original"]').val()),this.model.on("invalid",function(a,c){b.showErrors(a,c)}),this.model.isValid()&&(this.model.trigger("auto_win_changed"),c.html(ThriveLeads["const"].translations.Loading).removeClass("tve-edit-variation-test"),this.btnLoading(c),TVE_Dash.showLoader(),this.model.save({},{success:function(){b.close(),TVE_Dash.hideLoader()}}))},showErrors:function(a,b){var c=this;"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),c.$el.find(".tve-error, .tve-block-error, .tve-error-message").remove(),_.each(b,function(a,b){if("auto_win_min_conversions"===b){var d=jQuery('<p class="tve-error" style="display: none"></p>');d.html(a),c.$el.find('input[name="auto_win_min_conversions"]').addClass("tve-leads-input-error").before(d),d.show()}if("auto_win_min_duration"===b){var d=jQuery('<p class="tve-error" style="display: none"></p>');d.html(a),c.$el.find('input[name="auto_win_min_duration"]').addClass("tve-leads-input-error").before(d),d.show()}if("auto_win_chance_original"===b){var d=jQuery('<p class="tve-error" style="display: none"></p>');d.html(a),c.$el.find('input[name="auto_win_chance_original"]').addClass("tve-leads-input-error").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)},toggleAutoWinSettings:function(a){var b=jQuery(a.currentTarget);b.is(":checked")?this.$el.find(".tve-winner-settings-input").show(0):this.$el.find(".tve-winner-settings-input").hide(0),setTimeout(ThriveLeads.resize_thickbox,0)}}),StopVariationTest:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/stop-variation-test"),events:{"click .tve-test-item-winner":"setWinner"},afterRender:function(){this.$el.addClass("tvd-stop-test-modal");var a=this.$el.find("#tve-stop-variation"),b=this,c=b.collection.getHighestRateItem();return a.empty(),this.collection.each(function(b){b.set("show_graph",!1);var d=new ThriveLeads.views.TestItem({model:b,highest_id:c});a.append(d.render().el)}),this},setWinner:function(a){a.preventDefault();var b=this,c=jQuery(a.target).parent(),d=this.collection.get(parseInt(c.data("test-item-id")));this.btnLoading(c),TVE_Dash.showLoader(),d.set("is_winner",!0),d.save({},{success:function(a,c){if(b.model.get("test_type")==ThriveLeads["const"].group_test_type)ThriveLeads.addMessage({text:ThriveLeads["const"].translations.SetWinnerGroupMessage}),ThriveLeads.objects.groups=new ThriveLeads.collections.Groups(c),ThriveLeads.objects.groups.findWhere({ID:parseInt(a.get("main_group_id"))}).set("details_expanded",!0),ThriveLeads.router.navigate("#dashboard",{trigger:!0});else if(b.model.get("test_type")==ThriveLeads["const"].shortcode_test_type)ThriveLeads.addMessage({text:ThriveLeads["const"].translations.SetWinnerShortcodeMessage}),ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(d.get("main_group_id"))}).set("active_test",null),ThriveLeads.router.navigate("#shortcode/"+d.get("main_group_id"),{trigger:!0});else if(b.model.get("test_type")==ThriveLeads["const"].two_step_lightbox_test_type)ThriveLeads.addMessage({text:ThriveLeads["const"].translations.SetWinnerTwoStepLightboxMessage}),ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(d.get("main_group_id"))}).set("active_test",null),ThriveLeads.router.navigate("#2step-lightbox/"+d.get("main_group_id"),{trigger:!0});else{ThriveLeads.addMessage({text:ThriveLeads["const"].translations.SetWinnerFormTypeMessage});var e=ThriveLeads.objects.groups.findWhere({ID:parseInt(d.get("main_group_id"))}).get("form_types").findWhere({ID:parseInt(d.get("form_type_id"))});e.set("active_test",new ThriveLeads.models.Test),ThriveLeads.router.navigate("#form-type/"+d.get("form_type_id"),{trigger:!0})}},complete:function(a){b.close()}}),TVE_Dash.showLoader()}}),VariationTest:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/variation-test"),events:{"click .tve-toggle-dropdown":"toggleSettings","click #tve-enable-test-settings":"toggleProperties","click .tve-start-variation-test":"addTest","blur #auto_win_min_conversions":"checkMinimumConversions","blur #auto_win_min_duration":"checkMinimumDuration","blur #auto_win_chance_original":"checkChanceToBeatOriginal","click .tve-redirect-to-form-type":"toFormType"},checkMinimumConversions:function(a){var b=jQuery(a.currentTarget);parseInt(b.val())<100?this.$el.find(".tve_engagements_notice").removeClass("tvd-hide"):this.$el.find(".tve_engagements_notice").addClass("tvd-hide")},checkMinimumDuration:function(a){var b=jQuery(a.currentTarget);parseInt(b.val())<7?this.$el.find(".tve_duration_notice").removeClass("tvd-hide"):this.$el.find(".tve_duration_notice").addClass("tvd-hide")},checkChanceToBeatOriginal:function(a){var b=jQuery(a.currentTarget);parseFloat(b.val())<90?this.$el.find(".tve_beat_original_notice").removeClass("tvd-hide"):this.$el.find(".tve_beat_original_notice").addClass("tvd-hide")},afterRender:function(){this.$el.addClass("tvd-animation-modal")},renderFormTypes:function(){var a=this.$el.find("#tve-form-types-list"),b=a.find(".tvd-row");a.show();var c=TVE_Dash.tpl("form-type/checkbox");this.model.get("form_types").each(function(a){b.append(c({form:a,active_test:a.get("active_test").toJSON()}))})},addTest:function(){var a=this,b=new ThriveLeads.models.Test({title:this.$el.find('input[name="test_title"]').val(),notes:this.$el.find('textarea[name="test_notes"]').val(),auto_win_enabled:this.$el.find("input[name='auto_win_enabled']").is(":checked"),auto_win_min_conversions:this.$el.find('input[name="auto_win_min_conversions"]').val(),auto_win_min_duration:this.$el.find('input[name="auto_win_min_duration"]').val(),auto_win_chance_original:this.$el.find('input[name="auto_win_chance_original"]').val(),main_group_id:a.model.get("ID")});if(this.$el.find('input[name="form-types[]"]').length){var c=[];this.$el.find('input[name="form-types[]"]:checked').each(function(){c.push(jQuery(this).val())}),b.set("form_types",c),b.setAsGroupType()}this.model instanceof ThriveLeads.models.Shortcode&&b.setAsShortcodeType(),this.model instanceof ThriveLeads.models.TwoStepLightbox&&b.setAsTwoStepLightboxType(),b.on("invalid",function(b,c){a.onInvalid(b,c)}),b.isValid()&&(TVE_Dash.showLoader(),b.save({},{success:function(c,d){if(b.set("id",d.id),b.get("form_types"))d.item_ids=d.form_types,a.model.get("active_tests").add(new ThriveLeads.models.Test(d));else if(a.model instanceof ThriveLeads.models.Shortcode)ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(b.get("main_group_id"))}).set("active_test",b),ThriveLeads.objects.Shortcode.set("active_test",b),ThriveLeads.router.navigate("#test/"+b.get("id")+"/completed",{trigger:!0});else if(a.model instanceof ThriveLeads.models.TwoStepLightbox)ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(b.get("main_group_id"))}).set("active_test",b),ThriveLeads.objects.TwoStepLightbox.set("active_test",b),ThriveLeads.router.navigate("#test/"+b.get("id")+"/completed",{trigger:!0});else{var e=ThriveLeads.objects.groups.findWhere({ID:a.model.get("post_parent")}),f=e.get("form_types").findWhere({ID:a.model.get("ID")});f.set("active_test",b),ThriveLeads.router.navigate("#test/"+b.get("id")+"/completed",{trigger:!0})}},complete:function(){a.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error, .tve-error-message").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("title"===b){var d=jQuery('<p class="tve-error" style="display: none;"></p>');d.html(a),c.$el.find('input[name="test_title"]').addClass("tve-leads-input-error").before(d),d.show()}if("auto_win_min_conversions"===b){var d=jQuery('<p class="tve-error" style="display: none"></p>');d.html(a),c.$el.find('input[name="auto_win_min_conversions"]').addClass("tve-leads-input-error").before(d),d.show()}if("auto_win_min_duration"===b){var d=jQuery('<p class="tve-error" style="display: none"></p>');d.html(a),c.$el.find('input[name="auto_win_min_duration"]').addClass("tve-leads-input-error").before(d),d.show()}if("auto_win_chance_original"===b){var d=jQuery('<p class="tve-error" style="display: none"></p>');d.html(a),c.$el.find('input[name="auto_win_chance_original"]').addClass("tve-leads-input-error").before(d),d.show()}"form_types"===b&&TVE_Dash.err(a,ThriveLeads["const"].toast_timeout)}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)},toggleSettings:function(){var a=this.$el.find("#tve-winner-test-container");this.$el.find("#tve-winner-test-settings");a.is(":visible")?a.hide(0):a.fadeIn("fast"),setTimeout(ThriveLeads.resize_thickbox,0)},toggleProperties:function(a){a.target.checked?this.$el.find(".tve-winner-settings-input").show(0):this.$el.find(".tve-winner-settings-input").hide(0),setTimeout(ThriveLeads.resize_thickbox,0)}}),AddGroup:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-group"),events:{"click .tve-add-lead-group":"addGroup"},addGroup:function(b){var c=a(b.currentTarget),d=new ThriveLeads.models.Group({post_title:this.$el.find(".post_title").val(),order:ThriveLeads.objects.groups.length}),e=this;d.on("invalid",function(a,b){e.onInvalid(a,b)}),d.isValid()&&(this.btnLoading(c),TVE_Dash.showLoader(),d.save({},{success:function(a,b){a.set("ID",b)},complete:function(a,b){ThriveLeads.objects.groups.add(d),e.$el.find(".post_title").val(""),e.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("post_title"===b){var d=jQuery('<p class="tve-error" style="display: none;"></p>');d.html(a),c.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)}}),AddShortcode:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-shortcode"),events:{"click .tve-add-lead-shortcode":"addShortcode"},addShortcode:function(b){var c=a(b.currentTarget),d=new ThriveLeads.models.Shortcode({post_title:this.$el.find(".post_title").val()}),e=this;d.on("invalid",function(a,b){e.onInvalid(a,b)}),d.isValid()&&(this.btnLoading(c),TVE_Dash.showLoader(),d.save({},{success:function(a,b){a.set("ID",b)},complete:function(){ThriveLeads.objects.shortcodeCollection.add(d),e.$el.find(".post_title").val(""),e.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("post_title"===b){var d=jQuery('<p class="tve-error" style="display: none;"></p>');d.html(a),c.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)}}),AddTwoStepLightbox:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-two-step-lightbox"),events:{"click .tve-add-lead-two-step-lightbox":"addTwoStepLightbox"},addTwoStepLightbox:function(b){var c=a(b.currentTarget),d=new ThriveLeads.models.TwoStepLightbox({post_title:this.$el.find(".post_title").val()}),e=this;d.on("invalid",function(a,b){e.onInvalid(a,b)}),d.isValid()&&(this.btnLoading(c),TVE_Dash.showLoader(),d.save({},{success:function(a,b){a.set("ID",b)},complete:function(){ThriveLeads.objects.TwoStepLightboxCollection.add(d),e.$el.find(".post_title").val(""),e.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("post_title"===b){var d=jQuery('<p class="tve-error" style="display: none;"></p>');d.html(a),c.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)}}),AddOneClickSignup:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/one-click-signup/add-one-click-signup"),events:{"click .tve-add-lead-one-click-signup":"addOneClickSignup"},addOneClickSignup:function(b){var c=a(b.currentTarget),d=new ThriveLeads.models.OneClickSignup({post_title:this.$el.find(".post_title").val()}),e=this;d.on("invalid",function(a,b){e.onInvalid(a,b)}),d.isValid()&&(this.btnLoading(c),TVE_Dash.showLoader(),d.save({},{success:function(a,b){var c=JSON.parse(b);a.set("ID",c.ID),a.set("post_link",c.post_link),a.set("valid",c.valid)},complete:function(){ThriveLeads.objects.OneClickSignupCollection.add(d),e.$el.find(".post_title").val(""),e.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("post_title"===b){var d=jQuery('<p class="tve-error" style="display: none;"></p>');d.html(a),c.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)}}),addNewFile:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-asset-file"),events:{"click .tve-add-asset-file":"addFile"},addFile:function(b){var c=a(b.currentTarget),d=new ThriveLeads.models.AssetFile({name:this.$el.find(".name").val(),link_anchor:this.$el.find(".link_anchor").val(),link:this.$el.find(".link").val(),parent_ID:this.model.get("ID"),ID:""}),e=this;d.on("invalid",function(a,b){e.onInvalid(a,b)}),d.isValid()&&(this.btnLoading(c),TVE_Dash.showLoader(),d.save({},{success:function(a,b){a.set("ID",b)},complete:function(){e.model.get("files").add(d),e.$el.find(".name").val(""),e.$el.find(".link_anchor").val(""),e.$el.find(".link").val(""),e.close(),TVE_Dash.hideLoader()}}))},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("name"===b){var d=jQuery('<p class="tve-error" style="display: none;"></p>');d.html(a),c.$el.find('input[name="asset_file_name"]').addClass("tve-leads-input-error").before(d),d.show()}if("link_anchor"===b){var d=jQuery('<p class="tve-error" style="display: none;"></p>');d.html(a),c.$el.find('input[name="asset_file_link_anchor"]').addClass("tve-leads-input-error").before(d),d.show()}if("link"===b){var d=jQuery('<p class="tve-error" style="display: none;"></p>');d.html(a),c.$el.find('input[name="asset_file_link"]').addClass("tve-leads-input-error").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)}}),addPrevFile:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-prev-asset-file"),events:{"click .tve-add-asset-file":"addFile"},addFile:function(b){var c=a(b.currentTarget),d=this.$el.find(".tve-asset-prev-select"),e=new ThriveLeads.models.AssetFile({name:this.$el.find(".tve-asset-prev-select option:selected").text(),link_anchor:d.val(),link:this.$el.find(".tve-asset-prev-select option:selected").attr("data-link"),parent_ID:this.model.get("ID"),ID:""}),f=this;return e.get("link_anchor")?(this.btnLoading(c),TVE_Dash.showLoader(),void e.save({},{success:function(a,b){a.set("ID",b)},complete:function(){f.model.get("files").add(e),f.close(),TVE_Dash.hideLoader()}})):(d.trigger("tvderror"),!1)}}),StopVariation:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-variation"),events:{"click .tve-stop-test-variation-modal-action":"stopVariation"},afterInitialize:function(a){this.$el.addClass("tvd-red")},stopVariation:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),TVE_Dash.showLoader(),a.ajax({url:ajaxurl,dataType:"json",method:"POST",data:{action:"tve_leads_stop_variation",variation_id:d.model.get("id"),test_id:d.model.get("test_id")},success:function(a){"ok"==a.status&&(ThriveLeads.router.viewTest(d.model.get("test_id"),!0),setTimeout(function(){TVE_Dash.success(ThriveLeads["const"].translations.successfulStopVariation)},600))},error:function(){TVE_Dash.err(ThriveLeads["const"].translations.failStopVariation)},complete:function(){TVE_Dash.hideLoader(),d.close()}})}}),showShortcodes:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/shortcode-list"),events:{"click .tve-copy-to-clipboard":"bindZclip"},afterOpen:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))}}),ConfirmDeleteGroup:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-group"),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},afterInitialize:function(a){this.$el.addClass("tvd-red")},deleteGroup:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){d.close(),TVE_Dash.hideLoader()}})}}),AddFormType:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("form-type/add-modal"),events:{"click .tve-select-form-type.tve_available":"addForm"},addForm:function(a){var b=this,c=a.currentTarget.getAttribute("data-form"),d=a.currentTarget.getAttribute("data-title"),e=this.model.findWhere({tve_form_type:c});e||(e=new ThriveLeads.models.FormType({tve_form_type:c,post_parent:this.post_parent,post_title:d}),this.model.add(e)),TVE_Dash.showLoader(),e.save({},{success:function(a,c){a.set("ID",c),a.set("display_on_mobile",0),a.set("display_status",0),jQuery(document).trigger("tl.form_type.added",{ID:c,post_parent:b.post_parent}).trigger("tl.form_type.update_display",{post_parent:b.post_parent}),b.model.add(a),TVE_Dash.hideLoader(),b.close()},complete:function(a){}})}}),ConfirmDeleteFormType:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("form-type/delete-modal"),events:{"click .tve-confirm-delete-form-type":"deleteFormType"},afterInitialize:function(a){this.$el.addClass("tvd-red")},deleteFormType:function(b){var c=this;a(document).trigger("tl.form_type.update_display",{post_parent:this.model.get("post_parent")}),TVE_Dash.showLoader(),this.model.destroy({complete:function(){c.close(),TVE_Dash.hideLoader(),c.model.set("ID","")}})}}),ConfirmDeleteShortcode:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-shortcode"),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},afterInitialize:function(a){this.$el.addClass("tvd-red")},deleteGroup:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){d.close(),TVE_Dash.hideLoader()}})}}),confirmDeleteTest:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-test"),events:{"click .tve-confirm-delete-test":"deleteGroup"},afterInitialize:function(a){this.$el.addClass("tvd-red")},deleteGroup:function(b){var c=a(b.currentTarget),d=this.model,e=this;this.btnLoading(c),TVE_Dash.showLoader(),this.model.destroy({data:d,success:function(){},error:function(){},complete:function(){e.close(),TVE_Dash.hideLoader()}})}}),ConfirmDeleteTwoStepLightbox:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-two-step-lightbox"),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},afterInitialize:function(a){this.$el.addClass("tvd-red")},deleteGroup:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){d.close(),TVE_Dash.hideLoader()}})}}),ConfirmDeleteOneClickSignup:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/one-click-signup/delete-one-click-signup"),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},afterInitialize:function(a){this.$el.addClass("tvd-red")},deleteGroup:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){d.close(),TVE_Dash.hideLoader()}})}}),OneClickSignupRedirectSettings:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/one-click-signup/redirect-settings"),events:{"click .tl-save-redirect-url":"saveRedirectUrl","click .tl-specify-redirects":"saveRedirectUrl","click .tl-segue-back-button":"displayScheduleFields","change .tl-post-type-select":"displayPostTypeFields","click .tl-remove-redirect-url":"removeRedirectUrl","click input.tl-custom-url-radio":"changeCustomUrlOption","keyup input.tl-find-content-custom-url":"updateRedirectUrl","keyup .tl-event-time":"validateTime"},onOpen:function(){var b=this.model,c=this.$el;if(c.addClass("tvd-modal-redirect-settings"),b.has("redirect_url")){var d=b.get("redirect_url");a(".tl-post-type-select option[value='"+d.type+"']").prop("selected",!0),a(".tl-post-type-select").trigger("change")}c.find(".tl-event-start-time").timepicker({timeFormat:"HH:mm",interval:60,change:function(){a(this).blur()}}),c.find(".tl-event-duration-time").timepicker({timeFormat:"HH:mm",interval:60,change:function(){a(this).blur()}}),c.find(".tl-event-start-date").pickadate({format:"yyyy-mm-dd",onOpen:function(){jQuery('label[for="tl-event-start-date"]').addClass("tvd-active")}}),jQuery(document).on("click",".tl-redirect-start-date",function(){jQuery(".tl-event-start-date").trigger("click")});var e=c.find(".tl-find-content-input").val("");e.each(function(){var c=jQuery(this);c.autocomplete({appendTo:c.parent(),minLength:2,delay:200,source:function(a,b){jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"tve_leads_find_post_and_page_action",q:a.term}}).done(function(a){b(a)})},select:function(c,d){var e=a(this).attr("data-type");a(".tl-"+e+" .tl-redirect-url-container").show(),a(".tl-"+e+" .tl-redirect-url").html(d.item.label).attr("href",d.item.url),a(".tl-"+e+" .tl-remove-redirect-url").show().attr("disabled",!1);var f=b.get("redirect_url");return f[e]=d.item.url,f[e+"_label"]=d.item.label,b.set("redirect_url",f),!1}})})},displayRedirectFields:function(){this.$el.find(".tl-segue-settings-step1").hide(),this.$el.find(".tl-segue-settings-step2").show(),this.$el.find(".tl-segue-settings-controlls1").hide(),this.$el.find(".tl-segue-settings-controlls2").show(),this.$el.find(".tl-segue-back-button").show()},displayScheduleFields:function(){this.$el.find(".tl-segue-settings-step1").show(),this.$el.find(".tl-segue-settings-step2").hide(),this.$el.find(".tl-segue-settings-controlls1").show(),this.$el.find(".tl-segue-settings-controlls2").hide(),this.$el.find(".tl-segue-back-button").hide()},displayPostTypeFields:function(a){var b=jQuery(a.currentTarget);b.trigger("tvdclear");var c=b.find("option:selected"),d=c.val();this.$el.find(".tl-segue-settings-controlls1").hide(),this.$el.find(".tl-segue-settings-controlls2").hide(),this.$el.find(".tl-segue-back-button").hide(),"single-redirect"==d?(this.$el.find(".tl-segue-settings-controlls2").show(),this.$el.find(".tl-single-redirect-box").show(),this.$el.find(".tl-conditional-redirect-box").hide()):"conditional-redirect"==d?(this.$el.find(".tl-single-redirect-box").hide(),this.$el.find(".tl-conditional-redirect-box").show(),this.$el.find(".tl-segue-settings-controlls1").show()):(this.$el.find(".tl-segue-settings-controlls2").show(),this.$el.find(".tl-single-redirect-box").hide(),this.$el.find(".tl-conditional-redirect-box").hide()),ThriveLeads.resize_thickbox(),this.$el.find(".messagesList").remove()},validateForm:function(b){a(b+" input").removeClass("tl-required-input");var c=!0,d=this.model.get("redirect_url");if(".tl-single-redirect-box"==b)d.single&&""!=d.single||(c=!1,a(b+" input").addClass("tl-required-input"));else if(".tl-segue-settings-step1"==b)a(b+" .tl-time-section input").each(function(){""==a(this).val()&&(c=!1,a(this).addClass("tl-required-input"))});else for(var e=["before","during","after"],f=0;f<e.length;f++)d[e[f]]&&""!=d[e[f]]||(c=!1,a(b+" .tl-"+e[f]+" input").addClass("tl-required-input"));return c},saveRedirectUrl:function(b){var c,d=this.model,e=this,f=this.$el.find("#tl-post-type-select"),g=f.val();if(!g)return f.trigger("tvderror"),!1;var h=d.get("redirect_url");"single-redirect"==g?c=this.validateForm(".tl-single-redirect-box"):a(b.target).hasClass("tl-specify-redirects")?(c=this.validateForm(".tl-segue-settings-step1"),h.event_start_date=a(".tl-event-start-date").val(),h.event_start_time=a("input[name='event_start_time']").val(),h.event_duration_time=a("input[name='event_duration_time']").val()):c=this.validateForm(".tl-segue-settings-step2"),c?(h.type=g,d.set("redirect_url",h),d.unset("changed_redirect_url"),d.set("changed_redirect_url",1),this.btnLoading(b.currentTarget),TVE_Dash.showLoader(),d.save({},{success:function(){a(b.target).hasClass("tl-specify-redirects")?e.displayRedirectFields():e.close(),a(b.target).removeClass("tvd-disabled").removeAttr("disabled"),TVE_Dash.hideLoader()}})):TVE_Dash.err(ThriveLeads["const"].translations.MissingRequiredParams)},removeRedirectUrl:function(b){var c=this.model,d=jQuery(b.currentTarget),e=d.attr("data-type"),f=c.get("redirect_url");f[e]="",f[e+"_label"]="",c.set("redirect_url",f),this.btnLoading(b.currentTarget),TVE_Dash.showLoader(),this.model.save({},{success:function(){TVE_Dash.hideLoader()}}),a(".tl-"+e+" .tl-redirect-url-container").hide(),a(".tl-"+e+" .tl-find-content-input").val(""),a(".tl-"+e+" .tl-find-content-custom-url").val("")},changeCustomUrlOption:function(b){var c=jQuery(b.currentTarget),d=c.closest(".find-content-box");0==a("input.tl-custom-url-radio:checked",d).val()?(jQuery(d).find(".tl-find-content-input-container").show(),jQuery(d).find(".tl-find-content-custom-url-container").hide()):(jQuery(d).find(".tl-find-content-input-container").hide(),jQuery(d).find(".tl-find-content-custom-url-container").show())},updateRedirectUrl:function(b){var c=this.model,d=jQuery(b.currentTarget),e=d.attr("data-type"),f=d.val(),g=c.get("redirect_url");return g[e]=f,g[e+"_label"]=f,c.set("redirect_url",g),a(".tl-"+e+" .tl-redirect-url-container").show(),a(".tl-"+e+" .tl-redirect-url").html(f).attr("href",f),a(".tl-"+e+" .tl-remove-redirect-url").show().attr("disabled",!1),!1},validateTime:function(b){var c=jQuery(b.currentTarget),d=c.val(),e=d.replace(":","");if(0>d||!a.isNumeric(e)){var f=d.substring(0,d.length-1);c.val(f)}}}),OneClickSignupApiConnections:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/one-click-signup/connection-settings"),events:{"click .tl-save-connection":"saveApiConnection","change .tl-api-connection-options":"selectApiConnection","click .tl-remove-api-connection":"removeApiConnection","click .tl-add-connection":"addApiConnection","click .tl-reload-api-connections":"reloadApiConnections","click .tl-reload-api-connections-list":"reloadApiConnectionList","click .tl-add-new-api-button":"displayAddEditApiBox","click .tl-close-api-add-edit":"displayExistingApiBox","click .tl-edit-api-connection":"editApiConnection"},api_connections:{},onOpen:function(){this.$el.css("min-height","400px"),this.fetchApiConnections(this.reloadApiConnections)},fetchApiConnections:function(a){var b=this;TVE_Dash.showLoader(),jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"tve_leads_get_api_connections"}}).done(function(c){b.api_connections=c,TVE_Dash.hideLoader(),"function"==typeof a&&a.call(b)})},reloadApiConnections:function(a){var b=this;this.fetchApiConnections(function(){b.updateApiConnectionsDropdown(a)})},updateApiConnectionsDropdown:function(b){var c=this.$el.find(".tl-api-connection-options"),d=_.map(this.model.get("api_connections"),function(a){return a.apiName});if(c.data("select2")&&c.data("select2").destroy(),_.isEmpty(this.api_connections))a(".tl-no-api-connection-box").show(),a(".tl-select-api-connection-box").hide();else{a(".tl-no-api-connection-box").hide(),a(".tl-select-api-connection-box").show(),c.find("option:not(:first)").remove();for(var e in this.api_connections)if(-1===_.indexOf(d,e)||b==e){var f=b==e?' selected="selected"':"";c.append("<option "+f+'value="'+e+'">'+e+"</option>")}c.select2()}a(".tl-api-connection-extra").html(""),a(".tl-api-connection-list-box").hide()},reloadApiConnectionList:function(b,c){var d=this;if(c||(c=a(".tl-api-connection-options option:selected").val()),""!=c){TVE_Dash.showLoader();var e=this.$el.find(".tl-api-connection-list");jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"tve_leads_get_api_connection_list",api:c}}).done(function(f){if(e.data("select2")&&e.data("select2").destroy(),e.find("option").remove(),0==f||0===f.length)e.append("<option value=''>"+ThriveLeads["const"].translations.NoListAvailable+"</option>");else if(jQuery.each(f,function(a,b){e.append("<option value='"+b.id+"'>"+b.name+"</option>")}),b&&"undefined"!==b&&"edit"==b){var g=d.getConnectionValue(c,"list");a(".tl-api-connection-list option[value='"+g+"']").attr("selected","selected")}e.select2(),d.renderExtraFields(b),a(".tl-api-connection-list-box").show()})}else a(".tl-api-connection-list-box").hide(),ThriveLeads.resize_thickbox()},renderExtraFields:function(b){var c=this,d=this.$el,e=a(".tl-api-connection-options option:selected").val();if(""!=e){var f=this.$el.find(".tl-api-connection-extra");jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"tve_leads_get_api_extra_fields",api:e}}).done(function(g){f.html(g.html),TVE_Dash.materialize(f),b&&"undefined"!==b&&"edit"==b&&d.find(".tve-api-extra").each(function(){var b=a(this),d=b.attr("name"),f=c.getConnectionValue(e,d);b.val([f]),b.trigger("change")}),TVE_Dash.hideLoader(),ThriveLeads.resize_thickbox()})}},getConnectionValue:function(a,b){var c=this.model,d="",e=c.get("api_connections");return jQuery.each(e,function(c,e){return e.apiName==a?(d=e[b],!1):void 0}),d},selectApiConnection:function(){this.reloadApiConnectionList()},editApiConnection:function(a){var b=jQuery(a.currentTarget),c=b.attr("rel");this.displayAddEditApiBox({type:"edit",selApiName:c})},addApiConnection:function(){var b=this.model,c=this,d=this.$el,e=a.map(b.get("api_connections"),function(a){return a}),f=a(".tl-api-connection-options option:selected").val(),g=a(".tl-api-connection-list option:selected").val();if(""==f||""==g)return TVE_Dash.err(ThriveLeads["const"].translations.SelectConnectionMsg),!1;this.displayExistingApiBox(),TVE_Dash.showLoader();var h=!1;jQuery.each(e,function(a,b){return b.apiName==f?(e.splice(a,1),h=!0,!1):void 0});var i={apiName:f,list:g};d.find(".tve-api-extra").filter(":not(.tve_disabled)").each(function(){var b=a(this).serialize().split("=");2==b.length&&(i[b[0]]=b[1])}),e.push(i),h||(a(".tl-added-connections").append(c.renderAddSelectedApi(f)),a(".tl-connection-list").show(),a(".tl-empty-connection-list").hide()),b.set("api_connections",e),TVE_Dash.hideLoader()},renderAddSelectedApi:function(a){return TVE_Dash.tpl("lightbox/one-click-signup/selected-api-connection",{apiName:a})},saveApiConnection:function(a){var b=this.model,c=this;this.btnLoading(a.currentTarget),b.unset("changed_connection"),b.set("changed_connection",1),TVE_Dash.showLoader(),b.save({},{success:function(){c.close(),TVE_Dash.hideLoader()}})},removeApiConnection:function(b){var c=this.model,d=jQuery(b.currentTarget),e=d.attr("rel"),f=c.get("api_connections");
jQuery.each(f,function(a,b){return b.apiName==e?(f.splice(a,1),!1):void 0}),c.set("api_connections",f),a("."+e+"_row").remove(),0===f.length&&(a(".tl-connection-list").hide(),a(".tl-empty-connection-list").show()),this.btnLoading(b.currentTarget),TVE_Dash.showLoader(),c.save({},{success:function(){TVE_Dash.hideLoader()}})},displayAddEditApiBox:function(b){var c=b.type,d=b.selApiName;this.reloadApiConnections(d),a(".tl-add-connection-box").show(),a(".tl-existing-api-connection-box").hide(),a(".tl-api-connection-extra").html(""),c&&"edit"==c?this.reloadApiConnectionList(c,d):(a(".tl-api-connection-options option:first").attr("selected","selected"),a(".tl-api-connection-list-box").hide())},displayExistingApiBox:function(){a(".tl-existing-api-connection-box").show(),a(".tl-add-connection-box").hide(),ThriveLeads.resize_thickbox()}}),ConfirmDeleteAssetGroup:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-asset-group"),events:{"click .tve-confirm-delete-asset-group":"deleteAssetGroup"},afterRender:function(){this.$el.addClass("tvd-red")},deleteAssetGroup:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){0==d.collection.length&&a(".tve-asset-group-links-status-green ").addClass("tve-asset-group-links-status-red").removeClass("tve-asset-group-links-status-green").attr("data-tooltip",ThriveLeads["const"].translations.NotActive),d.close(),TVE_Dash.hideLoader()}})}}),ConfirmDeleteAssetFile:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-asset-file"),events:{"click .tve-confirm-delete-asset-file":"deleteAssetFile"},afterRender:function(){this.$el.addClass("tvd-red")},deleteAssetFile:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),TVE_Dash.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){d.close(),TVE_Dash.hideLoader()}})}}),testAPIConnection:TVE_Dash.views.ModalSteps.extend({template:TVE_Dash.tpl("lightbox/test-api-connection"),events:{"click .tvd-modal-next-step":"next","click .tvd-modal-prev-step":"prev","click .tve-asset-delivery-conection":"openConnection","click .tve-leads-connection-edit":"openConnection","click .tvd-api-connect":"submitConnection","click .tvd-api-cancel":"closeConnection","click .tve-leads-asset-close":function(){this.close()}},onOpen:function(){ThriveLeads.objects.Apis.each(this.populateFields,this)},populateFields:function(a){var b=a.get("connection"),c=a.get("connection_instance"),d=this.$el.find(".tve-leads-connection-form[data-key="+b+"] form");c&&_.each(c,function(a,b){var c=d.find(':input[name="connection['+b+']"]');(c.is("input")||c.is("textarea")||c.is("select"))&&c.val(a)})},afterRender:function(){var a=new ThriveLeads.views.AssetConnections({collection:ThriveLeads.objects.AssetConnection,el:this.$el});return a.render(),this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this},openConnection:function(b){b.stopPropagation();var c=a(b.target),d=c.attr("data-key"),e=this.$el.find(".tve-leads-connection-form[data-key="+d+"]");this.$el.find(".tve-leads-connection-form").hide(),e.show(),c.hasClass("tve-asset-delivery-conection")||e.find(".tvd-api-cancel").addClass("tve-leads-gotostep-zero"),this.gotoStep(2)},closeConnection:function(b){return a(b.target).hasClass("tve-leads-gotostep-zero")?(a(b.target).removeClass("tve-leads-gotostep-zero"),void this.gotoStep(0)):void this.gotoStep(1)},submitConnection:function(b){var c=this,d=(this.model,a(b.target).closest(".tve-leads-connection-form").find("form")),e=d.serializeArray();TVE_Dash.showLoader(),jQuery.ajax({url:ThriveLeads.ajaxurl("action=thrive_leads_backend_ajax&route=addAssetAPI"),type:"post",data:e}).done(function(b){TVE_Dash.hideLoader(),"true"==b?(jQuery.ajax({url:ThriveLeads.ajaxurl("action=thrive_leads_backend_ajax&route=getDefaultConnection"),type:"post"}).done(function(b){JSON.parse(b);if(!ThriveLeads.objects.AssetsWizard.get("wizard_complete")){a(".tve-asset-service").removeClass("tvd-gray-accent").addClass("tvd-green-accent"),a(".tve-asset-service .tve-asset-service-status").text(" Ready!"),a(".tve-asset-group-connection-status").addClass("tve-asset-group-connection-status-green").removeClass("tve-asset-group-connection-status").attr("data-tooltip",ThriveLeads["const"].translations.DeliveryStatus),a(".tve-asset-group-status-wrapper").hasClass("tve-asset-group-connection-status-red")&&a(".tve-asset-group-connection-status-red").addClass("tve-asset-group-connection-status-green tve-asset-group-existing-connection-event").removeClass("tve-asset-group-connection-status-red tve-asset-group-connection-event").attr("data-tooltip",ThriveLeads["const"].translations.DeliveryStatus),ThriveLeads.objects.AssetsWizard.get("proprieties").connections=1;var d=ThriveLeads.objects.AssetsWizard.get("proprieties");1==d.connections&&1==d.files&&1==d.template&&(a(".tve-leads-asset-get-details").hide(),a(".tve-leads-asset-go-dashboard").show(),ThriveLeads.objects.AssetsWizard.set({wizard_complete:!0}),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"setWizardComplete"}}))}var f=new ThriveLeads.models.AssetWizardConnection,g=c.mapProprieties(e);f.set(g);var h=ThriveLeads.objects.Apis.findWhere({connection:g.connection});c.$el.find(".tve-leads-connection-name-success").text(g.connection),h.get("connected")||(h.set({connected:!0}),ThriveLeads.objects.AssetConnection.add(f)),h.set({connection_instance:g.connection_instance})}),c.gotoStep(3)):(a(".tve-leads-delivery-connection").find(".error").remove(),TVE_Dash.err(JSON.parse(b),ThriveLeads["const"].toast_timeout),ThriveLeads.resize_thickbox())})},mapProprieties:function(a){var b={connection:{},connection_instance:{}};return a.map(function(a){if("api"==a.name)b.connection=a.value;else{var c=a.name.match(/\[(.*?)\]/)[1];b.connection_instance[c]=a.value}}),b}}),emailTemplate:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-email-template"),events:{"click .tve-leads-submit-template":"submitTemplate","click .tl-toggle-tab-display":"toggleTabDisplay"},toggleTabDisplay:function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed"),d=jQuery(b.data("target"));c?d.hide(0).removeClass("tvd-not-visible").slideDown(200):d.slideUp(200,function(){d.addClass("tvd-not-visible")}),b.toggleClass("collapsed"),b.toggleClass("hover")},afterRender:function(){this.$el.addClass("tve-assed-email-modal"),ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),this.$el.tve_toggle_visibility()},submitTemplate:function(){var b="#wp-editor_ifr",c=this.$el.find(b),d=c.contents().find("body").html(),e=this.$el.find(".tve-leads-asset-subject-input").val(),f={template_body:d,template_subject:e},g=this;this.model.set("email_data",f),TVE_Dash.showLoader(),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"setEmailTemplate",post_content:d,post_subject:e}}).success(function(b){a(".tve-asset-template").removeClass("tvd-gray-accent").addClass("tvd-green-accent"),a(".tve-asset-template  .tve-asset-service-status").text(" Ready!"),a(".tve-asset-group-template-status").addClass("tve-asset-group-template-status-green").removeClass("tve-asset-group-template-status").attr("data-tooltip","Default template status: OK. Click to edit the default template."),a(".tve-asset-group-template-status-red").addClass("tve-asset-group-template-status-green").removeClass("tve-asset-group-template-status-red").attr("data-tooltip","Default template status: OK. Click to edit the default template."),ThriveLeads.objects.AssetsWizard.get("proprieties").template=1;var c=ThriveLeads.objects.AssetsWizard.get("proprieties");1==c.connections&&1==c.files&&1==c.template&&(a(".tve-leads-asset-get-details").hide(),a(".tve-leads-asset-go-dashboard").show(),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"setWizardComplete"}})),g.close(),TVE_Dash.hideLoader()})}}),emailChange:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/change-email-template"),events:{"click .tve-leads-submit-template":"submitTemplate","click .tl-toggle-tab-display":"toggleTabDisplay"},afterOpen:function(){this.$el.addClass("tve-assed-email-modal"),ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))},toggleTabDisplay:function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed"),d=jQuery(b.data("target"));c?d.hide(0).removeClass("tvd-not-visible").slideDown(200):d.slideUp(200,function(){d.addClass("tvd-not-visible")}),b.toggleClass("collapsed"),b.toggleClass("hover")},submitTemplate:function(){var a="#my-id-"+this.model.get("ID")+"_ifr",b=this.$el.find(a),c=b.contents().find("body").html(),d=this.$el.find(".tve-leads-asset-subject-input").val(),e=this;this.model.set("post_content",c),this.model.set("post_subject",d),TVE_Dash.showLoader(),this.model.save({},{success:function(a,b){},complete:function(){TVE_Dash.hideLoader(),e.close()}})}}),emailPreview:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/preview-email-template"),events:{"click .tve-leads-close-preview":function(){self.close()}}}),addWizardFiles:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-wizard-files"),events:{"click .tve-add-asset-group":"addGroup","click .tve-asset-save-group":"saveDetails","click .tve-leads-asset-media":"addMedia","click .tve-asset-files-back":"renderFiles"},addGroup:function(b){ThriveLeads.resize_thickbox();var c=(a(b.currentTarget),new ThriveLeads.models.Assets({post_title:this.$el.find(".post_title").val(),order:ThriveLeads.objects.AssetsCollection.length})),d=this;c.on("invalid",function(a,b){d.onInvalid(a,b)}),c.isValid()&&(ThriveLeads.objects.WizardAddedGroup=c,d.$el.find(".post_title").val(""),TVE_Dash.hideLoader(),d.renderFiles())},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("post_title"===b){var d=jQuery('<p class="tve-error" style="display: none;"></p>');d.html(a),c.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)},renderFiles:function(){var a=ThriveLeads.objects.WizardAddedGroup.get("files");0==a.length?this.$el.find(".asset-file-list-no-files").show():this.$el.find(".asset-file-list-no-files").hide(),this.$el.find(".asset-file-list-item").remove(),a.each(this.renderFile,this),this.$el.find(".tve-leads-files-step1").hide(),this.$el.find(".tve-leads-asset-files-add").hide(),this.$el.find(".tve-leads-asset-files-manager").show(),ThriveLeads.resize_thickbox()},renderFile:function(a){a.set("parent_ID",ThriveLeads.objects.WizardAddedGroup.get("ID"));var b=new ThriveLeads.views.AssetFileWizard({model:a});this.$el.find("#tve-asset-group-files").append(b.render().$el)},addMedia:function(){var a,b=ThriveLeads.objects.WizardAddedGroup.get("files"),c=b.at(b.length-1);if(c)var d=c.get("ID")+1;else var d=0;var e=this;return a?(a.open(),!1):(a=wp.media.frames.file_frame=wp.media({title:"Upload Asset Group Files (.zip, .pdf, .jpg, .png)",button:{text:"Use file"},frame:"post",state:"insert",multiple:!1}),a.on("insert",function(){var b=a.state().get("selection").first().toJSON(),c=new ThriveLeads.models.AssetFile({name:b.name,link_anchor:b.name,link:b.url,parent_ID:"",ID:d});ThriveLeads.objects.WizardAddedGroup.get("files").add(c),e.renderFiles()}),a.state("embed").on("select",function(){var b=a.state(),c=(b.get("type"),b.props.toJSON()),f=new ThriveLeads.models.AssetFile({name:c.linkText,link_anchor:c.linkText,link:c.url,parent_ID:"",ID:d});ThriveLeads.objects.WizardAddedGroup.get("files").add(f),e.renderFiles()}),void a.open())},saveDetails:function(b){var c=ThriveLeads.objects.WizardAddedGroup.get("files");if(0==c.length)return void TVE_Dash.err(ThriveLeads["const"].translations.MissingAssetFiles);var d=a(b.currentTarget),e=new ThriveLeads.models.AssetWizard({post_title:ThriveLeads.objects.WizardAddedGroup.get("post_title"),files:ThriveLeads.objects.WizardAddedGroup.get("files"),order:ThriveLeads.objects.AssetsCollection.length}),f=this;this.btnLoading(d),TVE_Dash.showLoader(),e.save({},{success:function(a,b){a.set("ID",b)},complete:function(){ThriveLeads.objects.AssetsWizard.get("proprieties").files=1,a(".tve-asset-download-link").removeClass("tvd-gray-accent").addClass("tvd-green-accent"),a(".tve-asset-download-link").addClass("tve-asset-service-status-ready"),a(".tve-asset-download-link .tve-asset-service-status").text(" Ready!"),a(".tve-asset-group-links-status").addClass("tve-asset-group-links-status-green").removeClass("tve-asset-group-links-status").attr("data-tooltip","Downloadable asset status: OK."),a(".tve-asset-group-links-status-red").addClass("tve-asset-group-links-status-green").removeClass("tve-asset-group-links-status-red").attr("data-tooltip","Downloadable asset status: OK.");var b=ThriveLeads.objects.AssetsWizard.get("proprieties");ThriveLeads.objects.AssetsCollection.add(e),1==b.connections&&1==b.files&&1==b.template&&(a(".tve-leads-asset-get-details").hide(),a(".tve-leads-asset-go-dashboard").show(),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"setWizardComplete"}})),TVE_Dash.hideLoader(),f.close()}})}}),AddForm:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/add-form-variation"),events:{"click .tve-add-form":"addForm"},addForm:function(b){var c,d=a(b.currentTarget),e=this;if(c=this.model.get("post_type")===ThriveLeads["const"].tve_leads_post_shortcode_type||this.model.get("form_variation")instanceof ThriveLeads.models.ShortcodeVariation?new ThriveLeads.models.ShortcodeVariation:this.model.get("post_type")===ThriveLeads["const"].tve_leads_post_two_step_lightbox_type||this.model.get("form_variation")instanceof ThriveLeads.models.TwoStepLightboxVariation?new ThriveLeads.models.TwoStepLightboxVariation:new ThriveLeads.models.FormVariation,"re-add"==this.model.get("state")){var f=this.model.get("form_variation").toJSON();c.set(f),c.set("key",""),c.set("post_status","publish"),c.set("readd_from",f.key)}else c.set("post_parent",this.model.get("form_type_id"));c.set("post_title",this.$el.find(".post_title").val()),this.btnLoading(d),TVE_Dash.showLoader();var g=c.save({});ThriveLeads.addFailCallback(g,this),g.done(function(a){c.set(a)}).always(function(){if(!g.failed){if(e.model.get("post_type")===ThriveLeads["const"].tve_leads_post_shortcode_type||e.model.get("form_variation")instanceof ThriveLeads.models.ShortcodeVariation){e.model.get("content_locking")&&c.set("content_lock_display","hide"),c.set("is_control",!ThriveLeads.objects.Shortcode.get("variations").length),ThriveLeads.objects.Shortcode.get("variations").add(c),ThriveLeads.objects.Shortcode.trigger("change");try{ThriveLeads.objects.shortcodeCollection.findWhere({ID:e.model.get("form_type_id")}).get("variations").add(c)}catch(a){ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(e.model.get("form_variation").get("post_parent"))}).get("variations").add(c)}}else if(e.model.get("post_type")===ThriveLeads["const"].tve_leads_post_two_step_lightbox_type||e.model.get("form_variation")instanceof ThriveLeads.models.TwoStepLightboxVariation){c.set("is_control",!ThriveLeads.objects.TwoStepLightbox.get("variations").length),ThriveLeads.objects.TwoStepLightbox.get("variations").add(c),ThriveLeads.objects.TwoStepLightbox.trigger("change");try{ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:e.model.get("form_type_id")}).get("variations").add(c)}catch(a){ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(e.model.get("form_variation").get("post_parent"))}).get("variations").add(c)}}else{c.set("is_control",!ThriveLeads.objects.FormType.get("variations").length),ThriveLeads.objects.FormType.get("variations").add(c),ThriveLeads.objects.FormType.trigger("change");try{ThriveLeads.objects.groups.findWhere({ID:e.model.get("group_id")}).get("form_types").findWhere({ID:e.model.get("form_type_id")}).get("variations").add(c)}catch(a){console.log(a.message)}}e.$el.find(".post_title").val(""),e.close(),TVE_Dash.hideLoader()}})}}),ArchiveForm:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/archive-form-variation"),events:{"click .tve-confirm":"confirm"},confirm:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),TVE_Dash.showLoader(),d.close();var e=this.model.get("post_status");this.model.set("post_status",ThriveLeads["const"].test_status.archived);var f=this.model.save({});ThriveLeads.addFailCallback(f),f.done(function(a){d.model.set(a)}),f.always(function(){if(f.failed)return void d.model.set("post_status",e);var a;a=d.model instanceof ThriveLeads.models.ShortcodeVariation?ThriveLeads.objects.Shortcode:d.model instanceof ThriveLeads.models.TwoStepLightboxVariation?ThriveLeads.objects.TwoStepLightbox:ThriveLeads.objects.FormType,a.get("variations_archived").push(d.model),a.get("variations").remove(d.model),a.get("variations").determineControl(),a.trigger("change");try{if(a instanceof ThriveLeads.models.FormType){var b=ThriveLeads.objects.groups.findWhere({ID:a.get("post_parent")}),c=b.get("form_types").findWhere({ID:parseInt(a.get("ID"))});c.get("variations").remove(d.model),b.trigger("change")}else ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(d.model.get("post_parent"))}).get("variations").remove(d.model)}catch(g){console.log(g.message)}})}}),DeleteConversionLogs:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-archives"),events:{"click .tve-confirm-delete-archives":"deleteLogs"},deleteLogs:function(a){TVE_Dash.showLoader();var b=this,c={action:"thrive_leads_backend_ajax",route:"deleteLogs"};jQuery.post(ajaxurl,c),b.close(),TVE_Dash.hideLoader()}}),ConfirmDeleteVariation:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/delete-form"),events:{"click .tve-confirm-delete-form":"deleteVariation"},afterRender:function(){this.$el.addClass("tvd-red")},deleteVariation:function(a){var b=this,c=this.model.toJSON();TVE_Dash.showLoader(),b.close();var d=this.model.destroy({data:jQuery.param(c)});ThriveLeads.addFailCallback(d,this),d.always(function(){if(!d.failed){if(TVE_Dash.hideLoader(),b.model instanceof ThriveLeads.models.ShortcodeVariation)return ThriveLeads.objects.Shortcode.trigger("change"),void setTimeout(function(){jQuery('.tl-clickable[data-target="#tl-toggle-forms"]').click()},0);if(b.model instanceof ThriveLeads.models.TwoStepLightboxVariation)return ThriveLeads.objects.TwoStepLightbox.trigger("change"),void setTimeout(function(){jQuery('.tl-clickable[data-target="#tl-toggle-forms"]').click()},0);ThriveLeads.objects.FormType.trigger("change"),setTimeout(function(){jQuery('.tl-clickable[data-target="#tl-toggle-forms"]').click()},0)}})}}),ConfirmResetStats:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/reset-form-stats"),events:{"click .tve-confirm-reset":"resetStats"},resetStats:function(a){var b,c=this;b=this.model instanceof ThriveLeads.models.ShortcodeVariation?ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(c.model.get("post_parent"))}):this.model instanceof ThriveLeads.models.TwoStepLightboxVariation?ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(c.model.get("post_parent"))}):ThriveLeads.objects.groups.findWhere({ID:parseInt(ThriveLeads.objects.FormType.get("post_parent"))}),TVE_Dash.showLoader(),b.decreaseStatistics(this.model),this.model.resetStatistics({success:function(a){c.model.set(a)},error:function(){},complete:function(){c.close(),TVE_Dash.hideLoader()}})}}),ConfirmFormTypeResetStats:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/reset-form-type-stats"),events:{"click .tve-confirm-reset":"resetStats"},resetStats:function(a){var b=this;if(this.model instanceof ThriveLeads.models.Shortcode||this.model instanceof ThriveLeads.models.TwoStepLightbox||this.model instanceof ThriveLeads.models.OneClickSignup)var c=this.model;else var c=ThriveLeads.objects.groups.findWhere({ID:parseInt(this.model.get("post_parent"))});TVE_Dash.showLoader(),this.model.resetStatistics({success:function(){c.decreaseStatistics(b.model)},error:function(){},complete:function(){b.close(),TVE_Dash.hideLoader()}})}}),DisplayFrequencySettings:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/display-frequency-settings"),events:{"click .tve-save-frequency":"saveValue"},afterOpen:function(){this.$input=this.$el.find(".input-display-frequency"),this.$input.change()},clearData:function(){this.$input=null},saveValue:function(){this.model.set("display_frequency",this.$input.val()),TVE_Dash.showLoader(),this.close();var a=this,b=this.model.save({});ThriveLeads.addFailCallback(b),b.done(function(b){a.model.set(b),TVE_Dash.hideLoader()})}}),AnimationSettings:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/animation-settings"),events:{"change #animation-type":"animate","click .tve-save-animation":"saveValue"},afterOpen:function(){this.$el.addClass("tvd-animation-modal"),this.$el.find("#animation-type").val(this.model.get("display_animation")),this.target=this.$el.find("#tve-anim-target"),this.animate(),ThriveLeads.objects.FormType&&"screen_filler"==ThriveLeads.objects.FormType.get("tve_form_type")&&(a("#animation-type option[value='blur']").remove(),a("#animation-type option[value='make_way']").remove())},animate:function(){function a(){clearTimeout(c),d.css("display","none").removeClass(function(a,b){var c=b.split(" "),d="";return _.each(c,function(a){0===a.indexOf("tl-anim")&&(d+=a)}),d}).removeClass("tve-leads-triggered").addClass("tl-anim-"+b),e.removeClass(function(a,b){var c=b.split(" "),d="";return _.each(c,function(a){0===a.indexOf("tl-anim")&&(d+=a)}),d}).addClass("tl-anim-"+b),setTimeout(function(){d.css("display","")},400),setTimeout(function(){d.addClass("tve-leads-triggered")},500)}var b=this.$el.find("#animation-type").val(),c=0,d=this.target,e=d.parents(".tve-animation-preview");jQuery("#TB_ajaxContent").css("overflow","hidden"),setTimeout(a,100)},saveValue:function(){this.model.set("display_animation",this.$el.find("#animation-type").val()),TVE_Dash.showLoader(),this.close();var a=this,b=this.model.save({});ThriveLeads.addFailCallback(b),b.done(function(b){a.model.set(b),TVE_Dash.hideLoader()})}}),LockDisplaySettings:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/lock-display-settings"),events:{"click .tve-save-lead-lock":"saveValue","change #tve-lock-display":"lockDisplayChange"},lockDisplayChange:function(b){var c=a(b.currentTarget);"blur"===c.val()?jQuery(".tve-blur-warning").show():jQuery(".tve-blur-warning").hide()},saveValue:function(){this.model.set("display_animation",this.$el.find("#tve-lock-display").val()),this.model.set("content_lock_display",this.$el.find("#tve-lock-display").val()),TVE_Dash.showLoader(),this.close();var a=this,b=this.model.save({});ThriveLeads.addFailCallback(b),b.done(function(b){a.model.set(b),TVE_Dash.hideLoader()})}}),PHPInsertCode:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/php-insert-code"),afterOpen:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),this.$el.find(".tve-php-code").val(this.model.getPHPCode())}}),InboundLink:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("lightbox/inbound-link-builder"),onOpen:function(){this.bindZclip()},bindZclip:function(){ThriveLeads.bindZClip(this.$el.find("a.tl-inbound-link-copy-btn"))},afterRender:function(){var a=this,b=this.$el.find(".home-base-url").val(),c=this.$el.find(".tl-step3-wrapper-options");return this.model.set("base_url",b),this.collection.each(function(b){c.append(a.renderGroup(b))}),this.updateInboundLink(),this},renderGroup:function(a){return TVE_Dash.tpl("lightbox/inbound-link/group-item",{group:a})},events:{'change input[name="targetAll"]':function(a){0===parseInt(a.currentTarget.value)?this.targetCertainGroups():this.targetAllGroups()},"change .tl-behaviour-period":"displayCustomPeriod","change .tl-post-type-select":"displayPostTypeFields","click .tl-targetGroup":"prepareGroupsArray","change .tl-form-behaviour":"prepareFormTypeArg","change .tl-custom-period-input":"prepareCustomPeriodDaysArg","click .tl-update-inbound-link":"prepareCustomBaseUrlArg","click .tl-inbound-link-copy-btn":"checkSetupsBeforeCopy"},checkSetupsBeforeCopy:function(){var b=a("input.tl-targetGroup:checkbox:checked").length;return 0==b?(TVE_Dash.err(ThriveLeads["const"].translations.MissingTargetGroup),!1):void 0},targetAllGroups:function(){this.$el.find(".tl-step3-wrapper-options input.tl-targetGroup").each(function(){a(this).prop("disabled",!0),a(this).prop("checked",!0)}),this.model.set("target_all",1),this.model.set("groups",[]),this.updateInboundLink()},targetCertainGroups:function(){this.$el.find(".tl-step3-wrapper-options input.tl-targetGroup").each(function(){a(this).removeProp("disabled"),a(this).prop("checked",!1)}),this.model.set("target_all",0),this.updateInboundLink()},displayCustomPeriod:function(a){var b=jQuery(a.currentTarget),c=b.find("option:selected").val();if("2"==c){this.$el.find(".tl-custom-period").show();var d=this.$el.find(".tl-custom-period-input").val();this.model.set("period_days",d)}else this.$el.find(".tl-custom-period").hide(),this.model.set("period_days","");this.model.set("period_type",c),this.updateInboundLink()},displayPostTypeFields:function(a){var b=this,c=this.model,d=this.$el,e=jQuery(a.currentTarget),f=e.find("option:selected"),g=f.val();if("custom-url"==g)this.$el.find(".tl-custom-url").show(),this.$el.find(".tl-find-content").hide();else if(f.hasClass("request-posts")){this.$el.find(".tl-custom-url").hide(),this.$el.find(".tl-find-content").show();var h=d.find(".tl-find-content-input").val("");h.each(function(){var a=jQuery(this);a.autocomplete({appendTo:a.parent(),minLength:2,delay:200,source:function(a,b){jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"tve_leads_find_content_action",q:a.term,type:g}}).done(function(a){b(a)})},select:function(a,e){return d.find(".tl-find-content-input").val(e.item.label),c.set("base_url",e.item.url),b.updateInboundLink(),!1}})})}else{this.$el.find(".tl-custom-url").hide(),this.$el.find(".tl-find-content").hide();var i=f.attr("rel");c.set("base_url",i),this.updateInboundLink()}},prepareGroupsArray:function(){var b=[];a(".tl-targetGroup:checked").each(function(){b.push(this.value)}),this.model.set("groups",b),this.updateInboundLink()},prepareFormTypeArg:function(a){var b=jQuery(a.currentTarget),c=b.find("option:selected").val();this.model.set("form_type",c),this.updateInboundLink()},prepareCustomPeriodDaysArg:function(a){var b=jQuery(a.currentTarget),c=parseFloat(b.val());(isNaN(c)||0>c)&&(c=0),b.val(c),this.model.set("period_days",c),this.updateInboundLink()},prepareCustomBaseUrlArg:function(){var a=this.$el.find(".tl-custom-url-input").val();this.model.set("base_url",a),a?this.updateInboundLink():TVE_Dash.err(ThriveLeads["const"].translations.MissingCustomUrl)},updateInboundLink:function(){var a=this.$el.find("a.tl-inbound-link-copy-btn"),b=this.$el.find("input.tl-targetGroup:checkbox:checked").length;0==b?(a.addClass("tvd-disabled"),this.$el.find(".zclip").remove()):(a.removeClass("tvd-disabled"),this.bindZclip()),this.$el.find(".tl-inbound-link-input").val(this.model.getLink()),a.hasClass("tvd-btn-green")&&(a.removeClass("tvd-btn-green"),a.find(".tl-copy-text").text(ThriveLeads["const"].translations.Copy))}})}});
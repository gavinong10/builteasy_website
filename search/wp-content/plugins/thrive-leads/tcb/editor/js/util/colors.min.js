/*! Thrive Leads - The ultimate Lead Capture solution for wordpress - 2017-01-11
* https://thrivethemes.com 
* Copyright (c) 2017 * Thrive Themes */
var TVE_Content_Builder=TVE_Content_Builder||{};!function(a){var b=0;TVE_Content_Builder.colors={trigger_tpl:'<div class="tve_color_picker_item"><a href="javascript:void(0)"></a></div>',iris_container:"#tve_iris_holder",iris:null,css_mappings:{border:"border-bottom-color","border-color":"border-bottom-color","box-shadow-all":"box-shadow"},css_props:{gradient:"background-image: -webkit-gradient(linear, 50% 0%, 50% 100%, color-stop(0%, [color0]), color-stop(100%, [color1])) !important;background-image: -webkit-linear-gradient([color0] 0%, [color1] 100%) !important;background-image: -moz-linear-gradient([color0] 0%, [color1] 100%) !important;background-image: -o-linear-gradient([color0] 0%, [color1] 100%) !important;background-image: linear-gradient([color0] 0%, [color1] 100%) !important;","inset-box-shadow":"-webkit-box-shadow: inset 0 0 24px [color] !important;-moz-box-shadow: inset 0 0 24px [color] !important;box-shadow: inset 0 0 24px [color] !important;","box-shadow":"-webkit-box-shadow: 10px 10px 5px 0px [color] !important;-moz-box-shadow: 10px 10px 5px 0px [color] !important;box-shadow: 10px 10px 5px 0px [color] !important;","box-shadow-all":"-webkit-box-shadow: [css_values] !important;-moz-box-shadow: [css_values] !important;box-shadow: [css_values] !important;"},custom_classes:"",element_colors:[],current_color:null,current_opacity:null,current_trigger:null,current_type:null,change_timeout_delay:-1,max_color_history:12,current_element:null,on_menu_show:function(b,c){if("text"!=b&&"text_inline_only"!=b||(c=a(".edit_mode")),!c)return!1;var d=a("#"+b+"_menu");this.current_element=c;var e=this.get_color_settings(b,c),f=d.find(".text_colour_picker");return e||f.length?(d.find(".tve_color_picker .tve_options_headline").show(),this.init_once(),this.element_colors=e,this.current_type=b,e&&(this.clear_hover_colors(),this.build_triggers(d,e)),void(f.length&&this.build_text_triggers(f,c))):(d.find(".tve_color_picker .tve_options_headline").hide(),!1)},refresh:function(b){if(this.current_type){var c=a("#"+this.current_type+"_menu"),d=c.find(".text_colour_picker");"undefined"!=typeof b&&b&&(this.element_colors=this.get_color_settings(this.current_type,this.current_element)),this.element_colors&&this.build_triggers(c,this.element_colors),d.length&&this.build_text_triggers(d,a(".edit_mode"))}},init_once:function(){if(!this.iris){var b=this;this.iris=a(this.iris_container).iris({target:a("#tve_current_color"),width:255,mode:"hsv",border:!1,palettes:window.tve_custom_colours,change:function(a,c){b.onChange()}}),this.iris.on("click mousedown",function(a){a.stopPropagation&&a.stopPropagation()});var c=this.iris.find(".wp-opacity-slider"),d=this.iris.find("#tve_cp_opacity");c.slider({value:100,min:0,max:100,slide:function(a,c){var e=parseInt(c.value);d.val(e),b.current_opacity=e/100,b.onChange()}}),d.change(function(){var a=parseInt(this.value);(isNaN(a)||0>a||a>100)&&(a=100,this.value=a),b.current_opacity=a/100,c.slider("option","value",a),b.onChange()}),a("#tve_cp_color").change(function(){try{b.iris.iris("color",this.value)}catch(a){}}),this.iris.find("#tve_cp_save_fav").on("click",function(){var a=b.iris.iris("color");return-1!=window.tve_custom_colours.indexOf(a)?void tve_add_notification("Favourite colour "+a+" already exists!",!0):(window.tve_custom_colours.push(a),window.tve_custom_colours=window.tve_custom_colours.slice(Math.max(window.tve_custom_colours.length-b.max_color_history,0)),void b.iris.iris("option","palettes",window.tve_custom_colours))}),this.iris.find("#tve_cp_ok").on("click",function(){b.hide_picker(),tve_set_window_content_after_action(),window.tve_clr_sel&&(rangy.restoreSelection(window.tve_clr_sel),delete window.tve_clr_sel)});for(var e,f=0;e=tve_path_params.shortcode_colours[f++];)this.custom_classes+=(this.custom_classes?" ":"")+"tve_"+e;a(".active_sub_menu").on("tve.hide_sub_menu",function(){b.hide_picker()})}},get_color_settings:function(a,b){var c=tve_path_params.tve_colour_mapping[a]?tve_path_params.tve_colour_mapping[a]:!1,d=b.attr("data-tve-style");return c&&(c[d]||c[d+"s"])?(c=c[d]?c[d]:c[d+"s"],c[tve_path_params.tve_loaded_stylesheet]?c[tve_path_params.tve_loaded_stylesheet]:c.all?c.all:!1):!1},build_triggers:function(b,c){b.find(".tve_color_picker_container").remove();var d=a('<div class="tve_color_picker_container tve_clearfix"></div>').appendTo(b.find(".tve_color_picker")),e=this;a.each(c,function(a,b){var c=e.build_trigger(a,{});c&&d.append(c)})},build_text_triggers:function(b,c){var d=this;b.each(function(){var b=a(this).hide(),e=rangy.tve_get_selection_node(c),f=a('<div class="tve_color_picker_container tve_clearfix"></div>'),g=b.attr("data-highlight")?1:0,h={label:g?"Highlight color":"Text color",text_picker:1,is_highlight:g,css:g?"backgroundColor":"color",doc_cmd:g?"BackColor":"ForeColor"};h.color=e.length?e.css(h.css):c.css(h.css),b.parent().find(".tve_color_picker_container").remove(),b.parent().append(f),f.append(d.build_trigger(-1,h))})},build_trigger:function(b,c){var d,e;if(-1===b)d=c,e=[d.color?d.color:"none"];else{d=this.element_colors[b];var f=this.css_mappings[d.property]?this.css_mappings[d.property]:d.property,g=this.get_selector(d),h=a(this.get_selector(d,!0));if(h.length&&!a(g).length&&d.force_non_existent)e=h.attr("data-colors"),e=e?e.split("|"):["transparent"];else{if(!a(g).length&&!d.force_selector)return!1;d.hover&&"widget_menu"===this.current_type&&!this.current_element.attr("data-hover-"+b)&&this.current_element.addClass("hovered"),"background-color"!==d.property&&"background-color"!==d.original_property||!a(g).css("background-image")||-1===a(g).css("background-image").indexOf("gradient")?"undefined"!=typeof this.element_colors[b].original_value&&(this.element_colors[b].property="background-color",this.element_colors[b].value=this.element_colors[b].original_value,f="background-color"):(this.element_colors[b].property="background-image",this.element_colors[b].original_property="background-color",this.element_colors[b].original_value=this.element_colors[b].value,this.element_colors[b].value="gradient",f="background-image"),"box-shadow-all"===d.value?e=this.parse_box_shadow(g,d).found_color:(e=d.force_selector?[TVE_Content_Builder.apply_filters("get_static_color_"+this.current_type,"#ca0000",d.force_selector)]:this.parse_colors(a(g).css(f)),e&&e.length||("gradient"===d.value?(e=this.parse_colors(a(g).css("backgroundColor")),e=e&&e.length?[e[0],e[0]]:["transparent","transparent"]):e=["transparent"]))}d.hover||(d.all_colors=e)}d.hover_colors?d.hover&&d.hover_colors&&(e="widget_menu"===this.current_type?this.current_element.attr("data-hover-"+b)?JSON.parse(this.current_element.attr("data-hover-"+b)):e:d.hover_colors):"widget_menu"===this.current_type&&d.hover?(d.hover_colors=this.current_element.attr("data-hover-"+b)?JSON.parse(this.current_element.attr("data-hover-"+b)):e,this.current_element.attr("data-hover-"+b,JSON.stringify(d.hover_colors)),e=d.hover_colors):d.hover_colors=e;for(var i,j,k=a(),l=0;j=e[l++];)i=a(this.trigger_tpl).find("a").attr("title",d.label+(e.length>1?" "+l:"")).css("background-color",j),d.text_picker||(d.cp_index=b,d.color_value=j,d.css_selector=g+(d.additional_elements?","+(d.search_outside?d.additional_elements:modify_selector_edit_mode(d.additional_elements)):""),i.data("color_index",l-1),this.element_colors[b]=d),i.data("color_config",d),i.mousedown(this.save_selection),i.click(this.open_picker),k=k.add(i.parent());return this.current_element.removeClass("hovered"),k},save_selection:function(a){window.tve_clr_sel=rangy.saveSelection(),a.preventDefault()},get_selector:function(a,b){"undefined"==typeof b&&(b=!1);var c=a.selector;return!b&&a.hover&&a.selector_hover&&(c+=" "+a.selector_hover),a.selector_suffix&&!b&&(c+=a.selector_suffix),a.force_selector?c=a.force_selector:a.search_outside?c:modify_selector_edit_mode(c)},parse_colors:function(a){a=escapeHTML("undefined"==typeof a?"":a);var b=/RGB\s*\(\s*-?[0-9]{1,3}%?\s*,\s*-?[0-9]{1,3}%?\s*,\s*-?[0-9]{1,3}%?\)/gi,c=/RGBA\s*\(\s*[0-9]{1,3}%?\s*,\s*[0-9]{1,3}%?\s*,\s*[0-9]{1,3}%?\s*,\s*[0-9]*\.?[0-9]*\s*\)/gi,d=/#[0-9a-f]{3}([0-9a-f]{3})?\b/gi,e=/HSL\s*\(\s*-?[0-9]{1,3}\s*,\s*[0-9]{1,3}%\s*,\s*[0-9]{1,3}%\)/gi,f=/HSLA\s*\(\s*-?[0-9]{1,3}\s*,\s*[0-9]{1,3}%\s*,\s*[0-9]{1,3}%\s*,\s*[0-9]*\.?[0-9]*\s*\)/gi,g=/\bAliceBlue\b|\bAntiqueWhite\b|\bAqua\b|\bAquamarine\b|\bAzure\b|\bBeige\b|\bBisque\b|\bBlack\b|\bBlanchedAlmond\b|\bBlue\b|\bBlueViolet\b|\bBrown\b|\bBurlyWood\b|\bCadetBlue\b|\bChartreuse\b|\bChocolate\b|\bCoral\b|\bCornflowerBlue\b|\bCornsilk\b|\bCrimson\b|\bCyan\b|\bDarkBlue\b|\bDarkCyan\b|\bDarkGoldenRod\b|\bDarkGray\b|\bDarkGreen\b|\bDarkKhaki\b|\bDarkMagenta\b|\bDarkOliveGreen\b|\bDarkorange\b|\bDarkOrchid\b|\bDarkRed\b|\bDarkSalmon\b|\bDarkSeaGreen\b|\bDarkSlateBlue\b|\bDarkSlateGray\b|\bDarkTurquoise\b|\bDarkViolet\b|\bDeepPink\b|\bDeepSkyBlue\b|\bDimGray\b|\bDodgerBlue\b|\bFireBrick\b|\bFloralWhite\b|\bForestGreen\b|\bFuchsia\b|\bGainsboro\b|\bGhostWhite\b|\bGold\b|\bGoldenRod\b|\bGray\b|\bGreen\b|\bGreenYellow\b|\bHoneyDew\b|\bHotPink\b|\bIndianRed\b|\bIndigo\b|\bIvory\b|\bKhaki\b|\bLavender\b|\bLavenderBlush\b|\bLawnGreen\b|\bLemonChiffon\b|\bLightBlue\b|\bLightCoral\b|\bLightCyan\b|\bLightGoldenRodYellow\b|\bLightGrey\b|\bLightGreen\b|\bLightPink\b|\bLightSalmon\b|\bLightSeaGreen\b|\bLightSkyBlue\b|\bLightSlateGray\b|\bLightSteelBlue\b|\bLightYellow\b|\bLime\b|\bLimeGreen\b|\bLinen\b|\bMagenta\b|\bMaroon\b|\bMediumAquaMarine\b|\bMediumBlue\b|\bMediumOrchid\b|\bMediumPurple\b|\bMediumSeaGreen\b|\bMediumSlateBlue\b|\bMediumSpringGreen\b|\bMediumTurquoise\b|\bMediumVioletRed\b|\bMidnightBlue\b|\bMintCream\b|\bMistyRose\b|\bMoccasin\b|\bNavajoWhite\b|\bNavy\b|\bOldLace\b|\bOlive\b|\bOliveDrab\b|\bOrange\b|\bOrangeRed\b|\bOrchid\b|\bPaleGoldenRod\b|\bPaleGreen\b|\bPaleTurquoise\b|\bPaleVioletRed\b|\bPapayaWhip\b|\bPeachPuff\b|\bPeru\b|\bPink\b|\bPlum\b|\bPowderBlue\b|\bPurple\b|\bRed\b|\bRosyBrown\b|\bRoyalBlue\b|\bSaddleBrown\b|\bSalmon\b|\bSandyBrown\b|\bSeaGreen\b|\bSeaShell\b|\bSienna\b|\bSilver\b|\bSkyBlue\b|\bSlateBlue\b|\bSlateGray\b|\bSnow\b|\bSpringGreen\b|\bSteelBlue\b|\bTan\b|\bTeal\b|\bThistle\b|\bTomato\b|\bTurquoise\b|\bViolet\b|\bWheat\b|\bWhite\b|\bWhiteSmoke\b|\bYellow\b|\bYellowGreen\b/gi,h=new RegExp(b.source+"|"+c.source+"|"+d.source+"|"+e.source+"|"+f.source+"|"+g.source,"ig"),i=a.match(h);return i&&3===i.length?i.slice(1,3):i},to_rgba:function(a){var b,c=parseInt,a=a.replace(/\s\s*/g,"");if(b=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(a))b=[c(b[1],16),c(b[2],16),c(b[3],16)];else if(b=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(a))b=[17*c(b[1],16),17*c(b[2],16),17*c(b[3],16)];else if(b=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(a))b=[+b[1],+b[2],+b[3],+b[4]];else{if(!(b=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(a))){if("transparent"===a)return[a];throw Error(a+" is not supported by $.parseColor")}b=[+b[1],+b[2],+b[3]]}return isNaN(b[3])&&(b[3]=1),b.slice(0,7)},open_picker:function(){tve_set_window_content_before_action();var b,c=a(this),d=TVE_Content_Builder.colors.iris.removeClass("tve_iris_bottom"),e=c.css("backgroundColor"),f=c.data("color_config"),g=f.opacity;if(TVE_Content_Builder.colors.current_trigger=c,jQuery("html,body").tve_css("overflow-x","visible","important"),a.when(d.show().iris("color",e).iris("show")).then(function(){d.offset().top<32&&d.addClass("tve_iris_bottom")}),b=d.iris("color",!0),d.find("#tve_opacity_ctrl").css("display",g?"block":"none"),d.find("#tve_cp_title").html(c.attr("title")),d.find("#tve_cp_color").val(b.toString()),TVE_Content_Builder.colors.current_color=b.toString(),g){var h=TVE_Content_Builder.colors.to_rgba(e);h[3]&&(d.find("#tve_cp_opacity").val(Math.round(100*parseFloat(h[3]))).trigger("change"),TVE_Content_Builder.colors.current_opacity=h[3])}else TVE_Content_Builder.colors.current_opacity=null;c.parents(".active_sub_menu").addClass("tve_color_picker_hidden")},hide_picker:function(){jQuery("html,body").tve_css("overflow-x",""),TVE_Content_Builder.colors.iris&&TVE_Content_Builder.colors.iris.hide(),a(".tve_color_picker_hidden").removeClass("tve_color_picker_hidden")},onChange:function(){var a=this.iris.iris("color",!0),c=this.current_trigger.data("color_config"),d=this;if(c.color_index=this.current_trigger.data("color_index"),null!==this.current_opacity){var e=a.toRgb();a="rgba("+e.r+","+e.g+","+e.b+","+this.current_opacity+")"}else a=a.toString();return this.current_trigger.css("backgroundColor",a),this.iris.find("#tve_cp_color").val(a),c.text_picker?this._textColor(a,c):(clearTimeout(b),void(this.change_timeout_delay>0?b=setTimeout(function(){d._customColor(a,c)},this.change_timeout_delay):this._customColor(a,c)))},_customColor:function(b,c){this.element_colors[c.cp_index].color_value=b;var d=this.get_selector(c,!0),e=a(d),f=tve_get_unique_css_identifier(d,"table_cell"!=this.current_type),g=this.get_css(c,[]),h=c.hover?":hover":"",i=c.selector_prefix?c.selector_prefix:"";if(c.hover&&c.selector_hover&&(h+=" "+c.selector_hover),a(TVE_Editor_Page).trigger("editor.beforecolorpickerchange_"+this.current_type,[c]),!c.force_selector){if(c.force_non_existent){var j=e.data("colors");j=j?j.split("|"):[],j[c.cp_index]=b,e.attr("data-colors",j.join("|"))}c.selector_suffix&&(h+=c.selector_suffix);for(var k,l=0;k=f[l++];)a.when(tve_remove_css_rule(k,null,h,i)).then(tve_add_css_rule(i+"[data-tve-custom-colour='"+k+"']"+h,g,0));if(c.apply_extra)for(var m,n=0;m=c.apply_extra[n++];){var o=modify_selector_edit_mode(m.selector),p=tve_get_unique_css_identifier(o,!0,!0),q=m.property+":"+replaceAll("[color]",b,m.value)+(m.important===!1?"":" !important;");a.when(tve_remove_css_rule(p)).then(tve_add_css_rule("[data-tve-custom-colour='"+p+"']",q,0))}a(TVE_Editor_Page).trigger("editor.oncolorpickerchange",[this.current_type,c.property,c]),this.current_element.trigger("editor.oncolorpickerchange",[f[0],c]),c.global_save_key&&(tve_path_params.tve_globals[c.global_save_key]=f[0])}},_textColor:function(a,b){window.textselection||(window.textselection=rangy.saveSelection()),rangy.restoreSelection(window.textselection),window.textselection=rangy.saveSelection();var c=rangy.getSelection();if(c.toString().length){var d=rangy.tve_get_selection_node(jQuery(".edit_mode"));return d.length&&d.is("a")?void d.css(b.css,a):(document.execCommand(b.doc_cmd,!1,a),void c.removeAllRanges())}jQuery(".edit_mode").css(b.css,a)},get_css:function(b,c){var d="undefined"!=typeof b.color_index?b.color_index:!1,e=b.color_value,f=b.hover?"hover_colors":"all_colors",g=this.css_props[b.value]?this.css_props[b.value]:b.property+":"+b.value+(b.important===!1?"":" !important;"),h=!1;switch(b.value){case"gradient":d!==!1?this.element_colors[b.cp_index][f][d]=e:(d=0,e=this.element_colors[b.cp_index][f][0]),g=replaceAll("[color"+d+"]",e,g),g=replaceAll("[color"+(0==d?"1":"0")+"]",b[f][Math.abs(d-1)],g),this.element_colors[b.cp_index][f][b.color_index]=e,h=!0;break;case"box-shadow-all":var i=TVE_Content_Builder.controls.shadow.color_changed(e,!!b.inset);g=replaceAll("[css_values]",TVE_Content_Builder.controls.shadow.get_css_values(i),g),this.element_colors[b.cp_index][f][0]=e,h=!0}h||(g=replaceAll("[color]",e,g),d!==!1&&(this.element_colors[b.cp_index][f][d]=e)),c.push(b.cp_index);for(var j,k=0;j=this.element_colors[k++];){var l=j.hover===b.hover&&j.selector==b.selector&&j.force_selector==b.force_selector;l=l&&b.selector_hover===j.selector_hover,l=l&&b.selector_suffix===j.selector_suffix,l=l&&b.selector_prefix===j.selector_prefix,l&&-1===a.inArray(k-1,c)&&(g+=this.get_css(j,c))}return"widget_menu"===this.current_type&&b.hover&&this.current_element.attr("data-hover-"+b.cp_index,JSON.stringify(this.element_colors[b.cp_index].hover_colors)),g},parse_box_shadow:function(b,c){var d,e=a(b).css("box-shadow"),f={i:"",o:""};if(!e||!e.length||"none"===e)return{found_color:["transparent"],colors:{i:"transparent",o:"transparent"},css_rules:f};"undefined"==typeof c&&(c={inset:1});var g={i:"transparent",o:"transparent"},h=!1;-1!==e.indexOf("rgb")&&(e=e.replace(/rgb(a)?\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*(,)?\s*([0-9]*\.?[0-9]*)?\s*\)/gi,"rgb$1($2_$3_$4_$6)"),e=e.replace("_)",")"),h=!0),e=e.split(",");for(var i,j=0;i=e[j++];)h&&(i=i.replace(/rgb(a)?\(([0-9]{1,3})_([0-9]{1,3})_([0-9]{1,3})(_)?([0-9]*\.?[0-9]*)?\)/gi,"rgb$1($2,$3,$4,$6)"),i=i.replace(",)",")")),d=this.parse_colors(i),-1!==i.indexOf("inset")?(g.i=d&&d.length?d[0]:"transparent",f.i=i):(g.o=d&&d.length?d[0]:"transparent",f.o=i);return{found_color:c.inset?[g.i]:[g.o],colors:g,css_rules:f}},clear_hover_colors:function(){var b=this;a.each(this.element_colors,function(a){delete b.element_colors[a].hover_colors})},apply:function(){for(var b,c=0;b=this.element_colors[c++];){var d=this.get_selector(b,!0),e=tve_get_unique_css_identifier(d,!0,!0),f=this.get_css(b,[]),g=b.hover?":hover":"",h=b.selector_prefix?b.selector_prefix:"";b.hover&&b.selector_hover&&(g+=" "+b.selector_hover),b.selector_suffix&&(g+=b.selector_suffix),a.when(tve_remove_css_rule(e,null,g,h)).then(tve_add_css_rule(h+"[data-tve-custom-colour='"+e+"']"+g,f,0)),a(TVE_Editor_Page).trigger("editor.oncolorpickerchange",[this.current_type,b.property,b]),this.current_element.trigger("editor.oncolorpickerchange",[e,b]),b.global_save_key&&(tve_path_params.tve_globals[b.global_save_key]=e)}}}}(jQuery);
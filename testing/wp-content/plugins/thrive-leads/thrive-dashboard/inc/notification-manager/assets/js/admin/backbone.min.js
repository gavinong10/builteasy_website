/*! Thrive Dashboard - 2017-01-11
* http://www.thrivethemes.com/
* Copyright (c) 2017 Thrive Themes */
var TD_NM=TD_NM||{};TD_NM.util=TD_NM.util||{},function(a){TD_NM.util.camel_case=function(b){var c=b.split("_"),d="";return a.each(c,function(a,b){d+=b.toLowerCase().charAt(0).toUpperCase()+b.slice(1)}),d},TD_NM.util.printf=function(a,b){if(!b)return a;var c=b instanceof Array;return c||(b=[b]),_.each(b,function(b){a=a.replace("%s",b)}),a},TD_NM.util.plural=function(a,b,c){return 1==c?ThriveUlt.util.printf(a,c):ThriveUlt.util.printf(b,c)},TD_NM.util.data_binder=function(b,c){function d(a){return a.is(":checkbox")?!!a.is(":checked"):a.is(":radio")?a.is(":checked")?a.val():"":a.val()}function e(a,c){return a.is(":radio")?b.$el.find('input[name="'+a.attr("name")+'"]:radio').filter('[value="'+c+'"]').prop("checked",!0):a.is(":checkbox")?a.prop("checked",!!c):a.val(c)}if("undefined"==typeof c&&(c=b.model),!(!c instanceof Backbone.Model)){var f=b.$el.find("[data-bind]").each(function(){var f=a(this),g=f.attr("data-bind"),h=!1;f.on("change",function(){var a=d(f);c.get(g)!=a&&(h=!0,c.set(g,a),h=!1)}),b.listenTo(c,"change:"+g,function(){h||e(f,this.model.get(g))})});b.listenTo(c,"invalid",function(a,b){_.isArray(b)?_.each(b,function(a){var b=a;a.field&&(b=a.field);var c=f.filter('[data-bind="'+b+'"]').first().addClass("tvd-validate tvd-invalid").focus();a.message&&c.siblings("label").attr("data-error",a.message),(c.is(":radio")||c.is(":checkbox"))&&TVE_Dash.err(c.next("label").attr("data-error"))}):_.isString(b)&&TVE_Dash.err(b)})}},TD_NM.util.is_email=function(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},TD_NM.util.ajaxurl=function(a){var b=-1!==ajaxurl.indexOf("?")?"&":"?";return a&&a.length?(a=a.replace(/^(\?|&)/,""),a+="&_nonce="+TD_NM.admin_nonce,ajaxurl+b+a):ajaxurl+b+"_nonce="+TD_NM.admin_nonce}}(jQuery);var TD_NM=TD_NM||{};TD_NM.models=TD_NM.models||{},TD_NM.collections=TD_NM.collections||{},function(a){Backbone.emulateHTTP=!0,TD_NM.models.Base=Backbone.Model.extend({idAttribute:"ID",defaults:{ID:""},validation_error:function(a,b){return{field:a,message:b}},url:function(){var b=TD_NM.util.ajaxurl(this.get_action()+"&"+this.get_route());return a.isNumeric(this.get("ID"))&&(b+="&ID="+this.get("ID")),b},get_action:function(){return"action=td_nm_admin_controller"},get_route:function(){return"route=no_route"}}),TD_NM.collections.Base=Backbone.Collection.extend({last:function(){return this.at(this.size()-1)}}),TD_NM.models.Option=TD_NM.models.Base.extend({defaults:{value:null,label:""}}),TD_NM.collections.Options=TD_NM.collections.Base.extend({model:TD_NM.models.Option}),TD_NM.models.Message=TD_NM.models.Base.extend({defaults:{subject:"",content:""},validate:function(a){var b=[];return 0===a.subject.length&&b.push(this.validation_error("subject",TD_NM.t.subject_empty)),0===a.content.length&&b.push(this.validation_error("content",TD_NM.t.message_empty)),b.length?b:void 0}}),TD_NM.models.Action=TD_NM.models.Base.extend({defaults:_.extend({},TD_NM.models.Base.prototype.defaults,{type:null}),get_route:function(){return"route=action"},url:function(){var b=TD_NM.util.ajaxurl(this.get_action()+"&"+this.get_route());return a.isNumeric(this.get("ID"))&&(b+="&ID="+this.get("ID")),a.isNumeric(this.get("notification_id"))&&(b+="&notification_id="+this.get("notification_id")),b}}),TD_NM.models.ActionComplex=TD_NM.models.Action.extend({defaults:_.extend({},TD_NM.models.Action.prototype.defaults,{url:null}),initialize:function(a){this.set("message",new TD_NM.models.Message(a&&a.message?a.message:{})),this.set("recipients",new TD_NM.collections.Options(a&&a.recipients?a.recipients:[]))},validate:function(a){var b=[];return this["validate_"+this.get("type")](b,a),b.length?b:void 0},validate_custom_script:function(a,b){return b.url||a.push(this.validation_error("url",TD_NM.t.invalid_url)),a.length?a:void 0},validate_send_email_notification:function(a,b){var c=this.get("recipients");if(c&&0===c.length)return a.push(TD_NM.t.no_recipient),a;if(c.each(function(b){TD_NM.util.is_email(b.get("value"))||a.push(TD_NM.t.invalid_recipient)}),a.length)return a;var d=this.get("message").validate(this.get("message").attributes);return d instanceof Array&&_.each(d,function(b,c){a.push(b)}),a.length?a:void 0},validate_wordpress_notification:function(a,b){var c=this.get("message").validate(this.get("message").attributes);c instanceof Array&&_.each(c,function(b,c){"subject"!==b.field&&a.push(b)})}}),TD_NM.collections.ActionsComplex=TD_NM.collections.Base.extend({model:TD_NM.models.ActionComplex}),TD_NM.collections.Actions=TD_NM.collections.Base.extend({model:function(a,b){switch(a.type){case"send_email_notification":return new TD_NM.models.ActionSendEmailNotification(a,b);case"custom_script":return new TD_NM.models.ActionCustomScript(a,b);default:return new TD_NM.models.Action(a)}}}),TD_NM.collections.ActionTypes=TD_NM.collections.Base.extend({model:TD_NM.models.Base.extend({defaults:{key:"",label:""}})}),TD_NM.models.ActionCustomScript=TD_NM.models.Action.extend({defaults:_.extend({},TD_NM.models.Action.prototype.defaults,{type:"custom_script",url:null}),validate:function(a){var b=[];return a.url||b.push(this.validation_error("url",TD_NM.t.invalid_url)),b.length?b:void 0}}),TD_NM.models.ActionSendEmailNotification=TD_NM.models.Action.extend({defaults:_.extend({},TD_NM.models.Action.prototype.defaults,{type:"send_email_notification"}),initialize:function(a,b){this.set("message",new TD_NM.models.Message(a&&a.message?a.message:{})),this.set("recipients",new TD_NM.collections.Options(a&&a.recipients?a.recipients:{}))},validate:function(){var a=[],b=this.get("recipients");if(b&&0===b.length)return a.push(TD_NM.t.no_recipient),a;if(b.each(function(b){TD_NM.util.is_email(b.get("value"))||a.push(TD_NM.t.invalid_recipient)}),a.length)return a;var c=this.get("message").validate(this.get("message").attributes);return c instanceof Array&&_.each(c,function(b,c){a.push(b)}),a.length?a:void 0}}),TD_NM.models.BreadcrumbLink=TD_NM.models.Base.extend({defaults:_.extend({},TD_NM.models.Base.prototype.defaults,{hash:"",label:"",full_link:!1}),initialize:function(a){a&&!this.get("ID")&&this.set("ID",a.label.split(" ").join("").toLowerCase()),a&&this.set("full_link",a.hash.match(/^http/))},get_url:function(){return this.get("full_link")?this.get("hash"):"#"+this.get("hash")}}),TD_NM.collections.Breadcrumbs=TD_NM.collections.Base.extend({model:TD_NM.models.Base.extend({defaults:{hash:"",label:""}}),add_page:function(a,b){var c=new TD_NM.models.BreadcrumbLink({hash:a,label:b});return this.add(c)}}),TD_NM.models.OptionCheckbox=TD_NM.models.Option.extend({defaults:_.extend({},TD_NM.models.Option.prototype.defaults,{selected:!1})}),TD_NM.collections.OptionsCheckbox=TD_NM.collections.Options.extend({model:TD_NM.models.OptionCheckbox,match_selected:function(a){var b=this;a.each(function(a){var c=b.findWhere({value:a.get("value")});c&&c.set("selected",!0,{silent:!0})})}}),TD_NM.models.OptionInput=TD_NM.models.Option.extend({defaults:_.extend({},TD_NM.models.Option.prototype.defaults,{selected:!1})}),TD_NM.collections.OptionsInput=TD_NM.collections.Options.extend({model:TD_NM.models.OptionInput}),TD_NM.models.Trigger=TD_NM.models.Base.extend({defaults:{type:null,settings:{}},get_route:function(){return"route=trigger"}}),TD_NM.models.Notification=TD_NM.models.Base.extend({defaults:_.extend({},TD_NM.models.Base.prototype.defaults,{}),initialize:function(a){this.set("trigger",new TD_NM.models.Trigger(a&&a.trigger?a.trigger:{})),this.set("actions",new TD_NM.collections.ActionsComplex(a&&a.actions?a.actions:[]))},get_route:function(){return"route=notification"}}),TD_NM.collections.Notifications=TD_NM.collections.Base.extend({model:TD_NM.models.Notification}),TD_NM.collections.TriggerTypes=TD_NM.collections.Base.extend({model:TD_NM.models.Base.extend({defaults:{key:"",label:""}})}),TD_NM.models.EmailService=TD_NM.models.Base.extend({defaults:{key:null,title:"",connected:!1,active:!1,status:""}}),TD_NM.collections.EmailServices=TD_NM.collections.Base.extend({model:TD_NM.models.EmailService})}(jQuery);var TD_NM=TD_NM||{};TD_NM.views=TD_NM.views||{},function(a){a(function(){TD_NM.views.ModalSteps=TVE_Dash.views.Modal.extend({stepClass:".tvd-nm-modal-step",currentStep:0,$step:null,events:{"click .tvd-nm-modal-next-step":"next","click .tvd-nm-modal-prev-step":"prev"},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this},gotoStep:function(a){var b=this.steps.hide().eq(a).show(),c=this;return this.$step=b,setTimeout(function(){c.input_focus(b)},50),this.currentStep=a,this},next:function(){this.beforeNext()!==!1&&(this.gotoStep(this.currentStep+1),this.afterNext())},prev:function(){this.beforePrev(),this.gotoStep(this.currentStep-1),this.afterPrev()},beforeNext:function(){return this},afterNext:function(){return this},beforePrev:function(){return this},afterPrev:function(){return this}}),TD_NM.views.ModalCreateNotification=TD_NM.views.ModalSteps.extend({className:"tvd-modal-fixed-footer tvd-modal",template:TVE_Dash.tpl("modals/create-notification"),summary_view:null,events:function(){return _.extend(TD_NM.views.ModalSteps.prototype.events,{"click #tvd-nm-trigger-types .tvd-nm-trigger-type":"_select_trigger_type","click #tvd-nm-action-types .tvd-nm-action-type":"_select_action_type","click .tvd-modal-submit":"save"})},afterInitialize:function(){this.data.trigger_types.on("change:selected",this._render_trigger_settings,this),this.data.action_types.on("change:selected",this._render_action_settings,this)},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this._render_trigger_types(),this._render_action_types(),this},_render_summary:function(){this.summary_view=new TD_NM.views.Summary({collection:new TD_NM.collections.Base(this.model.get("trigger"))}),this.$("#tvd-nm-notification-summary").html(this.summary_view.render().$el)},_render_trigger_types:function(){this.data.trigger_types.each(function(a){var b=TVE_Dash.tpl("trigger-type-box");this.$("#tvd-nm-trigger-types").append(b({item:a}))},this)},_render_action_types:function(){this.data.action_types.each(function(a){var b=TVE_Dash.tpl("action-type-box");this.$("#tvd-nm-action-types").append(b({item:a}))},this)},_select_trigger_type:function(b){var c=a(b.currentTarget);c.find(".tvd-card").is(".tvd-nm-selected-card")||(this.$("#tvd-nm-trigger-types .tvd-nm-selected-card").removeClass("tvd-nm-selected-card"),c.find(".tvd-card").addClass("tvd-nm-selected-card"),this.data.trigger_types.forEach(function(a){a.set("selected",!1,{silent:!0})}),this.data.trigger_types.findWhere({key:c.data("trigger-type")}).set("selected",!0))},_select_action_type:function(b){var c=a(b.currentTarget);c.find(".tvd-card").is(".tvd-nm-selected-card")||(this.$("#tvd-nm-action-types .tvd-nm-selected-card").removeClass("tvd-nm-selected-card"),c.find(".tvd-card").addClass("tvd-nm-selected-card"),this.data.action_types.forEach(function(a){a.set("selected",!1,{silent:!0})}),this.data.action_types.findWhere({key:c.data("action-type")}).set("selected",!0))},_render_trigger_settings:function(a){var b=TD_NM.util.camel_case(a.get("key"));this.model.get("trigger").set("type",a.get("key"),{silent:!0}),this.trigger_settings_view&&this.trigger_settings_view.remove();var c=this.$("#tvd-nm-trigger-settings").html("");this.trigger_settings_view=new TD_NM.views["Settings"+b]({model:this.model}),c.html(this.trigger_settings_view.render().$el)},_render_action_settings:function(a){var b=TD_NM.util.camel_case(a.get("key")),c=new TD_NM.models.ActionComplex({type:a.get("key")});this.action_settings_view&&this.action_settings_view.remove(),this.action_settings_view=new TD_NM.views["Settings"+b]({model:c,trigger:this.model.get("trigger")}),this.model.get("actions").reset(c),this.$("#tvd-nm-action-settings").html(this.action_settings_view.render().$el)},beforeNext:function(){return 0===this.currentStep?this.trigger_settings_view.are_valid()?(this.model.get("trigger").set("settings",this.trigger_settings_view.get_settings()),this._render_summary(),!0):(TVE_Dash.err(TD_NM.t.next_step_no_option_selected),!1):!0},afterNext:function(){return 1!==this.currentStep?this:void 0},beforePrev:function(){this.summary_view.remove()},save:function(){if(this.tvd_nm_clear_errors(),0===this.model.get("actions").length)return TVE_Dash.err(TD_NM.t.select_action);if(!this.model.get("actions").last().isValid())return this.tvd_nm_show_errors(this.model.get("actions").last());TVE_Dash.showLoader();var a=this.model,b=this;a.save().done(function(c){a.set("ID",c),a.get("actions").last().set("notification_id",c).set("ID",0),b.collection.add(a),b.close()}).error(function(a){TVE_Dash.err(a.responseJSON.error)}).always(function(){TVE_Dash.hideLoader()})}}),TD_NM.views.ModalAddAction=TD_NM.views.ModalCreateNotification.extend({template:TVE_Dash.tpl("modals/add-action"),afterInitialize:function(){this.data.action_types.on("change:selected",this._render_action_settings,this)},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(1),this._render_summary(),this._render_action_types(),this},_render_action_types:function(){this.data.action_types.each(function(a){var b=this.collection.findWhere({type:a.get("key")});b&&a.set("disable",!0,{silent:!0});var c=TVE_Dash.tpl("action-type-box");this.$("#tvd-nm-action-types").append(c({item:a}))},this)},_select_action_type:function(b){var c=a(b.currentTarget);c.find(".tvd-card").is(".tvd-nm-selected-card")||(this.$("#tvd-nm-action-types .tvd-nm-selected-card").removeClass("tvd-nm-selected-card"),c.find(".tvd-card").addClass("tvd-nm-selected-card"),this.data.action_types.forEach(function(a){a.set("selected",!1,{silent:!0})}),this.data.action_types.findWhere({key:c.data("action-type")}).set("selected",!0))},_render_action_settings:function(a){var b=TD_NM.util.camel_case(a.get("key"));this.model.set("type",a.get("key"),{silent:!0}),this.model.set("notification_id",this.data.notification_model.get("ID"),{silent:!0}),this.action_settings_view&&this.action_settings_view.remove(),this.model.get("message").set("content","",{silent:!0}),this.action_settings_view=new TD_NM.views["Settings"+b]({model:this.model,trigger:this.data.notification_model.get("trigger")}),this.$("#tvd-nm-action-settings").html(this.action_settings_view.render().$el),TVE_Dash.materialize(this.$el)},_render_summary:function(){var a=[];a.push(this.data.notification_model.get("trigger")),a=a.concat(this.data.notification_model.get("actions").models),this.summary_view=new TD_NM.views.Summary({collection:new TD_NM.collections.Base(a)}),this.$("#tvd-nm-notification-summary").html(this.summary_view.render().$el)},save:function(){this.tvd_nm_clear_errors();var a=this;return this.model.isValid()?(TVE_Dash.showLoader(),void this.model.save().done(function(b){TVE_Dash.success(TD_NM.t.action_saved),a.model.set("ID",b,{silent:!0}),a.collection.push(a.model),a.close()}).error(function(a){TVE_Dash.err(a.responseJSON.error)}).always(function(){TVE_Dash.hideLoader()})):this.tvd_nm_show_errors(this.model)}}),TD_NM.views.ModalEditAction=TD_NM.views.ModalCreateNotification.extend({template:TVE_Dash.tpl("modals/edit-action"),afterInitialize:function(){this.data.action_types.on("change:selected",this._render_action_settings,this)},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(1),this._select_action_type(this.model.get("type")),this},_render_action_settings:function(a){var b=TD_NM.util.camel_case(a.get("key"));this.model.set("type",a.get("key"),{silent:!0}),this.model.set("action_name",a.get("label"),{silent:!0}),this.model.set("ID",this.collection.indexOf(this.model),{silent:!0}),this.action_settings_view&&this.action_settings_view.remove(),this.action_settings_view=new TD_NM.views["Settings"+b]({model:this.model,trigger:this.data.trigger}),this.$el.find(".tvd-modal-title").text(TD_NM.util.printf("Edit %s",[this.model.get("action_name")])),this.$("#tvd-nm-action-settings").html(this.action_settings_view.render().$el),TVE_Dash.materialize(this.$el)},_select_action_type:function(a){this.data.action_types.findWhere({key:a}).set("selected",!0),this.action_model=this.data.action_types.findWhere({key:a})},save:function(){if(this.tvd_nm_clear_errors(),!this.model.isValid())return this.tvd_nm_show_errors(this.model);TVE_Dash.showLoader();var a=this.action_settings_view.model,b=this;a.save().done(function(){TVE_Dash.success(TD_NM.t.action_saved),a.trigger("change",a),b.close()}).error(function(a){TVE_Dash.err(a.responseJSON.error)}).always(function(){TVE_Dash.hideLoader()})}}),TD_NM.views.ModalEditTrigger=TD_NM.views.ModalCreateNotification.extend({template:TVE_Dash.tpl("modals/edit-trigger"),afterInitialize:function(){this.data.trigger_types.on("change:selected",this._render_trigger_settings,this)},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this._render_trigger_types(),this.$('#tvd-nm-trigger-types .tvd-nm-trigger-type[data-trigger-type="'+this.model.get("type")+'"]').trigger("click"),this},_render_trigger_types:function(){this.data.trigger_types.each(function(a){if(this.model.get("type")==a.get("key")){var b=TVE_Dash.tpl("trigger-type-box");this.$("#tvd-nm-trigger-types").append(b({item:a}))}},this)},_render_trigger_settings:function(a){var b=TD_NM.util.camel_case(a.get("key"));this.model.set("type",a.get("key"),{silent:!0}),this.trigger_settings_view&&this.trigger_settings_view.remove();var c=this.$("#tvd-nm-trigger-settings").html(""),d=new TD_NM.views["Settings"+b]({model:this.model});this.trigger_settings_view=d,c.html(d.render().$el)},save:function(){if(!this.trigger_settings_view.are_valid())return TVE_Dash.err(TD_NM.t.next_step_no_option_selected),!1;var a=this;this.model.set("settings",this.trigger_settings_view.get_settings(),{silent:!0}),TVE_Dash.showLoader(),this.model.save().done(function(){TVE_Dash.success(TD_NM.t.trigger_saved)}).error(function(a){TVE_Dash.err(a.responseJSON.error)}).always(function(){a.close(),TVE_Dash.hideLoader()})}}),TD_NM.views.ModalDelete=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/delete-confirmation"),events:{"click .tvd-nm-delete-yes":"yes"},yes:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),TVE_Dash.showLoader(),this.model.destroy({success:function(){TVE_Dash.success(TD_NM.t.success_delete)},error:function(){TVE_Dash.err(TD_NM.t.error_delete)},complete:function(){d.close(),TVE_Dash.hideLoader()}})}}),TD_NM.views.ModalEmailServices=TD_NM.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/email-services"),events:function(){return _.extend(TD_NM.views.ModalSteps.prototype.events,{"click .tvd-nm-activate-service":"activate_connection","click .tvd-nm-connection":"connection_form","click .tvd-nm-save-connection":"connection_save","click .tvd-nm-connection-test":"connection_test"})},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this.render_connected_services(),this},render_connected_services:function(){var a=this.$("#tvd-nm-connected-list").empty(),b=TVE_Dash.tpl("services/item"),c=this.$("#tvd-nm-connections-text");0===this.collection.where({connected:!0}).length?c.html(TD_NM.t.no_connection_established):c.html(TD_NM.t.your_existing_connections),this.collection.each(function(c){c.get("connected")===!0&&a.append(b({item:c}))},this)},activate_connection:function(b){var c=this,d=a(b.currentTarget),e=d.data("key");TVE_Dash.showLoader(),a.ajax({type:"post",url:TD_NM.util.ajaxurl(),data:{action:"td_nm_admin_controller",route:"activate_service",service:e}}).success(function(){c.collection.each(function(a){a.set({active:a.get("key")===e},{silent:!0})})}).error(function(){TVE_Dash.err(TD_NM.t.action_failed)}).always(function(){TVE_Dash.hideLoader(),c.render_connected_services()})},beforePrev:function(){2===this.currentStep&&this._render_thumbs()},beforeNext:function(){return 0===this.currentStep&&this._render_thumbs(),this},_render_thumbs:function(){var a=this.$("#tvd-nm-connections-list").empty(),b=TVE_Dash.tpl("services/thumb-item");this.collection.each(function(c){a.append(b({item:c}))})},connection_form:function(b){this.gotoStep(2);var c=a(b.currentTarget),d=c.data("key"),e=this.$("#tvd-nm-connection-form").html(this.$('.tvd-nm-connection-form[data-key="'+d+'"]').html());this.key=d,e.find(".tvd-card-title, .tvd-card-action").hide()},connection_save:function(){TVE_Dash.showLoader();var b=this,c=this.$("#tvd-nm-connection-form"),d=c.find("form"),e={action:"td_nm_admin_controller",route:"setup_connection",service:this.key};a.ajax({type:"post",url:TD_NM.util.ajaxurl(d.serialize()),data:e,dataType:"json"}).success(function(){var c=b.collection.findWhere({key:b.key});c.set("connected",!0,{silent:!0}),c.set("status",TD_NM.t.connected,{silent:!0}),b.collection.each(function(a){a.set({active:a.get("key")===b.key},{silent:!0})}),b.gotoStep(0),a("#td-nm-email-services i").removeClass("tvd-nm-warning-sign"),TVE_Dash.success(TD_NM.t.connection_established)}).error(function(a){TVE_Dash.err(a.responseJSON.error)}).always(function(){b.render_connected_services(),TVE_Dash.hideLoader()})},connection_test:function(b){var c=a(b.currentTarget),d=c.data("key");TVE_Dash.showLoader(),a.ajax({type:"post",url:TD_NM.util.ajaxurl(),data:{action:"td_nm_admin_controller",route:"connection_test",service:d},dataType:"json"}).success(function(a){TVE_Dash.success(a.success)}).error(function(a){TVE_Dash.err(a.responseJSON.error)}).always(function(){TVE_Dash.hideLoader()})}})})}(jQuery);var TD_NM=TD_NM||{};TD_NM.views=TD_NM.views||{},function(a){a(function(){a(document).keypress(function(b){13!=b.which&&13!=b.keyCode||a(".tvd-nm-delete-yes").is(":visible")&&a(".tvd-nm-delete-yes").focus().click()}),Backbone.View.prototype.tvd_nm_clear_errors=function(){return this.$(".tvd-invalid").removeClass("tvd-invalid"),this.$("select").trigger("tvdclear"),this},Backbone.View.prototype.tvd_nm_show_errors=function(b){function c(b){return"string"==typeof b?TVE_Dash.err(b):void(f=f.add(e.$("[data-field="+b.field+"]").addClass("tvd-invalid").each(function(){var c=a(this);c.is("select")?c.trigger("tvderror",b.message):c.next("label").attr("data-error",b.message)})))}if(b=b||this.model){var d=b instanceof Backbone.Model?b.validationError:b,e=this,f=a();return a.isArray(d)?_.each(d,function(a){c(a)}):c(d),f.not(".tvd-no-focus").first().focus(),this.tvd_nm_scroll_first_error(f.first()),this}},Backbone.View.prototype.tvd_nm_scroll_first_error=function(a){if(!(this instanceof TVE_Dash.views.Modal&&a.length))return this;var b=a.offset().top,c=this.$_content.offset().top,d=this.$_content.scrollTop(),e=this.$_content.outerHeight();return b>=c&&e+c-50>b?this:void this.$_content.animate({scrollTop:d+b-c-40},200,"swing")},TD_NM.views.Base=Backbone.View.extend({render:function(){return this.template&&this.$el.html(this.template({item:void 0!==this.model?this.model:{}})),TVE_Dash.materialize(this.$el),this},modal:function(a,b){return TVE_Dash.modal(a,b)},bind_zclip:function(){TVE_Dash.bindZClip(this.$el.find("a.tvd-copy-to-clipboard"))}}),TD_NM.views.Dashboard=TD_NM.views.Base.extend({className:"tvd-container",template:TVE_Dash.tpl("dashboard"),events:{"click .tvd-nm-create-notification":"create_notification"},new_button_view:null,create_notification:function(){this.modal(TD_NM.views.ModalCreateNotification,{trigger_types:new TD_NM.collections.TriggerTypes(TD_NM.trigger_types),action_types:new TD_NM.collections.ActionTypes(TD_NM.action_types),model:new TD_NM.models.Notification,collection:this.collection,"max-width":"60%",width:"750px",collection:this.collection,in_duration:200,out_duration:0})},initialize:function(){this.new_button_view=new TD_NM.views.NewButtonDash,this.listenTo(this.collection,"add",this.toggle_new_button),this.listenTo(this.collection,"add",this._render_notification),this.listenTo(this.collection,"remove",this.toggle_new_button)},render:function(){return this.$el.html(this.template({})),0===this.collection.length&&this._display_new_button_dash(),this._render_notifications(),this},toggle_new_button:function(){this.collection.length?this.new_button_view.remove():this._display_new_button_dash()},_display_new_button_dash:function(){this.$("#tvd-nm-notifications-list").prepend(this.new_button_view.render().$el),this.new_button_view.add_custom_text(TD_NM.t.no_notification_created_yet)},_render_notifications:function(){this.collection.each(this._render_notification,this)},_render_notification:function(a){var b=new TD_NM.views.Notification({model:a});this.$("#tvd-nm-notifications-list").prepend(b.render().$el)}}),TD_NM.views.Header=TD_NM.views.Base.extend({template:TVE_Dash.tpl("header"),events:{"click #td-nm-email-services":"email_services"},email_services:function(){this.modal(TD_NM.views.ModalEmailServices,{collection:TD_NM.globals.email_services,"max-width":"70%",width:"900px",in_duration:200,out_duration:0})}}),TD_NM.views.Breadcrumbs=TD_NM.views.Base.extend({el:a("#tvd-nm-breadcrumbs-wrapper")[0],template:TVE_Dash.tpl("breadcrumbs"),initialize:function(){this.$title=a("head > title"),this.original_title=this.$title.html(),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"add",this.render)},render:function(){this.$el.empty().html(this.template({links:this.collection}))}}),TD_NM.views.Settings=TD_NM.views.Base.extend({render:function(){return this.$el.html(this.template({})),this.options_section_view=this.render_section(),this},render_section:function(a,b,c){var d=new TD_NM.views.OptionsSection({model:b instanceof TD_NM.models.Base?b:this.get_model(),el:a instanceof jQuery?a:this.get_element(),collection:c instanceof TD_NM.collections.Base?c:this.get_collection()});return d.render()},get_model:function(){return this.model=new TD_NM.models.Base({title:"Settings title"})},get_element:function(){return this.$el.append("<div/>")},get_collection:function(){return this.collection=new TD_NM.collections.Options([])},get_settings:function(){return this.collection},are_valid:function(){return!1}}),TD_NM.views.SettingsEmailSignUp=TD_NM.views.Settings.extend({template:TVE_Dash.tpl("triggers/settings/email-sign-up"),render:function(){return this.$el.html(this.template({})),this.render_groups(),this.render_shortcodes(),this.render_thrive_boxes(),this},render_groups:function(){var a=this.$("#tvd-nm-lead-groups-wrapper"),b=new TD_NM.models.Base({title:TD_NM.t.LeadGroups,empty_message:TD_NM.util.printf(TD_NM.t.no_s_to_display,[TD_NM.t.group])}),c=new TD_NM.collections.OptionsCheckbox(TD_NM.tl.groups);if(this.model instanceof TD_NM.models.Trigger){var d=new TD_NM.collections.Options(this.model.get("settings").groups);c.match_selected(d)}return this.group_section_view=this.render_section(a,b,c),this},render_shortcodes:function(){var a=this.$("#tvd-nm-lead-shortcodes-wrapper"),b=new TD_NM.models.Base({title:TD_NM.t.Shortcodes,empty_message:TD_NM.util.printf(TD_NM.t.no_s_to_display,[TD_NM.t.shortcode])}),c=new TD_NM.collections.OptionsCheckbox(TD_NM.tl.shortcodes);if(this.model instanceof TD_NM.models.Trigger){var d=new TD_NM.collections.Options(this.model.get("settings").shortcodes);c.match_selected(d)}return this.shortcodes_section_view=this.render_section(a,b,c),this},render_thrive_boxes:function(){var a=this.$("#tvd-nm-lead-thrive-boxes-wrapper"),b=new TD_NM.models.Base({title:TD_NM.t.ThriveBoxes,empty_message:TD_NM.util.printf(TD_NM.t.no_s_to_display,[TD_NM.t.thrive_box])}),c=new TD_NM.collections.OptionsCheckbox(TD_NM.tl.thrive_boxes);if(this.model instanceof TD_NM.models.Trigger){var d=new TD_NM.collections.Options(this.model.get("settings").thrive_boxes);c.match_selected(d)}return this.thrive_boxes_section_view=this.render_section(a,b,c),this},get_settings:function(){return{groups:this.group_section_view.collection.where({selected:!0}),shortcodes:this.shortcodes_section_view.collection.where({selected:!0}),thrive_boxes:this.thrive_boxes_section_view.collection.where({selected:!0})}},are_valid:function(){return this.group_section_view.collection.where({selected:!0}).length>0?!0:this.shortcodes_section_view.collection.where({selected:!0}).length>0?!0:this.thrive_boxes_section_view.collection.where({selected:!0}).length>0}}),TD_NM.views.SettingsSplitTestEnds=TD_NM.views.Settings.extend({template:TVE_Dash.tpl("triggers/settings/split-test-ends"),render:function(){return this.$el.html(this.template({})),this.render_tl_tests(),this.render_tho_tests(),this},render_tl_tests:function(){var a=this.$("#tvd-nm-tl-tests-wrapper"),b=new TD_NM.models.Base({title:"Thrive Leads Tests",empty_message:TD_NM.util.printf(TD_NM.t.no_s_found,[TD_NM.t.split_tests])}),c=new TD_NM.collections.OptionsCheckbox(TD_NM.split_tests.tl);if(this.model instanceof TD_NM.models.Trigger){var d=new TD_NM.collections.Options(this.model.get("settings").tl);c.match_selected(d)}return this.tl_section_view=this.render_section(a,b,c),this},render_tho_tests:function(){var a=this.$("#tvd-nm-tho-tests-wrapper"),b=new TD_NM.models.Base({title:"Thrive Headline Optimizer",empty_message:TD_NM.util.printf(TD_NM.t.no_s_found,[TD_NM.t.split_tests])}),c=new TD_NM.collections.OptionsCheckbox(TD_NM.split_tests.tho);if(this.model instanceof TD_NM.models.Trigger){var d=new TD_NM.collections.Options(this.model.get("settings").tho);c.match_selected(d)}return this.tho_section_view=this.render_section(a,b,c),this},get_settings:function(){return{tl:this.tl_section_view.collection.where({selected:!0}),tho:this.tho_section_view.collection.where({selected:!0})}},are_valid:function(){return this.tl_section_view.collection.where({selected:!0}).length>0?!0:this.tho_section_view.collection.where({selected:!0}).length>0}}),TD_NM.views.SettingsSendEmailNotification=TD_NM.views.Base.extend({className:"tvd-nm-settings-email-notification",template:TVE_Dash.tpl("actions/settings/send-email-notification"),events:{"click #tvd-nm-add-recipient":"add_recipient"},trigger_model:null,initialize:function(a){a&&a.trigger&&(this.trigger_model=a.trigger),this.listenTo(this.model.get("recipients"),"add",this.render_option)},render:function(){return this.$el.html(this.template({})),this.model.get("recipients").length?this.model.get("recipients").each(function(a){this.render_option(a)},this):this.add_recipient(),this._render_message(),this},render_option:function(a){var b=new TD_NM.views.OptionInputMultipleEmail({collection:this.model.get("recipients"),model:a});this.$("#tvd-nm-recipients-wrapper").append(b.render().$el)},add_recipient:function(){if(!this.model.get("recipients").where({value:null}).length){var a=this.model.get("recipients").last();return void 0===a||TD_NM.util.is_email(a.get("value"))?void 0!==a&&this.model.get("recipients").where({value:a.get("value")}).length>1?void TVE_Dash.err(TD_NM.t.email_duplicated):void this.model.get("recipients").add({value:null,label:TD_NM.t.insert_recipients_email}):void TVE_Dash.err(TD_NM.t.invalid_email)}},_render_message:function(){var a=new TD_NM.views.MessageForm({model:this.model.get("message"),collection:new TD_NM.collections.Base(TD_NM.message_shortcodes[this.trigger_model.get("type")][this.model.get("type")])});this.$("#tvd-nm-message-wrapper").html(a.render().$el)}}),TD_NM.views.SettingsCustomScript=TD_NM.views.Base.extend({template:TVE_Dash.tpl("actions/settings/custom-script"),render:function(){return this.$el.html(this.template(this.model?{item:this.model}:{})),TD_NM.util.data_binder(this),this}}),TD_NM.views.SettingsWordpressNotification=TD_NM.views.Base.extend({template:TVE_Dash.tpl("actions/settings/wordpress-notification"),trigger_model:null,initialize:function(a){a&&a.trigger&&(this.trigger_model=a.trigger)},render:function(){return this.$el.html(this.template(this.model?{item:this.model}:{})),this._render_message(),this},_render_message:function(){var b=this.model.get("message");if(0===b.get("content").length&&this.trigger_model)switch(this.trigger_model.get("type")){case"email_sign_up":b.set("content",TD_NM.t.default_message_send_email_wp);
break;case"split_test_ends":b.set("content",TD_NM.t.default_message_split_test_ends_wp)}var c=new TD_NM.views.MessageForm({model:b,collection:new TD_NM.collections.Base(TD_NM.message_shortcodes[this.trigger_model.get("type")][this.model.get("type")])});c.action_type=this.model.get("type"),c.trigger_type=this.trigger_model.get("type"),this.$("#tvd-nm-message-wrapper").html(c.render().$el),setTimeout(function(){TVE_Dash.materialize(a("#tvd-nm-message-wrapper"))},10)}}),TD_NM.views.OptionsSection=TD_NM.views.Base.extend({render:function(){return this.model&&this.model.get("title")&&this.$el.append("<h4>"+this.model.get("title")+"</h4>"),this.collection.each(this.render_option,this),0===this.collection.length&&this.model&&this.model.get("empty_message")&&this.$el.append('<p class="tvd-center-align tvd-nm-no-notification">'+this.model.get("empty_message")+"</p>"),this},render_option:function(a){var b="Option";a instanceof TD_NM.models.OptionCheckbox&&(b="OptionCheckbox");var c=new TD_NM.views[b]({model:a});return this.$el.append(c.render().$el),this}}),TD_NM.views.Option=TD_NM.views.Base.extend({template:TVE_Dash.tpl("options/option"),render:function(){return this.$el.append(this.template({item:this.model})),this}}),TD_NM.views.OptionCheckbox=TD_NM.views.Option.extend({className:"tvd-col tvd-s4",template:TVE_Dash.tpl("options/checkbox"),events:{'click input[type="checkbox"]':function(b){var c=a(b.currentTarget);this.model.set("selected",c.is(":checked"))}},render:function(){return this.$el.append(this.template({item:this.model})),this.$("input").prop("checked",this.model.get("selected")),this}}),TD_NM.views.OptionInput=TD_NM.views.Option.extend({className:"tvd-nm-option-input tvd-collapse tvd-row",template:TVE_Dash.tpl("options/input"),render:function(){return this.$el.append(this.template({item:this.model})),TD_NM.util.data_binder(this),this}}),TD_NM.views.OptionInputMultiple=TD_NM.views.OptionInput.extend({template:TVE_Dash.tpl("options/input-multiple"),events:{"click .tvd-nm-remove-recipient":"remove_option","blur input":"validate","change input":function(b){a(b.currentTarget).removeClass("tvd-invalid")}},render:function(){return this.$el.append(this.template({item:this.model})),TD_NM.util.data_binder(this),this},remove_option:function(){this.collection.remove(this.model,{silent:!0}),this.remove()},validate:function(){return this}}),TD_NM.views.OptionInputMultipleEmail=TD_NM.views.OptionInputMultiple.extend({validate:function(b){var c=a(b.currentTarget);return b.currentTarget.value.length&&!TD_NM.util.is_email(b.currentTarget.value)?(TVE_Dash.err(TD_NM.t.invalid_email),c.addClass("tvd-invalid"),void b.currentTarget.focus()):void(b.currentTarget.value.length&&this.collection.where({value:this.model.get("value")}).length>1&&(TVE_Dash.err(TD_NM.t.email_duplicated),b.currentTarget.focus(),c.addClass("tvd-invalid")))}}),TD_NM.views.MessageForm=TD_NM.views.Base.extend({events:{"click .tvd-nm-toggle-display":"toggle_tab_display"},template:TVE_Dash.tpl("messages/form"),render:function(){return this.$el.html(this.template({item:this.model})),this.action_type&&"wordpress_notification"===this.action_type&&(this.$("#tvd-nm-message-subject").parents(".tvd-row").first().hide(),this.trigger_type&&"email_sign_up"===this.trigger_type&&this.$("#tvd-nm-message-shortcodes-wrapper").hide()),this.render_shortcodes(),this.bind_zclip(),TD_NM.util.data_binder(this),this},render_shortcodes:function(){var a=this.$("#tvd-nm-message-shortcodes-container");this.collection.each(function(b,c){TVE_Dash.tpl("messages/shortcodes/item");a.append(TVE_Dash.tpl("messages/shortcodes/item")({item:b}))},this)},toggle_tab_display:function(){var a=this.$el.find("#tvd-nm-message-shortcodes-container"),b=a.hasClass("tvd-not-visible");b?(a.hide(0).removeClass("tvd-not-visible").slideDown(200),this.$el.find(".tvd-nm-toggle-display-icon").removeClass("tvd-nm-icon-angle-up").addClass("tvd-nm-icon-angle-down"),this.$el.find(".tvd-nm-toggle-display-text").html(TD_NM.t.hide_available_shortcodes)):(a.slideUp(200,function(){a.addClass("tvd-not-visible")}),this.$el.find(".tvd-nm-toggle-display-text").html(TD_NM.t.show_available_shortcodes),this.$el.find(".tvd-nm-toggle-display-icon").removeClass("tvd-nm-icon-angle-down").addClass("tvd-nm-icon-angle-up"))}}),TD_NM.views.NewButton=TD_NM.views.Base.extend({className:"tvd-col tvd-nm-add-action tvd-pointer",template:TVE_Dash.tpl("new-button"),events:{"click .tvd-card":"add_new_action"},add_custom_text:function(a){this.$el.find(".tvd-nm-new-button-header-text").html(a)},add_new_action:function(){this.modal(TD_NM.views.ModalAddAction,{action_types:new TD_NM.collections.ActionTypes(TD_NM.action_types),model:new TD_NM.models.ActionComplex,notification_model:this.model,collection:this.model.get("actions"),"max-width":"60%",width:"750px",in_duration:200,out_duration:0})}}),TD_NM.views.NewButtonDash=TD_NM.views.NewButton.extend({className:function(){return"tvd-col tvd-s12 tvd-nm-add-action tvd-pointer tvd-nm-create-notification tvd-nm-create-notification-area"},add_custom_text:function(a){this.$el.prepend('<div class="tvd-col tvd-s12 tvd-center-align tvd-nm-no-notification tvd-nm-create-notification-area">'+a+"</div>")},add_new_action:function(){}}),TD_NM.views.Notification=TD_NM.views.Base.extend({className:"tvd-row tvd-nm-notification-item",template:TVE_Dash.tpl("notifications/item"),initialize:function(){this.listenTo(this.model,"remove",this.remove),this.listenTo(this.model.get("actions"),"add",this.reset_notification),this.listenTo(this.model.get("actions"),"remove",this.reset_notification)},render:function(){return this.$el.html(this.template({})),this.render_trigger(this.model.get("trigger")),this.render_actions(this.model.get("actions")),this.model.get("actions").length<TD_NM.action_types.length&&this.render_add_button(),this.render_notification_action_buttons(),this},render_trigger:function(a){var b=new TD_NM.views.SummaryTriggers({collection:new TD_NM.collections.Base([a]),el:this.$("#tvd-nm-trigger-wrapper")});return b.render(),this},render_actions:function(a){var b=new TD_NM.views.SummaryActions({collection:a,el:this.$("#tvd-nm-actions-wrapper")});return b.trigger=this.model.get("trigger"),b.render(),this},render_add_button:function(){var a=new TD_NM.views.NewButton({model:this.model});this.$("#tvd-nm-actions-wrapper").append(a.render().$el),a.add_custom_text(TD_NM.t.add_new_action)},render_notification_action_buttons:function(){var a=new TD_NM.views.NotificationActionButtons({model:this.model});this.$("#tvd-nm-actions-wrapper").append(a.render().$el)},reset_notification:function(){this.$el.empty(),this.render()}}),TD_NM.views.NotificationActionButtons=TD_NM.views.Base.extend({className:"tvd-right tvd-nm-notification-action-buttons",template:TVE_Dash.tpl("options/action-buttons"),events:{"click .tvd-nm-delete-notification":"delete_notification_modal"},delete_notification_modal:function(){this.modal(TD_NM.views.ModalDelete,{model:this.model,"max-width":"60%",width:"750px",in_duration:200,out_duration:0})}}),TD_NM.views.NotificationSummary=TD_NM.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/notification-summary"),render:function(){return this.$el.html(this.template({trigger:this.trigger_model,action:this.action_model})),this}}),TD_NM.views.Summary=TD_NM.views.Base.extend({className:"tvd-row tvd-nm-summary",render:function(){return this.collection.each(this.render_item,this),this},render_item:function(a){var b="SummaryItem";(a instanceof TD_NM.models.Trigger||a instanceof TD_NM.models.Action)&&(b="SummaryItemNotification");var c=new TD_NM.views[b]({model:a,collection:this.collection});return this.$el.append(c.render().$el),this}}),TD_NM.views.SummaryActions=TD_NM.views.Summary.extend({render_item:function(a){var b=new TD_NM.views.SummaryItemAction({model:a,collection:this.collection});return b.trigger=this.trigger,this.$el.append(b.render().$el),this}}),TD_NM.views.SummaryTriggers=TD_NM.views.Summary.extend({render_item:function(a){var b=new TD_NM.views.SummaryItemTrigger({model:a,collection:this.collection});return this.$el.append(b.render().$el),this}}),TD_NM.views.SummaryItem=TD_NM.views.Base.extend({className:"tvd-col tvd-s2 tvd-nm-summary-item",template:TVE_Dash.tpl("summaries/item"),events:{"click .tvd-nm-action-edit":"edit_action","click .tvd-nm-action-delete":"delete_action"},edit_action:function(){this.modal(TD_NM.views.ModalEditAction,{action_types:new TD_NM.collections.ActionTypes(TD_NM.action_types),trigger:this.trigger,model:this.model,collection:this.collection,"max-width":"60%",width:"750px",in_duration:200,out_duration:0})},delete_action:function(){this.modal(TD_NM.views.ModalDelete,{model:this.model,"max-width":"60%",width:"750px",in_duration:200,out_duration:0})}}),TD_NM.views.SummaryItemAction=TD_NM.views.Base.extend({className:"tvd-col",template:TVE_Dash.tpl("summaries/items/action"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"remove",this.remove_item)},render:function(){var a="SummaryItem";"send_email_notification"===this.model.get("type")?a+="SendEmailNotification":"custom_script"===this.model.get("type")?a+="CustomScript":"wordpress_notification"===this.model.get("type")&&(a+="WordpressNotification");var b=new TD_NM.views[a]({model:this.model,collection:this.collection});return b.trigger=this.trigger,this.$el.html(""),this.$el.append(b.render().$el),this},remove_item:function(){this.collection.each(function(a,b){a.set("ID",b)})}}),TD_NM.views.SummaryItemCustomScript=TD_NM.views.SummaryItem.extend({specific_class:"",className:function(){return"tvd-card tvd-white tvd-small tvd-valign-wrapper tvd-nm-summary-item-action tvd-nm-action td-nm-equal-width-action "+this.specific_class},template:TVE_Dash.tpl("summaries/items/actions/custom-script"),render:function(){return this.collection.indexOf(this.model)===TD_NM.action_types.length-1&&this.$el.addClass("tvd-nm-no-icon-action"),this.$el.html(this.template({item:this.model})),this.bind_zclip(),this}}),TD_NM.views.SummaryItemSendEmailNotification=TD_NM.views.SummaryItem.extend({specific_class:"",className:function(){return"tvd-card tvd-white tvd-small tvd-valign-wrapper tvd-nm-summary-item-action tvd-nm-action td-nm-equal-width-action "+this.specific_class},template:TVE_Dash.tpl("summaries/items/actions/send-email-notification"),render:function(){return this.collection.indexOf(this.model)===TD_NM.action_types.length-1&&this.$el.addClass("tvd-nm-no-icon-action"),this.$el.html(this.template({item:this.model})),this.render_recipients(),this},render_recipients:function(){var a=this.$(".tvd-nm-emails-list"),b=1,c=this.model.get("recipients").length;this.model.get("recipients").every(function(d,e){var f=TVE_Dash.tpl("options/recipient");if(b-1>=e)return a.append(f({item:d})),e!=b-1&&1!=c&&a.append("<span>,&nbsp;</span>"),!0;var g=c-b,h=new TD_NM.models.Base({value:"+"+g+" "+TD_NM.t.others});return a.append("<span>,&nbsp;</span>"),a.append(f({item:h})),!1})}}),TD_NM.views.SummaryItemWordpressNotification=TD_NM.views.SummaryItem.extend({specific_class:"tvd-nm-action-wp",className:function(){return"tvd-card tvd-white tvd-small tvd-valign-wrapper tvd-nm-summary-item-action tvd-nm-action td-nm-equal-width-action "+this.specific_class},template:TVE_Dash.tpl("summaries/items/actions/wordpress-notification"),render:function(){return this.collection.indexOf(this.model)===TD_NM.action_types.length-1&&this.$el.addClass("tvd-nm-no-icon-action"),this.$el.html(this.template({item:this.model})),this.bind_zclip(),this}}),TD_NM.views.SummaryItemTrigger=TD_NM.views.SummaryItem.extend({className:"tvd-card tvd-white tvd-small tvd-valign-wrapper tvd-nm-summary-item-trigger",template:TVE_Dash.tpl("summaries/items/trigger"),events:{"click .tvd-nm-edit-trigger":"edit"},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){var a=TD_NM.globals.trigger_types.findWhere({key:this.model.get("type")});return this.model.set("label",a.get("label"),{silent:!0}).set("icon",a.get("icon"),{silent:!0}),this.$el.html(this.template({item:this.model})),this},edit:function(){this.modal(TD_NM.views.ModalEditTrigger,{trigger_types:TD_NM.globals.trigger_types,model:this.model,"max-width":"60%",width:"750px",in_duration:200,out_duration:0})}}),TD_NM.views.SummaryItemNotification=TD_NM.views.SummaryItem.extend({className:"tvd-col tvd-s3",template:TVE_Dash.tpl("summaries/items/notification"),render:function(){var a=null;return this.model instanceof TD_NM.models.Trigger?(a=TD_NM.globals.trigger_types.findWhere({key:this.model.get("type")}),this.model.set("color","tvd-green-text").set("class","tvd-nm-summary-item-trigger")):(a=TD_NM.globals.action_types.findWhere({key:this.model.get("type")}),this.model.set("color","tvd-blue-text").set("class","tvd-nm-summary-item-action")),this.model.set("label",a.get("label")).set("icon",a.get("icon")),this.$el.html(this.template({item:this.model})),this}}),TD_NM.views.Unavailable=TD_NM.views.Base.extend({template:TVE_Dash.tpl("unavailable")})})}(jQuery);var TD_NM=TD_NM||{};_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},Backbone.ajax=function(){return-1===arguments[0].url.indexOf("_nonce")&&(arguments[0].url+="&_nonce="+TD_NM.admin_nonce),Backbone.$.ajax.apply(Backbone.$,arguments)},function(a){var b=Backbone.Router.extend({view:null,$el:a("#tvd-nm-wrapper"),routes:{dashboard:"dashboard"},breadcrumbs:{collection:null,view:null},init_breadcrumbs:function(){this.breadcrumbs.collection=new TD_NM.collections.Breadcrumbs,this.breadcrumbs.view=new TD_NM.views.Breadcrumbs({collection:this.breadcrumbs.collection})},dashboard:function(){this._set_page("dashboard",TD_NM.t.NM_Dashboard),this.view&&this.view.remove(),this._render_header(),0!==TD_NM.trigger_types.length?this.view=new TD_NM.views.Dashboard({collection:new TD_NM.collections.Notifications(TD_NM.notifications)}):this.view=new TD_NM.views.Unavailable({}),this.$el.html(this.view.render().$el)},_render_header:function(){this.header?this.header.setElement(a(".tvu-header")):this.header=new TD_NM.views.Header({el:"#tvd-nm-header"}),this.header.render()},_set_page:function(b,c,d){this.breadcrumbs.collection.reset(),d=d||{},this.breadcrumbs.collection.add_page(TD_NM.dash_url,TD_NM.t.Thrive_Dashboard,!0),_.each(d,_.bind(function(a){this.breadcrumbs.collection.add_page(a.route,a.label)},this)),this.breadcrumbs.collection.add_page("",c);var e=a("head > title");this.original_title||(this.original_title=e.html()),e.html(c+" &lsaquo; "+this.original_title)}});a(function(){TD_NM.globals=TD_NM.globals||{},TD_NM.globals.trigger_types=new TD_NM.collections.TriggerTypes(TD_NM.trigger_types),TD_NM.globals.action_types=new TD_NM.collections.ActionTypes(TD_NM.action_types),TD_NM.globals.email_services=new TD_NM.collections.EmailServices(TD_NM.email_services),TD_NM.router=new b,TD_NM.router.init_breadcrumbs(),Backbone.history.start({hashchange:!0}),Backbone.history.fragment||TD_NM.router.navigate("#dashboard",{trigger:!0})})}(jQuery);
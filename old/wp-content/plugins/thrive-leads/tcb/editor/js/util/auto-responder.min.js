/*! Thrive Leads - The ultimate Lead Capture solution for wordpress - 2017-01-11
* https://thrivethemes.com 
* Copyright (c) 2017 * Thrive Themes */
var TVE_Content_Builder=TVE_Content_Builder||{};!function(a){function b(b,c){var d=a.extend({post_id:tve_path_params.post_id,action:"tve_api_editor_actions"},tve_path_params.custom_post_data,b),e=a.extend({url:tve_path_params.ajax_url,data:d,type:"post"},c);return a.ajax(e)}var c,d,e=Math.floor(238*Math.random());TVE_Content_Builder.auto_responder={init:function(){return c=a(".edit_mode").tve_lead_generation(),d=a("#tve_lightbox_frame"),this},dashboard:function(a){TVE_Editor_Page.overlay();var e=c.getConnectionType(),f=a&&a.attr("data-edit-custom")?"1":0;delete c.edit_api,b({route:"dashboard",connection_type:e,edit_custom_html:f,connections:c.getApiConnections(),custom_messages:c.getCustomMessages(),connections_str:c.api_config_str,custom_messages_str:c.custom_messages_str,thank_you_url:c.api_form_data.thank_you_url,submit_option:c.api_form_data.submit_option,asset_option:c.asset_option,error_message_option:c.error_message_option,asset_group:c.asset_group,state:c.state,use_captcha:c.use_captcha,api_fields:c.api_form_data.elements||null,api_fields_order:c.api_form_data.element_order||null}).done(function(a){load_lightbox_content(a.lb_html);var b=c.customFormCode();show_lightbox(),"custom-html"==e&&b&&f?(d.find('textarea[name="tve_lead_generation_code"]').val(b),jQuery(".tve_lead_generate_fields").trigger("click")):"api"==e&&a.elements&&(c.setApiData(a),TVE_Content_Builder.auto_responder.bindZClip(d.find("a.tve-copy-to-clipboard"))),c.set_captcha_data(),d.find(".tve_lightbox_buttons").hide(),TVE_Editor_Page.overlay(!0)})},bindZClip:function(a){function b(){try{a.closest(".tve-copy-row").find("input.tve-copy").on("click",function(a){this.select(),a.preventDefault(),a.stopPropagation()}),a.zclip({path:tve_frontend_options.dash_url+"/js/util//jquery.zclip.1.1.1/ZeroClipboard.swf",copy:function(){return jQuery(this).parents(".tve-copy-row").find("input").val()},afterCopy:function(){var a=jQuery(this);a.prev().select(),a.removeClass("tve_editor_button_blue").addClass("tve_editor_button_success").find(".tve-copy-text").html('<span class="thrv-icon-checkmark"></span>'),setTimeout(function(){a.removeClass("tve_editor_button_success").addClass("tve_editor_button_blue").find(".tve-copy-text").html(tve_frontend_options.translations.Copy)},3e3),a.parent().prev().select()}})}catch(b){console.log(b),console.error&&console.error("Error embedding zclip - most likely another plugin is messing this up")&&console.error(b)}}setTimeout(b,200)},clearMCEEditor:function(a){if("undefined"!=typeof tinymce&&tinymce){var b=["tve_success_wp_editor","tve_error_wp_editor"];b.forEach(function(b){if(a!=b){var c=tinymce.get(b);c&&(c.destroy(),tinymce.execCommand("mceRemoveControl",!0,b))}})}},generate_fields:function(){TVE_Editor_Page.overlay();var a=d.find('textarea[name="tve_lead_generation_code"]'),e={autoresponder_code:a.val(),custom:tve_path_params.custom_post_data,route:"generateFields"};b(e,{dataType:"json"}).done(function(b){jQuery("#generated_inputs_container").html(b.html),a.val(b.stripped_code),c.setParsedResponse(b),TVE_Editor_Page.overlay("close")})},save_custom_code:function(a){var b=jQuery(".tve-asset-select-holder").find("select#tve-api-submit-option").val();"undefined"!=typeof b&&"null"!=typeof b||(b=""),"undefined"===c.asset_group||"null"===c.asset_group?c.asset_group="":c.asset_group!==b&&(c.asset_group=b),c.jsonFields.elements._asset_group={type:"hidden",name:"_asset_group",value:c.asset_group||b},c.jsonFields.elements._asset_option={type:"hidden",name:"_asset_option",value:c.asset_option||""},c.generateForm().applyStyle(),TVE_Content_Builder.controls.lb_close()},save_api_connection:function(){var d={},e=c.getConnectionType(),f="";a("#tve-error-message-option").is(":checked")&&(d.error="undefined"!=typeof tinymce&&tinymce&&tinymce.get("tve_error_wp_editor")?tinymce.get("tve_error_wp_editor").getContent():a("#tve_error_wp_editor").val()),"message"==c.api_form_data.submit_option&&(d.success="undefined"!=typeof tinymce&&tinymce?tinymce.get("tve_success_wp_editor").getContent():a("#tve_success_wp_editor").val()),"undefined"==typeof c.form_state&&(c.form_state=a(".tve_change_states").find(":selected").attr("data-state")),c.setCustomMessages(d),TVE_Editor_Page.overlay(),TVE_Content_Builder.auto_responder.clearMCEEditor(),b({route:"encodeMessages",connection_type:e,custom_messages:c.getCustomMessages()}).done(function(a){a&&(f=a.custom_messages,c.api_form_data.elements.__tcb_lg_msg={type:"hidden",name:"__tcb_lg_msg",value:f}),TVE_Editor_Page.overlay(!0),TVE_Content_Builder.auto_responder.create_fields()})},create_fields:function(){var b=jQuery(".tve-asset-select-holder").find("select#tve-api-submit-option").val();"undefined"!=typeof b&&"null"!=typeof b||(b=""),"undefined"===c.asset_group||"null"===c.asset_group?c.asset_group="":c.asset_group!==b&&(c.asset_group=b),c.api_form_data.elements._asset_group={type:"hidden",name:"_asset_group",value:c.asset_group||b},c.api_form_data.elements._asset_option={type:"hidden",name:"_asset_option",value:c.asset_option||""},c.api_form_data.elements._error_message_option={type:"hidden",name:"_error_message_option",value:c.error_message_option||""},c.api_form_data.elements._back_url={type:"hidden",name:"_back_url",value:c.api_form_data.thank_you_url||""},c.api_form_data.elements._submit_option={type:"hidden",name:"_submit_option",value:c.api_form_data.submit_option||""},c.api_form_data.elements._use_captcha={type:"hidden",name:"_use_captcha",value:c.use_captcha||""},"state"==c.api_form_data.submit_option&&(c.api_form_data.elements._state={type:"hidden",name:"_state",value:c.state||""},c.api_form_data.elements.state_change_trigger={type:"state_change_trigger",value:c.state||""},c.api_form_data.form_state=c.form_state);for(var d in c.captcha_options)c.api_form_data.elements[d]={type:"hidden",name:"_"+d,value:c.captcha_options[d]};a.each(c.api_form_data.extra,function(b,d){c.api_config[b]&&a.each(d,function(a,d){c.api_form_data.elements[b+"_"+a]={type:"hidden",className:"tve-api-extra",name:b+"_"+a,value:d}})}),c.generateForm().applyStyle(),TVE_Content_Builder.controls.lb_close()},open_icon_picker:function(b){var c=b.parent(),d=a("#tve_lg_icon_list").show();if(d.find(".icomoon-icon").removeClass("tve_selected"),c.find(".icomoon-icon").length){var e=c.find(".icomoon-icon").data("cls");d.find('[data-cls="'+e+'"]').addClass("tve_selected")}this.icon_container=c},choose_icon:function(b){if(a("#tve_lg_icon_list").hide(),this.icon_container){var d=this.icon_container.find(".tve_lg_icon_picker").attr("data-field");this.icon_container.find(".icomoon-icon").remove();var e=b.clone().removeClass("tve_selected tve_click").removeAttr("data-ctrl");e.find(".tve-ic-checkmark").remove(),this.icon_container.append(e),"api"==c.getConnectionType()&&c.api_form_data.elements&&c.api_form_data.elements[d]&&(c.api_form_data.elements[d].icon=e.attr("data-cls"))}},remove_custom_html:function(){c.customFormCode(""),c.connection_type="",this.dashboard()},connection_form:function(d){TVE_Content_Builder.auto_responder.clearMCEEditor(),TVE_Editor_Page.overlay();var e=d.attr("data-step2")?a("#connection-type").val():d.attr("data-connection-type");c.edit_api=d.attr("data-key")?d.attr("data-key"):"",b({route:"form",connections:c.getApiConnections(),api_fields:c.api_form_data.elements||null,connection_type:e,edit:c.edit_api,extra:c.api_form_data&&c.api_form_data.extra?c.api_form_data.extra:{}}).done(function(a){load_lightbox_content(a.lb_html),c.connection_type=e,show_lightbox(),TVE_Editor_Page.overlay(!0)})},use_captcha_changed:function(a){c.use_captcha=a.is(":checked")?1:0;var b=a.parents(".tve_lead_captcha_settings").find(".tve_captcha_options");c.use_captcha?b.show():b.hide()},captcha_option_changed:function(a){var b=a.attr("data-option");a.find("option:selected").length&&(c.captcha_options[b]=a.find("option:selected").val())},asset_group:function(a){var b=a.val();c.asset_group=b},asset_option_changed:function(a){var b=a.is(":checked")?1:0,d=a.parent().next(".tve-asset-select-holder").hide();1==b&&d.show(),c.asset_option=b},error_message_option_changed:function(a){var b=a.is(":checked")?1:0,e=a.parent().next(".tve-error-message-wrapper").hide(),f=a.closest(".tve_lightbox_content").find(".tve-shortcodes-error"),g=a.closest(".tve_lightbox_content").find(".tve-shortcodes-message"),h=a.closest(".tve_lightbox_content").find(".tve-api-submit-filters").val();1==b?(e.show(),f.show(),TVE_Content_Builder.auto_responder.bindZClip(d.find("a.tve-copy-to-clipboard")),g.hide()):(f.hide(),"message"==h&&(g.show(),TVE_Content_Builder.auto_responder.bindZClip(d.find("a.tve-copy-to-clipboard")))),c.error_message_option=b},messages_change:function(){var b={};b.success="undefined"!=typeof tinymce&&tinymce?tinymce.get("tve_success_wp_editor").getContent():a("#tve_success_wp_editor").val(),b.error="undefined"!=typeof tinymce&&tinymce?tinymce.get("tve_error_wp_editor").getContent():a("#tve_error_wp_editor").val(),c.setCustomMessages(b),this.dashboard()},api:{readExtraSettings:function(b){var d=c&&c.api_form_data&&c.api_form_data.extra?c.api_form_data.extra:{},e=!1;return b.find(".tve-api-extra").filter(":not(.tve_disabled)").each(function(){var b=a(this),c=b.attr("name").split("_"),f=c.shift(),g=c.join("_");e||(e=!0,d[f]={}),b.is("input:radio, input:checkbox")?b.is(":radio")&&b.is(":checked")?d[f][g]=b.val():b.is(":checkbox")&&b.is(":checked")&&(d[f][g]?d[f][g]+=","+b.val():d[f][g]=b.val()):(d[f]=d[f]||{},d[f][g]=b.val())}),d},_ajax:function(d){return TVE_Editor_Page.overlay(),d=a.extend({action:"tve_api_editor_actions",connections:c.getApiConnections(),api_fields:c.api_form_data.elements||null,ajax_load:""},d),b(d).done(function(){TVE_Editor_Page.overlay("close")})},reload_apis:function(){a("#thrive-api-list").remove(),this._ajax({route:"apiSelect",force_fetch:"1",edit:c.edit_api,extra:c.api_form_data&&c.api_form_data.extra?c.api_form_data.extra:{}}).done(function(b){a("#thrive-api-connections").replaceWith(b)})},api_get_lists:function(b,d){this._ajax({route:"apiLists",api:b.jquery?b.val():b,force_fetch:"undefined"!=typeof d&&d===!0?"1":0,extra:c.api_form_data&&c.api_form_data.extra?c.api_form_data.extra:{}}).done(function(b){a("#thrive-api-list").replaceWith(b)})},api_get_groups:function(b){var d=b.attr("data-api");this._ajax({route:"apiGroups",api:d,list:b.jquery?b.val():b,force_fetch:"1",extra:c.api_form_data&&c.api_form_data.extra?c.api_form_data.extra:{}}).done(function(b){a("#thrive-api-groups").replaceWith(b)})},reload_lists:function(a){this.api_get_lists(a.attr("data-api"),!0)},save:function(b){var e=a("#thrive-api-connections-select"),f=a("#thrive-api-list-select"),g=f.val();if(!e.val()||!g)return alert(tve_path_params.translations.ChooseExistingAPI),!0;if(TVE_Content_Builder.auto_responder[e.val()]&&"function"==typeof TVE_Content_Builder.auto_responder[e.val()].validate){var h=TVE_Content_Builder.auto_responder[e.val()].validate();if(!h)return!1}b.attr("data-edit")&&b.attr("data-edit")!=e.val()&&c.removeApiConnection(b.attr("data-edit")),c.setApiConnection(e.val(),g),TVE_Content_Builder.auto_responder.dashboard(),"klicktipp-redirect"==c.api_form_data.submit_option&&Object.keys(c.api_form_data.connections).length>1&&(c.api_form_data.submit_option=""),c.api_form_data.extra=this.readExtraSettings(d)},remove:function(a){TVE_Content_Builder.auto_responder.clearMCEEditor(),c.removeApiConnection(a.attr("data-key")),TVE_Content_Builder.auto_responder.dashboard()},thank_you_url:function(a){var b=a.val();b.match(/^http(s)?/)||b.match(/^\/\//)||(b="http://"+b,a.val(b)),c.api_form_data.thank_you_url=b},add_new_field:function(){var b=a(".tve-custom-fields").last(),c=a(".tve-custom-fields-container"),d=b.clone();if(0==d.find(".tve_lightbox_link_remove").length){var e='<div class="tvd-col tvd-s4"><a href="javascript:void(0)" data-ctrl="auto_responder.api.remove_field" class="tve_click tve_lightbox_link tve_lightbox_link_remove">'+tve_path_params.translations.RemoveCustomFields+"</a></div>";d.append(e)}d.appendTo(c)},remove_field:function(a){var b=a.parentsUntil(".tve-custom-fields-container");b.remove()},change_input_name:function(a){var b=/^[A-Za-z0-9-_]+$/,c=a.val(),d=a.closest(".tve-custom-fields");return b.test(c)?void d.find(".drip-custom-field-value").attr("name","drip_field["+c+"]"):void alert("No spaces, commas, dots, or special characters are allowed")},change_integration_type:function(b){var c=a(".tve_lightbox_content"),d=".tve-api-option-group-"+b.val();c.find(".tve-api-option-group").hide().find(".tve-api-extra").removeClass("tve-api-extra"),c.find(d).show().find("input, select").addClass("tve-api-extra")},submit_option_changed:function(a){var b=a.val(),e=a.parent().next("input").hide(),f=a.closest(".tve_lightbox_content").find(".tve_message_settings").hide(),g=a.closest(".tve_lightbox_content").find(".tve_state_settings").hide(),h=a.closest(".tve_lightbox_content").find("#tve-error-message-option"),i=a.closest(".tve_lightbox_content").find(".tve-shortcodes-message"),j=a.closest(".tve_lightbox_content").find(".tve-shortcodes-error");switch(b){case"reload":i.hide();break;case"redirect":e.show(),i.hide();break;case"message":f.show(),h.is(":checked")?i.hide():(i.show(),TVE_Content_Builder.auto_responder.bindZClip(d.find("a.tve-copy-to-clipboard")));break;case"state":g.show(),i.hide(),c.state=a.parentsUntil(".tve_lightbox_content").find(".tve_change_states").val()}h.is(":checked")?(j.show(),TVE_Content_Builder.auto_responder.bindZClip(d.find("a.tve-copy-to-clipboard"))):j.hide(),c.api_form_data.submit_option=b},state_changed:function(a){var b=a.val(),d=a.find(":selected").attr("data-state");c.state=b,c.form_state=d}}},jQuery.fn.extend({tve_lead_generation:function(){var b=this,f={code_separator:"__CONFIG_lead_generation_code__",$formContainer:b.find(".thrv_lead_generation_container"),jsonFields:null,form_code:"",api_config:{},custom_messages:{},connection_type:"",api_form_data:{},use_captcha:0,asset_option:"",error_message_option:"",asset_group:"",state:"",captcha_options:{captcha_theme:"light",captcha_type:"image",captcha_size:"normal"},init:function(){return"1"!==b.data("tve-version")&&this.upgradeHtml(),this.readCustomFormCode(),this.connection_type=b.attr("data-connection"),this.connection_type||(this.connection_type=this.customFormCode().length?"custom-html":""),"api"==this.connection_type?this.readApiElements():"custom-html"==this.connection_type&&(this.asset_option=b.find("input#_asset_option").val()||0,this.error_message_option=b.find("input#_error_message_option").val()||0,this.asset_group=b.find("input#_asset_group").val()||0,this.use_captcha=0),this.readCaptchaOptions(),this},getConnectionType:function(){return this.connection_type},setApiConnection:function(a,b){this.api_config[a]=b,this.connection_type="api"},getApiConnections:function(){return this.api_config},setCustomMessages:function(a){this.custom_messages=a},getCustomMessages:function(){return this.custom_messages},removeApiConnection:function(a){delete this.api_config[a],jQuery.isEmptyObject(this.api_config)&&(this.connection_type="")},setParsedResponse:function(a){this.jsonFields=a,this.customFormCode(a.stripped_code),this.persistentData()},readCustomFormCode:function(){return this.form_code=b.find(".thrv_lead_generation_code").text().replace(new RegExp(this.code_separator,"g"),""),this},writeCustomFormCode:function(){return"api"!=this.connection_type?b.find(".thrv_lead_generation_code").text(this.code_separator+this.form_code+this.code_separator):b.find(".thrv_lead_generation_code").text(""),this.config("connection",this.connection_type),this},customFormCode:function(){return arguments.length?(this.form_code=arguments[0],this):this.form_code},upgradeHtml:function(){var c=b.find('input[type="text"], input[type="email"]');c.length&&c.each(function(){var b=a(this);"absolute"!==b.css("position")&&b.parent().addClass("tve_lg_input")}),b.attr("data-tve-version",1),b.find("textarea").parent().addClass("tve_lg_textarea"),b.find("select").parent().addClass("tve_lg_dropdown"),b.find('input[type="radio"]').parents(".tve_lg_input_container").first().addClass("tve_lg_radio"),b.find('input[type="checkbox"]').parents(".tve_lg_input_container").first().addClass("tve_lg_checkbox"),b.find("button").parent().addClass("tve_lg_submit")},persistentData:function(){var a=this,c=!1;return"api"==this.connection_type&&jQuery("#generated_inputs_container .tve-lg-display-elem").prop("checked",!1).trigger("change"),b.find("input, select, textarea").each(function(){var b=jQuery(this),d=b.parent().find(".thrv_icon"),e=b.data("field"),f=jQuery("#txt_label_"+(e?e:""));if(c=!0,e&&(f.length||b.is("select"))){if(b.data("placeholder")&&f.val(b.data("placeholder")).trigger("change"),jQuery("#validation_"+e).val(b.data("validation")).trigger("change"),"radio"===b.attr("type")?jQuery("#required_"+b.data("parent-field")).prop("checked",!!b.data("required")).trigger("change"):jQuery("#required_"+e).prop("checked",!!b.data("required")).trigger("change"),d.length){var g=d.find(".tve_sc_icon").data("tve-icon");jQuery("#icon_"+e).prop("checked",!0).parent().append('<span data-cls="'+g+'" class="icomoon-icon"><span class="'+g+'"></span></span>'),"api"==a.connection_type&&(a.api_form_data.elements[e].icon=g,a.api_form_data.elements[e].show_icon=1)}"api"==a.connection_type&&jQuery("#elem_display_"+e).prop("checked",!0).trigger("change")}}),this},set_captcha_data:function(){var a=d.find('input[name="tve_api_use_captcha"]');a.prop("checked",1==c.use_captcha),a.trigger("change");for(var b in this.captcha_options)d.find("select.tve_"+b).val(this.captcha_options[b])},readCaptchaOptions:function(){for(var a in this.captcha_options)b.find("input#_"+a).length&&(this.captcha_options[a]=b.find("input#_"+a).val())},config:function(a,b){if("undefined"==typeof a|0===a.length)throw"Invalid option";return"undefined"==typeof b?this.get(a):this.set(a,b)},set:function(a,c){return b.attr("data-"+a,c),this},get:function(a){return b.attr("data-"+a)},generateContainer:function(a,c){var d=b.find('[data-field="'+a+'"]').parents(".tve_lg_input_container").first(),e=jQuery('<div class="tve_lg_input_container '+c+'"></div>');return d.length?e.attr({"class":d.attr("class"),id:d.attr("id"),style:d.attr("style")}):e},copyIconStyles:function(a,b){if(!a.length)return void b.find("span").addClass("tve_white");b.attr({style:a.attr("style"),"class":a.attr("class")});for(var c,d=a.find(".tve_sc_icon").attr("class").split(" "),e=0;c=d[e++];)-1===c.indexOf("icon-")&&b.find(".tve_sc_icon").addClass(c);return b.find(".tve_sc_icon").attr("style",a.find(".tve_sc_icon").attr("style")),a.find(".tve_sc_icon").attr("data-tve-custom-colour")&&b.find(".tve_sc_icon").attr("data-tve-custom-colour",a.find(".tve_sc_icon").attr("data-tve-custom-colour")),b},setInputPaddingForIcon:function(a,b){setTimeout(function(){if("undefined"==typeof b)return void a.css("padding-right",a.css("padding-left"));var c=b.width();c&&a.tve_css("padding-right",2*c+"px","important")},0)},_readStringProp:function(a,b){return jQuery("#"+b+"_"+a).val()},_readBoolProp:function(a,b){return jQuery("#"+b+"_"+a).is(":checked")?1:0},_copyElementStyles:function(a,b){return b.length?(a.attr("style",b.attr("style")),a.attr("class",b.attr("class")),b.attr("data-tve-custom-colour")&&a.attr("data-tve-custom-colour",b.attr("data-tve-custom-colour")),a):a},_insertIcon:function(a,b){var c=a.parent(),d=jQuery('<div class="thrv_wrapper thrv_icon tve_brdr_solid"><span></span></div>'),e=jQuery("#icon_"+a.attr("data-field")).parents("td").first().find(".icomoon-icon");e.length&&(d.find("span").attr("class","tve_sc_icon").addClass(e.attr("data-cls")).attr("data-tve-icon",e.attr("data-cls")),this.copyIconStyles(b.parent().find(".thrv_icon"),d),c.prepend(d),this.setInputPaddingForIcon(a,d))},renderTextInput:function(a,c,d){var e=b.find(".tve_lead_generated_inputs_container").find('input[type="text"],input[type="email"]').filter(":visible").first(),f=this._readStringProp(a,"txt_label"),g=jQuery('<input type="'+d+'" data-field="'+a+'" data-required="'+this._readBoolProp(a,"required")+'" data-validation="'+this._readStringProp(a,"validation")+'" name="'+c.name+'" placeholder="'+f+'" data-placeholder="'+f+'" />'),h=b.find('input[data-field="'+a+'"]');this._copyElementStyles(g,e);var i=this.generateContainer(a,"tve_lg_input").append(g);return this._readBoolProp(a,"icon")?(this._insertIcon(g,h),i):(this.setInputPaddingForIcon(g),i)},renderDropdown:function(a,c){var d=this._readStringProp(a,"txt_label"),e=jQuery('<select data-field="'+a+'" data-required="'+this._readBoolProp(a,"required")+'" name="'+c.name+'" data-placeholder="'+d+'"></select>'),f=b.find('select[data-field="'+a+'"]');this._copyElementStyles(e,f);var g=this.generateContainer(a,"tve_lg_dropdown tve_lg_select_container").append(e);return jQuery.each(c.options,function(a,b){""===b.value&&d&&(b.label=d),e.append(jQuery("<option></option>").val(b.value).html(b.label))}),this._readBoolProp(a,"icon")?(this._insertIcon(e,f),g):(this.setInputPaddingForIcon(e),g)},renderRadioInput:function(a,c){var d=this.generateContainer(a,"tve_lg_radio tve_clearfix"),f=this._readBoolProp(a,"required"),g=this;return jQuery.each(this.jsonFields.elements[a].options,function(h,i){var j=a+"_"+h,k=j+"_"+e++,l=g._readStringProp(j,"txt_label"),m=jQuery('<div class="tve_lg_radio_wrapper"></div>'),n=jQuery('<input data-parent-field="'+a+'" data-required="'+f+'" data-field="'+j+'" data-placeholder="'+l+'" id="'+k+'" type="radio" name="'+c.name+'" value="'+i+'" />'),o=jQuery('<label for="'+k+'">'+l+"</label>"),p=jQuery(b.find('label[for="'+j+'"]')).attr("data-tve-custom-colour");p&&o.attr("data-tve-custom-colour",p),m.append(n).append(o),d.append(m)}),d},renderTextarea:function(a,c){var d=this._readStringProp(a,"txt_label"),e=jQuery('<textarea data-field="'+a+'" data-required="'+this._readBoolProp(a,"required")+'" data-validation="'+this._readStringProp(a,"validation")+'" name="'+c.name+'" placeholder="'+d+'" data-placeholder="'+d+'"></textarea>'),f=b.find('textarea[data-field="'+a+'"]');this._copyElementStyles(e,f);var g=this.generateContainer(a,"tve_lg_textarea tve_clearfix").append(e);return this._readBoolProp(a,"icon")?(this._insertIcon(e,f),g):(this.setInputPaddingForIcon(e),g)},renderHiddenSwitchStateTrigger:function(a,b){var c="lightbox"==b?'__TCB_EVENT_[{"t":"click","a":"tl_state_lightbox","config":{"s":"'+a+'"},"elementType":"a"}]_TNEVE_BCT__':'__TCB_EVENT_[{"t":"click","a":"tl_state_switch","config":{"s":"'+a+'"},"elementType":"a"}]_TNEVE_BCT__',d='<a href="" style="display: none;" class="tve-switch-state-trigger tve_evt_manager_listen tve_et_click" data-tcb-events='+c+"></a>";return d},renderCheckboxInput:function(a,c){var d=this.generateContainer(a,"tve_lg_checkbox tve_clearfix"),f=this._readStringProp(a,"txt_label"),g=a+"_"+e++,h=jQuery('<div class="tve_lg_checkbox_wrapper"></div>'),i=jQuery('<input data-required="'+this._readBoolProp(a,"required")+'" data-field="'+a+'" data-placeholder="'+f+'" id="'+g+'" type="checkbox" name="'+c.name+'" value="'+c.value+'" />'),j=jQuery('<label for="'+g+'">'+f+"</label>"),k=jQuery(b.find('label[for="'+a+'"]')).attr("data-tve-custom-colour");return k&&j.attr("data-tve-custom-colour",k),h.append(i).append(j),d.append(h)},renderTextNode:function(a){return"<span>"+a.value+"</span>"},renderHiddenInput:function(a){return'<input id="'+a.name+'" type="hidden" name="'+a.name+'"'+(a.className?' class="'+a.className+'"':"")+' value="'+a.value+'">'},renderCaptcha:function(a){var b=Math.floor(1e3*Math.random()+1);return'<div class="tve-captcha-container tve_lg_input_container tve-captcha-'+this.captcha_options.captcha_theme+" tve-captcha-"+this.captcha_options.captcha_size+'" id="tve_captcha-'+b+'" data-site-key="'+a+'" data-theme="'+this.captcha_options.captcha_theme+'" data-type="'+this.captcha_options.captcha_type+'" data-size="'+this.captcha_options.captcha_size+'"></div>'},generateForm:function(){function a(a){var b=c.elements[a];if(b.processed=1,b.display||"hidden"==b.type){var e;switch(b.type){case"shortcode":e=h.renderTextNode(b);break;case"text":case"email":e=h.renderTextInput(a,b,b.type);break;case"radio":e=h.renderRadioInput(a,b);break;case"checkbox":e=h.renderCheckboxInput(a,b);break;case"select":e=h.renderDropdown(a,b);break;case"textarea":e=h.renderTextarea(a,b);break;case"hidden":e=h.renderHiddenInput(b)}e&&(g.append(e),"shortcode"!=b.type&&d++)}}var c="api"==this.connection_type?this.api_form_data:this.jsonFields,d=1,e=jQuery('<form action="#" method="'+c.form_method+'"></form>'),f=jQuery('<input type="hidden" class="tve-f-a-hidden" value="'+c.form_action+'" />'),g=jQuery('<div class="tve_lead_generated_inputs_container tve_clearfix"><div class="tve_lead_fields_overlay"></div></div>'),h=this;e.append(f);for(var i,j=0;i=c.element_order[j++];)c.elements[i]&&a(i);return jQuery.each(c.elements,function(b,c){return c.processed?!0:void a(b)}),1==this.use_captcha&&g.append(this.renderCaptcha(c.captcha_site_key)),e.append(c.hidden_inputs),e.append(c.not_visible_inputs),g.append('<div style="display: none">'+c.additional_fields+"</div>"),g.append(b.find(".tve_submit_container")),"undefined"!=typeof c.elements.state_change_trigger&&null!==c.elements.state_change_trigger&&g.append(h.renderHiddenSwitchStateTrigger(c.elements.state_change_trigger.value,c.form_state)),e.append(g),this.$formContainer.find(".tve_submit_container .thrv_icon").length&&g.find(".tve_submit_container").prepend(this.$formContainer.find(".thrv_icon")),this.$formContainer.html("").append(e),b.removeClass(function(a,b){return(b.match(/\btve_\d+/g)||[]).join(" ")}),b.attr("data-inputs-count",d),b.addClass("tve_"+d),this.writeCustomFormCode(),this},convertButtonToImage:function(){var a=b.find(".tve_submit_container");a.length&&(a.removeClass("tve_lg_submit").addClass("tve_lg_image_submit"),a.html('<div class="image_placeholder"><a id="tve_lead_pick_img" class="tve_click tve_green_button clearfix" href="#" target="_self"><i class="tve_icm tve-ic-upload"></i><span>Add Media</span></a></div>'),hide_control_panel_menu())},convertImageToButton:function(){var a=b.find(".tve_submit_container");a.length&&(a.removeClass("tve_lg_image_submit").addClass("tve_lg_submit"),a.html('<button type="submit">Submit</button>'),hide_control_panel_menu())},applyStyle:function(a){a||(a=b.is(".thrv_lead_generation_vertical")?"thrv_lead_generation_vertical":"thrv_lead_generation_horizontal"),b.removeClass("thrv_lead_generation_vertical thrv_lead_generation_horizontal").addClass(a).find(".tve_lg_input_container").removeClass("tve_lg_2 tve_lg_3");var c=b.find(".tve_lg_input,.tve_lg_radio,.tve_lg_checkbox,.tve_lg_textarea").length;1==this.use_captcha&&(c+=1),1===c||3===c?b.find(".tve_lg_input_container").addClass("tve_lg_2"):c>=2&&b.find(".tve_lg_input_container").addClass("tve_lg_3")},readApiElements:function(){this.api_form_data.thank_you_url=b.find("input#_back_url").val()||"",this.api_form_data.submit_option=b.find("input#_submit_option").val()||"reload",this.asset_option=b.find("input#_asset_option").val()||0,this.error_message_option=b.find("input#_error_message_option").val()||0,this.asset_group=b.find("input#_asset_group").val()||0,this.state=b.find("input#_state").val()||"",this.use_captcha=b.find("input#_use_captcha").val()||0,this.api_config_str=b.find("#__tcb_lg_fc").val(),this.custom_messages_str=b.find("#__tcb_lg_msg").val(),this.api_form_data.element_order=[];var a=this;b.find("input,select,textarea").each(function(){var b=jQuery(this).attr("data-field");b&&a.api_form_data.element_order.push(jQuery(this).attr("data-field"))}),this.api_form_data.extra=TVE_Content_Builder.auto_responder.api.readExtraSettings(b)},setApiData:function(b){var c=this,d="<p>Thank you for signing up! An email is being sent to [lead_email] - please check your inbox.</p>",e="<p>Ooops... </p><p>something went wrong. Please try again or contact the site owner.</p>";jQuery.each(b,function(a,b){"lb_html"!=a&&"elements"!=a&&(c.api_form_data[a]=b)}),TVE_Content_Builder.auto_responder.clearMCEEditor(),d=this.api_form_data.custom_messages&&this.api_form_data.custom_messages.success?this.api_form_data.custom_messages.success:d,e=this.api_form_data.custom_messages&&this.api_form_data.custom_messages.error?this.api_form_data.custom_messages.error:e,this.editorInit("tve_success_wp_editor",d),this.editorInit("tve_error_wp_editor",e),"undefined"!=typeof tinymce&&tinymce||(a("#tve_error_wp_editor").val(e),a("#tve_success_wp_editor").val(d)),this.api_config=b.connections,jQuery("#generated_inputs_container").on("change","input,select",function(){var a=jQuery(this),b=this.id.replace(/txt_label_|validation_|required_|icon_|elem_display_/,"");c.api_form_data.elements[b][a.attr("data-elem-field")]=a.is("input[type=checkbox]")?a.is(":checked")?1:0:a.val()}),this.api_form_data.elements?(jQuery.each(b.elements,function(a,b){return c.api_form_data.elements[a]?void(c.api_form_data.elements[a].value=b.value):(c.api_form_data.elements[a]=b,!0)}),jQuery.each(this.api_form_data.elements,function(a,b){b.label&&jQuery("#txt_label_"+a).val(b.label),b.validation&&jQuery("#validation_"+a).val(b.validation),jQuery("#required_"+a).prop("checked",!!b.required),jQuery("#elem_display_"+a).prop("checked",!!b.display);var c=jQuery("#icon_"+a).prop("checked",!!b.show_icon);b.icon&&c.parent().append('<span data-cls="'+b.icon+'" class="icomoon-icon"><span class="'+b.icon+'"></span></span>')})):(this.api_form_data.elements=b.elements,this.api_form_data.element_order=b.element_order,this.persistentData());var f=jQuery("#generated_inputs_container table tbody").sortable({handle:".tve-drag-handle",axis:"y",helper:function(b,c){var d=c.clone().empty();return c.find("td").each(function(){var b=a(this);d.append(b.clone().css("width",b.width()+"px").css("height",b.height()+"px"))}),d},update:function(){c.api_form_data.element_order=[],f.find(".lg_elem_field").each(function(){c.api_form_data.element_order.push(this.value)})}})},build_mce_init:function(b,c){var d={},e={};return d[c]=a.extend(!0,{},b.mce),e[c]=a.extend(!0,{},b.qt),e[c].id=c,d[c].selector="#"+c,d[c].body_class=d[c].body_class.replace("tve_tinymce_tpl",c),{mce_init:d,qt_init:e}},editorInit:function(b,c){if("undefined"!=typeof tinymce&&tinymce){var d=this.build_mce_init({mce:window.tinyMCEPreInit.mceInit.tve_tinymce_tpl,qt:window.tinyMCEPreInit.qtInit.tve_tinymce_tpl},b);tinyMCEPreInit.mceInit=a.extend(tinyMCEPreInit.mceInit,d.mce_init),tinyMCEPreInit.mceInit[b].setup=function(a){a.on("init",function(){a.setContent(c)})},tinyMCE.init(tinyMCEPreInit.mceInit[b]),window.wpActiveEditor="tve_success_wp_editor"}}};return f.init()}})}(jQuery);